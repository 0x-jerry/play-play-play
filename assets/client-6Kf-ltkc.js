import{d as m,r,u as y,a as _,b as k,s as x,c as w,o as g,e as h,f as o,g as j,w as E,v as S,h as i,i as b,t as p,j as M,_ as N,k as O,l as T}from"./index-Th1Vt7Lq.js";const B={class:"flex flex-col items-center justify-center w-screen gap-2 mt-50px"},P={class:"info"},R={class:"nes-field"},D=m({__name:"client",setup(V){const u=r(),a=y("host-id",""),t=r(),l=_({player:2,onKeyEvent(s,e){console.log("send",s,e),c.send({type:"keyEvent",data:[s,e]})}}),d=r(""),c=k({receive(s){if((s==null?void 0:s.type)==="keyEvent"){const[e,n]=s.data||{};l.keyEvent(e,n[0],1)}},hostId:a});c.peer.on("call",s=>{console.log("receive call"),s.answer(),s.on("stream",async e=>{if(console.log("receive stream",e),!!t.value){if(t.value.srcObject instanceof MediaStream){let n=new MediaStream([...e.getTracks(),...t.value.srcObject.getTracks()]);t.value.srcObject=n}else t.value.srcObject=e;await x(100),t.value.play()}}),s.on("error",e=>{console.error(e)})}),w(()=>{d.value=parseInt(l.nes.getFPS()).toFixed(0)},500,{immediate:!0}),g(async()=>{});async function f(){u.value&&(l.init(),await l.load("./roms/Contra.nes"))}return(s,e)=>{const n=N;return O(),h("div",B,[o("div",P,[o("div",R,[E(o("input",{type:"text",id:"name_field",class:"nes-input",placeholder:"Host ID","onUpdate:modelValue":e[0]||(e[0]=v=>b(a)?a.value=v:null)},null,512),[[S,i(a)]]),o("span",null,"Connected Host: "+p(i(c).connected),1)]),o("div",null,"FPS: "+p(i(d)),1)]),o("div",{ref_key:"output",ref:u,class:"aspect-[256/240] w-600px"},[o("video",{controls:"",autoplay:"",class:"w-full h-full",ref_key:"stream",ref:t},null,512)],512),j(n,{onClick:f},{default:M(()=>e[1]||(e[1]=[T("Load ROM")])),_:1})])}}});export{D as default};
