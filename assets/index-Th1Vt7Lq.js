var wh=Object.defineProperty;var or=e=>{throw TypeError(e)};var Vh=(e,t,s)=>t in e?wh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var rs=(e,t,s)=>Vh(e,typeof t!="symbol"?t+"":t,s),vi=(e,t,s)=>t.has(e)||or("Cannot "+s);var Ee=(e,t,s)=>(vi(e,t,"read from private field"),s?s.call(e):t.get(e)),ut=(e,t,s)=>t.has(e)?or("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),Ls=(e,t,s,i)=>(vi(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),pt=(e,t,s)=>(vi(e,t,"access private method"),s);function Gh(e,t){for(var s=0;s<t.length;s++){const i=t[s];if(typeof i!="string"&&!Array.isArray(i)){for(const n in i)if(n!=="default"&&!(n in e)){const r=Object.getOwnPropertyDescriptor(i,n);r&&Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:()=>i[n]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(n){if(n.ep)return;n.ep=!0;const r=s(n);fetch(n.href,r)}})();const qh="modulepreload",jh=function(e,t){return new URL(e,t).href},ar={},Uh=function(t,s,i){let n=Promise.resolve();if(s&&s.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),h=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));n=Promise.allSettled(s.map(l=>{if(l=jh(l,i),l in ar)return;ar[l]=!0;const c=l.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(!!i)for(let _=o.length-1;_>=0;_--){const R=o[_];if(R.href===l&&(!c||R.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${f}`))return;const p=document.createElement("link");if(p.rel=c?"stylesheet":qh,c||(p.as="script"),p.crossOrigin="",p.href=l,h&&p.setAttribute("nonce",h),document.head.appendChild(p),c)return new Promise((_,R)=>{p.addEventListener("load",_),p.addEventListener("error",()=>R(new Error(`Unable to preload CSS for ${l}`)))})}))}function r(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return n.then(o=>{for(const a of o||[])a.status==="rejected"&&r(a.reason);return t().catch(r)})};/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Nn(e){const t=Object.create(null);for(const s of e.split(","))t[s]=1;return s=>s in t}const K={},$t=[],Ze=()=>{},$h=()=>!1,oi=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),Mn=e=>e.startsWith("onUpdate:"),ue=Object.assign,Fn=(e,t)=>{const s=e.indexOf(t);s>-1&&e.splice(s,1)},Hh=Object.prototype.hasOwnProperty,Y=(e,t)=>Hh.call(e,t),q=Array.isArray,Ht=e=>ai(e)==="[object Map]",Ao=e=>ai(e)==="[object Set]",G=e=>typeof e=="function",re=e=>typeof e=="string",at=e=>typeof e=="symbol",se=e=>e!==null&&typeof e=="object",Do=e=>(se(e)||G(e))&&G(e.then)&&G(e.catch),Io=Object.prototype.toString,ai=e=>Io.call(e),Xh=e=>ai(e).slice(8,-1),Oo=e=>ai(e)==="[object Object]",Ln=e=>re(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,fs=Nn(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),hi=e=>{const t=Object.create(null);return s=>t[s]||(t[s]=e(s))},Yh=/-(\w)/g,Me=hi(e=>e.replace(Yh,(t,s)=>s?s.toUpperCase():"")),Wh=/\B([A-Z])/g,kt=hi(e=>e.replace(Wh,"-$1").toLowerCase()),ci=hi(e=>e.charAt(0).toUpperCase()+e.slice(1)),Ti=hi(e=>e?`on${ci(e)}`:""),St=(e,t)=>!Object.is(e,t),Gs=(e,...t)=>{for(let s=0;s<e.length;s++)e[s](...t)},Po=(e,t,s,i=!1)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:i,value:s})},tn=e=>{const t=parseFloat(e);return isNaN(t)?e:t};let hr;const li=()=>hr||(hr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Bn(e){if(q(e)){const t={};for(let s=0;s<e.length;s++){const i=e[s],n=re(i)?Kh(i):Bn(i);if(n)for(const r in n)t[r]=n[r]}return t}else if(re(e)||se(e))return e}const zh=/;(?![^(]*\))/g,Jh=/:([^]+)/,Zh=/\/\*[^]*?\*\//g;function Kh(e){const t={};return e.replace(Zh,"").split(zh).forEach(s=>{if(s){const i=s.split(Jh);i.length>1&&(t[i[0].trim()]=i[1].trim())}}),t}function fi(e){let t="";if(re(e))t=e;else if(q(e))for(let s=0;s<e.length;s++){const i=fi(e[s]);i&&(t+=i+" ")}else if(se(e))for(const s in e)e[s]&&(t+=s+" ");return t.trim()}const Qh="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ec=Nn(Qh);function ko(e){return!!e||e===""}const No=e=>!!(e&&e.__v_isRef===!0),sn=e=>re(e)?e:e==null?"":q(e)||se(e)&&(e.toString===Io||!G(e.toString))?No(e)?sn(e.value):JSON.stringify(e,Mo,2):String(e),Mo=(e,t)=>No(t)?Mo(e,t.value):Ht(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((s,[i,n],r)=>(s[Ei(i,r)+" =>"]=n,s),{})}:Ao(t)?{[`Set(${t.size})`]:[...t.values()].map(s=>Ei(s))}:at(t)?Ei(t):se(t)&&!q(t)&&!Oo(t)?String(t):t,Ei=(e,t="")=>{var s;return at(e)?`Symbol(${(s=e.description)!=null?s:t})`:e};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let me;class tc{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=me,!t&&me&&(this.index=(me.scopes||(me.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].pause();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let t,s;if(this.scopes)for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].resume();for(t=0,s=this.effects.length;t<s;t++)this.effects[t].resume()}}run(t){if(this._active){const s=me;try{return me=this,t()}finally{me=s}}}on(){me=this}off(){me=this.parent}stop(t){if(this._active){this._active=!1;let s,i;for(s=0,i=this.effects.length;s<i;s++)this.effects[s].stop();for(this.effects.length=0,s=0,i=this.cleanups.length;s<i;s++)this.cleanups[s]();if(this.cleanups.length=0,this.scopes){for(s=0,i=this.scopes.length;s<i;s++)this.scopes[s].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!t){const n=this.parent.scopes.pop();n&&n!==this&&(this.parent.scopes[this.index]=n,n.index=this.index)}this.parent=void 0}}}function Fo(){return me}function sc(e,t=!1){me&&me.cleanups.push(e)}let ee;const Ai=new WeakSet;class Lo{constructor(t){this.fn=t,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,me&&me.active&&me.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Ai.has(this)&&(Ai.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||wo(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,cr(this),Vo(this);const t=ee,s=Le;ee=this,Le=!0;try{return this.fn()}finally{Go(this),ee=t,Le=s,this.flags&=-3}}stop(){if(this.flags&1){for(let t=this.deps;t;t=t.nextDep)Gn(t);this.deps=this.depsTail=void 0,cr(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Ai.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){nn(this)&&this.run()}get dirty(){return nn(this)}}let Bo=0,us,ps;function wo(e,t=!1){if(e.flags|=8,t){e.next=ps,ps=e;return}e.next=us,us=e}function wn(){Bo++}function Vn(){if(--Bo>0)return;if(ps){let t=ps;for(ps=void 0;t;){const s=t.next;t.next=void 0,t.flags&=-9,t=s}}let e;for(;us;){let t=us;for(us=void 0;t;){const s=t.next;if(t.next=void 0,t.flags&=-9,t.flags&1)try{t.trigger()}catch(i){e||(e=i)}t=s}}if(e)throw e}function Vo(e){for(let t=e.deps;t;t=t.nextDep)t.version=-1,t.prevActiveLink=t.dep.activeLink,t.dep.activeLink=t}function Go(e){let t,s=e.depsTail,i=s;for(;i;){const n=i.prevDep;i.version===-1?(i===s&&(s=n),Gn(i),ic(i)):t=i,i.dep.activeLink=i.prevActiveLink,i.prevActiveLink=void 0,i=n}e.deps=t,e.depsTail=s}function nn(e){for(let t=e.deps;t;t=t.nextDep)if(t.dep.version!==t.version||t.dep.computed&&(qo(t.dep.computed)||t.dep.version!==t.version))return!0;return!!e._dirty}function qo(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Cs))return;e.globalVersion=Cs;const t=e.dep;if(e.flags|=2,t.version>0&&!e.isSSR&&e.deps&&!nn(e)){e.flags&=-3;return}const s=ee,i=Le;ee=e,Le=!0;try{Vo(e);const n=e.fn(e._value);(t.version===0||St(n,e._value))&&(e._value=n,t.version++)}catch(n){throw t.version++,n}finally{ee=s,Le=i,Go(e),e.flags&=-3}}function Gn(e,t=!1){const{dep:s,prevSub:i,nextSub:n}=e;if(i&&(i.nextSub=n,e.prevSub=void 0),n&&(n.prevSub=i,e.nextSub=void 0),s.subs===e&&(s.subs=i,!i&&s.computed)){s.computed.flags&=-5;for(let r=s.computed.deps;r;r=r.nextDep)Gn(r,!0)}!t&&!--s.sc&&s.map&&s.map.delete(s.key)}function ic(e){const{prevDep:t,nextDep:s}=e;t&&(t.nextDep=s,e.prevDep=void 0),s&&(s.prevDep=t,e.nextDep=void 0)}let Le=!0;const jo=[];function bt(){jo.push(Le),Le=!1}function yt(){const e=jo.pop();Le=e===void 0?!0:e}function cr(e){const{cleanup:t}=e;if(e.cleanup=void 0,t){const s=ee;ee=void 0;try{t()}finally{ee=s}}}let Cs=0;class nc{constructor(t,s){this.sub=t,this.dep=s,this.version=s.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class ui{constructor(t){this.computed=t,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(t){if(!ee||!Le||ee===this.computed)return;let s=this.activeLink;if(s===void 0||s.sub!==ee)s=this.activeLink=new nc(ee,this),ee.deps?(s.prevDep=ee.depsTail,ee.depsTail.nextDep=s,ee.depsTail=s):ee.deps=ee.depsTail=s,Uo(s);else if(s.version===-1&&(s.version=this.version,s.nextDep)){const i=s.nextDep;i.prevDep=s.prevDep,s.prevDep&&(s.prevDep.nextDep=i),s.prevDep=ee.depsTail,s.nextDep=void 0,ee.depsTail.nextDep=s,ee.depsTail=s,ee.deps===s&&(ee.deps=i)}return s}trigger(t){this.version++,Cs++,this.notify(t)}notify(t){wn();try{for(let s=this.subs;s;s=s.prevSub)s.sub.notify()&&s.sub.dep.notify()}finally{Vn()}}}function Uo(e){if(e.dep.sc++,e.sub.flags&4){const t=e.dep.computed;if(t&&!e.dep.subs){t.flags|=20;for(let i=t.deps;i;i=i.nextDep)Uo(i)}const s=e.dep.subs;s!==e&&(e.prevSub=s,s&&(s.nextSub=e)),e.dep.subs=e}}const rn=new WeakMap,Ot=Symbol(""),on=Symbol(""),bs=Symbol("");function ce(e,t,s){if(Le&&ee){let i=rn.get(e);i||rn.set(e,i=new Map);let n=i.get(s);n||(i.set(s,n=new ui),n.map=i,n.key=s),n.track()}}function nt(e,t,s,i,n,r){const o=rn.get(e);if(!o){Cs++;return}const a=h=>{h&&h.trigger()};if(wn(),t==="clear")o.forEach(a);else{const h=q(e),l=h&&Ln(s);if(h&&s==="length"){const c=Number(i);o.forEach((f,u)=>{(u==="length"||u===bs||!at(u)&&u>=c)&&a(f)})}else switch((s!==void 0||o.has(void 0))&&a(o.get(s)),l&&a(o.get(bs)),t){case"add":h?l&&a(o.get("length")):(a(o.get(Ot)),Ht(e)&&a(o.get(on)));break;case"delete":h||(a(o.get(Ot)),Ht(e)&&a(o.get(on)));break;case"set":Ht(e)&&a(o.get(Ot));break}}Vn()}function Vt(e){const t=X(e);return t===e?t:(ce(t,"iterate",bs),Be(e)?t:t.map(ge))}function qn(e){return ce(e=X(e),"iterate",bs),e}const rc={__proto__:null,[Symbol.iterator](){return Di(this,Symbol.iterator,ge)},concat(...e){return Vt(this).concat(...e.map(t=>q(t)?Vt(t):t))},entries(){return Di(this,"entries",e=>(e[1]=ge(e[1]),e))},every(e,t){return tt(this,"every",e,t,void 0,arguments)},filter(e,t){return tt(this,"filter",e,t,s=>s.map(ge),arguments)},find(e,t){return tt(this,"find",e,t,ge,arguments)},findIndex(e,t){return tt(this,"findIndex",e,t,void 0,arguments)},findLast(e,t){return tt(this,"findLast",e,t,ge,arguments)},findLastIndex(e,t){return tt(this,"findLastIndex",e,t,void 0,arguments)},forEach(e,t){return tt(this,"forEach",e,t,void 0,arguments)},includes(...e){return Ii(this,"includes",e)},indexOf(...e){return Ii(this,"indexOf",e)},join(e){return Vt(this).join(e)},lastIndexOf(...e){return Ii(this,"lastIndexOf",e)},map(e,t){return tt(this,"map",e,t,void 0,arguments)},pop(){return os(this,"pop")},push(...e){return os(this,"push",e)},reduce(e,...t){return lr(this,"reduce",e,t)},reduceRight(e,...t){return lr(this,"reduceRight",e,t)},shift(){return os(this,"shift")},some(e,t){return tt(this,"some",e,t,void 0,arguments)},splice(...e){return os(this,"splice",e)},toReversed(){return Vt(this).toReversed()},toSorted(e){return Vt(this).toSorted(e)},toSpliced(...e){return Vt(this).toSpliced(...e)},unshift(...e){return os(this,"unshift",e)},values(){return Di(this,"values",ge)}};function Di(e,t,s){const i=qn(e),n=i[t]();return i!==e&&!Be(e)&&(n._next=n.next,n.next=()=>{const r=n._next();return r.value&&(r.value=s(r.value)),r}),n}const oc=Array.prototype;function tt(e,t,s,i,n,r){const o=qn(e),a=o!==e&&!Be(e),h=o[t];if(h!==oc[t]){const f=h.apply(e,r);return a?ge(f):f}let l=s;o!==e&&(a?l=function(f,u){return s.call(this,ge(f),u,e)}:s.length>2&&(l=function(f,u){return s.call(this,f,u,e)}));const c=h.call(o,l,i);return a&&n?n(c):c}function lr(e,t,s,i){const n=qn(e);let r=s;return n!==e&&(Be(e)?s.length>3&&(r=function(o,a,h){return s.call(this,o,a,h,e)}):r=function(o,a,h){return s.call(this,o,ge(a),h,e)}),n[t](r,...i)}function Ii(e,t,s){const i=X(e);ce(i,"iterate",bs);const n=i[t](...s);return(n===-1||n===!1)&&Hn(s[0])?(s[0]=X(s[0]),i[t](...s)):n}function os(e,t,s=[]){bt(),wn();const i=X(e)[t].apply(e,s);return Vn(),yt(),i}const ac=Nn("__proto__,__v_isRef,__isVue"),$o=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(at));function hc(e){at(e)||(e=String(e));const t=X(this);return ce(t,"has",e),t.hasOwnProperty(e)}class Ho{constructor(t=!1,s=!1){this._isReadonly=t,this._isShallow=s}get(t,s,i){if(s==="__v_skip")return t.__v_skip;const n=this._isReadonly,r=this._isShallow;if(s==="__v_isReactive")return!n;if(s==="__v_isReadonly")return n;if(s==="__v_isShallow")return r;if(s==="__v_raw")return i===(n?r?Rc:zo:r?Wo:Yo).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(i)?t:void 0;const o=q(t);if(!n){let h;if(o&&(h=rc[s]))return h;if(s==="hasOwnProperty")return hc}const a=Reflect.get(t,s,fe(t)?t:i);return(at(s)?$o.has(s):ac(s))||(n||ce(t,"get",s),r)?a:fe(a)?o&&Ln(s)?a:a.value:se(a)?n?Un(a):ss(a):a}}class Xo extends Ho{constructor(t=!1){super(!1,t)}set(t,s,i,n){let r=t[s];if(!this._isShallow){const h=Pt(r);if(!Be(i)&&!Pt(i)&&(r=X(r),i=X(i)),!q(t)&&fe(r)&&!fe(i))return h?!1:(r.value=i,!0)}const o=q(t)&&Ln(s)?Number(s)<t.length:Y(t,s),a=Reflect.set(t,s,i,fe(t)?t:n);return t===X(n)&&(o?St(i,r)&&nt(t,"set",s,i):nt(t,"add",s,i)),a}deleteProperty(t,s){const i=Y(t,s);t[s];const n=Reflect.deleteProperty(t,s);return n&&i&&nt(t,"delete",s,void 0),n}has(t,s){const i=Reflect.has(t,s);return(!at(s)||!$o.has(s))&&ce(t,"has",s),i}ownKeys(t){return ce(t,"iterate",q(t)?"length":Ot),Reflect.ownKeys(t)}}class cc extends Ho{constructor(t=!1){super(!0,t)}set(t,s){return!0}deleteProperty(t,s){return!0}}const lc=new Xo,fc=new cc,uc=new Xo(!0);const an=e=>e,Bs=e=>Reflect.getPrototypeOf(e);function pc(e,t,s){return function(...i){const n=this.__v_raw,r=X(n),o=Ht(r),a=e==="entries"||e===Symbol.iterator&&o,h=e==="keys"&&o,l=n[e](...i),c=s?an:t?hn:ge;return!t&&ce(r,"iterate",h?on:Ot),{next(){const{value:f,done:u}=l.next();return u?{value:f,done:u}:{value:a?[c(f[0]),c(f[1])]:c(f),done:u}},[Symbol.iterator](){return this}}}}function ws(e){return function(...t){return e==="delete"?!1:e==="clear"?void 0:this}}function dc(e,t){const s={get(n){const r=this.__v_raw,o=X(r),a=X(n);e||(St(n,a)&&ce(o,"get",n),ce(o,"get",a));const{has:h}=Bs(o),l=t?an:e?hn:ge;if(h.call(o,n))return l(r.get(n));if(h.call(o,a))return l(r.get(a));r!==o&&r.get(n)},get size(){const n=this.__v_raw;return!e&&ce(X(n),"iterate",Ot),Reflect.get(n,"size",n)},has(n){const r=this.__v_raw,o=X(r),a=X(n);return e||(St(n,a)&&ce(o,"has",n),ce(o,"has",a)),n===a?r.has(n):r.has(n)||r.has(a)},forEach(n,r){const o=this,a=o.__v_raw,h=X(a),l=t?an:e?hn:ge;return!e&&ce(h,"iterate",Ot),a.forEach((c,f)=>n.call(r,l(c),l(f),o))}};return ue(s,e?{add:ws("add"),set:ws("set"),delete:ws("delete"),clear:ws("clear")}:{add(n){!t&&!Be(n)&&!Pt(n)&&(n=X(n));const r=X(this);return Bs(r).has.call(r,n)||(r.add(n),nt(r,"add",n,n)),this},set(n,r){!t&&!Be(r)&&!Pt(r)&&(r=X(r));const o=X(this),{has:a,get:h}=Bs(o);let l=a.call(o,n);l||(n=X(n),l=a.call(o,n));const c=h.call(o,n);return o.set(n,r),l?St(r,c)&&nt(o,"set",n,r):nt(o,"add",n,r),this},delete(n){const r=X(this),{has:o,get:a}=Bs(r);let h=o.call(r,n);h||(n=X(n),h=o.call(r,n)),a&&a.call(r,n);const l=r.delete(n);return h&&nt(r,"delete",n,void 0),l},clear(){const n=X(this),r=n.size!==0,o=n.clear();return r&&nt(n,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(n=>{s[n]=pc(n,e,t)}),s}function jn(e,t){const s=dc(e,t);return(i,n,r)=>n==="__v_isReactive"?!e:n==="__v_isReadonly"?e:n==="__v_raw"?i:Reflect.get(Y(s,n)&&n in i?s:i,n,r)}const mc={get:jn(!1,!1)},gc={get:jn(!1,!0)},_c={get:jn(!0,!1)};const Yo=new WeakMap,Wo=new WeakMap,zo=new WeakMap,Rc=new WeakMap;function xc(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Sc(e){return e.__v_skip||!Object.isExtensible(e)?0:xc(Xh(e))}function ss(e){return Pt(e)?e:$n(e,!1,lc,mc,Yo)}function Jo(e){return $n(e,!1,uc,gc,Wo)}function Un(e){return $n(e,!0,fc,_c,zo)}function $n(e,t,s,i,n){if(!se(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=n.get(e);if(r)return r;const o=Sc(e);if(o===0)return e;const a=new Proxy(e,o===2?i:s);return n.set(e,a),a}function ds(e){return Pt(e)?ds(e.__v_raw):!!(e&&e.__v_isReactive)}function Pt(e){return!!(e&&e.__v_isReadonly)}function Be(e){return!!(e&&e.__v_isShallow)}function Hn(e){return e?!!e.__v_raw:!1}function X(e){const t=e&&e.__v_raw;return t?X(t):e}function Cc(e){return!Y(e,"__v_skip")&&Object.isExtensible(e)&&Po(e,"__v_skip",!0),e}const ge=e=>se(e)?ss(e):e,hn=e=>se(e)?Un(e):e;function fe(e){return e?e.__v_isRef===!0:!1}function Jt(e){return Zo(e,!1)}function bc(e){return Zo(e,!0)}function Zo(e,t){return fe(e)?e:new yc(e,t)}class yc{constructor(t,s){this.dep=new ui,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=s?t:X(t),this._value=s?t:ge(t),this.__v_isShallow=s}get value(){return this.dep.track(),this._value}set value(t){const s=this._rawValue,i=this.__v_isShallow||Be(t)||Pt(t);t=i?t:X(t),St(t,s)&&(this._rawValue=t,this._value=i?t:ge(t),this.dep.trigger())}}function Oe(e){return fe(e)?e.value:e}function ot(e){return G(e)?e():Oe(e)}const vc={get:(e,t,s)=>t==="__v_raw"?e:Oe(Reflect.get(e,t,s)),set:(e,t,s,i)=>{const n=e[t];return fe(n)&&!fe(s)?(n.value=s,!0):Reflect.set(e,t,s,i)}};function Ko(e){return ds(e)?e:new Proxy(e,vc)}class Tc{constructor(t){this.__v_isRef=!0,this._value=void 0;const s=this.dep=new ui,{get:i,set:n}=t(s.track.bind(s),s.trigger.bind(s));this._get=i,this._set=n}get value(){return this._value=this._get()}set value(t){this._set(t)}}function Ec(e){return new Tc(e)}class Ac{constructor(t,s,i){this.fn=t,this.setter=s,this._value=void 0,this.dep=new ui(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Cs-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!s,this.isSSR=i}notify(){if(this.flags|=16,!(this.flags&8)&&ee!==this)return wo(this,!0),!0}get value(){const t=this.dep.track();return qo(this),t&&(t.version=this.dep.version),this._value}set value(t){this.setter&&this.setter(t)}}function Dc(e,t,s=!1){let i,n;return G(e)?i=e:(i=e.get,n=e.set),new Ac(i,n,s)}const Vs={},Zs=new WeakMap;let At;function Ic(e,t=!1,s=At){if(s){let i=Zs.get(s);i||Zs.set(s,i=[]),i.push(e)}}function Oc(e,t,s=K){const{immediate:i,deep:n,once:r,scheduler:o,augmentJob:a,call:h}=s,l=v=>n?v:Be(v)||n===!1||n===0?rt(v,1):rt(v);let c,f,u,p,_=!1,R=!1;if(fe(e)?(f=()=>e.value,_=Be(e)):ds(e)?(f=()=>l(e),_=!0):q(e)?(R=!0,_=e.some(v=>ds(v)||Be(v)),f=()=>e.map(v=>{if(fe(v))return v.value;if(ds(v))return l(v);if(G(v))return h?h(v,2):v()})):G(e)?t?f=h?()=>h(e,2):e:f=()=>{if(u){bt();try{u()}finally{yt()}}const v=At;At=c;try{return h?h(e,3,[p]):e(p)}finally{At=v}}:f=Ze,t&&n){const v=f,j=n===!0?1/0:n;f=()=>rt(v(),j)}const P=Fo(),A=()=>{c.stop(),P&&P.active&&Fn(P.effects,c)};if(r&&t){const v=t;t=(...j)=>{v(...j),A()}}let T=R?new Array(e.length).fill(Vs):Vs;const k=v=>{if(!(!(c.flags&1)||!c.dirty&&!v))if(t){const j=c.run();if(n||_||(R?j.some((te,z)=>St(te,T[z])):St(j,T))){u&&u();const te=At;At=c;try{const z=[j,T===Vs?void 0:R&&T[0]===Vs?[]:T,p];h?h(t,3,z):t(...z),T=j}finally{At=te}}}else c.run()};return a&&a(k),c=new Lo(f),c.scheduler=o?()=>o(k,!1):k,p=v=>Ic(v,!1,c),u=c.onStop=()=>{const v=Zs.get(c);if(v){if(h)h(v,4);else for(const j of v)j();Zs.delete(c)}},t?i?k(!0):T=c.run():o?o(k.bind(null,!0),!0):c.run(),A.pause=c.pause.bind(c),A.resume=c.resume.bind(c),A.stop=A,A}function rt(e,t=1/0,s){if(t<=0||!se(e)||e.__v_skip||(s=s||new Set,s.has(e)))return e;if(s.add(e),t--,fe(e))rt(e.value,t,s);else if(q(e))for(let i=0;i<e.length;i++)rt(e[i],t,s);else if(Ao(e)||Ht(e))e.forEach(i=>{rt(i,t,s)});else if(Oo(e)){for(const i in e)rt(e[i],t,s);for(const i of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,i)&&rt(e[i],t,s)}return e}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Ns(e,t,s,i){try{return i?e(...i):e()}catch(n){pi(n,t,s)}}function Qe(e,t,s,i){if(G(e)){const n=Ns(e,t,s,i);return n&&Do(n)&&n.catch(r=>{pi(r,t,s)}),n}if(q(e)){const n=[];for(let r=0;r<e.length;r++)n.push(Qe(e[r],t,s,i));return n}}function pi(e,t,s,i=!0){const n=t?t.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:o}=t&&t.appContext.config||K;if(t){let a=t.parent;const h=t.proxy,l=`https://vuejs.org/error-reference/#runtime-${s}`;for(;a;){const c=a.ec;if(c){for(let f=0;f<c.length;f++)if(c[f](e,h,l)===!1)return}a=a.parent}if(r){bt(),Ns(r,null,10,[e,h,l]),yt();return}}Pc(e,s,n,i,o)}function Pc(e,t,s,i=!0,n=!1){if(n)throw e;console.error(e)}const _e=[];let We=-1;const Xt=[];let gt=null,Gt=0;const Qo=Promise.resolve();let Ks=null;function Xn(e){const t=Ks||Qo;return e?t.then(this?e.bind(this):e):t}function kc(e){let t=We+1,s=_e.length;for(;t<s;){const i=t+s>>>1,n=_e[i],r=ys(n);r<e||r===e&&n.flags&2?t=i+1:s=i}return t}function Yn(e){if(!(e.flags&1)){const t=ys(e),s=_e[_e.length-1];!s||!(e.flags&2)&&t>=ys(s)?_e.push(e):_e.splice(kc(t),0,e),e.flags|=1,ea()}}function ea(){Ks||(Ks=Qo.then(sa))}function Nc(e){q(e)?Xt.push(...e):gt&&e.id===-1?gt.splice(Gt+1,0,e):e.flags&1||(Xt.push(e),e.flags|=1),ea()}function fr(e,t,s=We+1){for(;s<_e.length;s++){const i=_e[s];if(i&&i.flags&2){if(e&&i.id!==e.uid)continue;_e.splice(s,1),s--,i.flags&4&&(i.flags&=-2),i(),i.flags&4||(i.flags&=-2)}}}function ta(e){if(Xt.length){const t=[...new Set(Xt)].sort((s,i)=>ys(s)-ys(i));if(Xt.length=0,gt){gt.push(...t);return}for(gt=t,Gt=0;Gt<gt.length;Gt++){const s=gt[Gt];s.flags&4&&(s.flags&=-2),s.flags&8||s(),s.flags&=-2}gt=null,Gt=0}}const ys=e=>e.id==null?e.flags&2?-1:1/0:e.id;function sa(e){try{for(We=0;We<_e.length;We++){const t=_e[We];t&&!(t.flags&8)&&(t.flags&4&&(t.flags&=-2),Ns(t,t.i,t.i?15:14),t.flags&4||(t.flags&=-2))}}finally{for(;We<_e.length;We++){const t=_e[We];t&&(t.flags&=-2)}We=-1,_e.length=0,ta(),Ks=null,(_e.length||Xt.length)&&sa()}}let he=null,ia=null;function Qs(e){const t=he;return he=e,ia=e&&e.type.__scopeId||null,t}function na(e,t=he,s){if(!t||e._n)return e;const i=(...n)=>{i._d&&Cr(-1);const r=Qs(t);let o;try{o=e(...n)}finally{Qs(r),i._d&&Cr(1)}return o};return i._n=!0,i._c=!0,i._d=!0,i}function Fp(e,t){if(he===null)return e;const s=xi(he),i=e.dirs||(e.dirs=[]);for(let n=0;n<t.length;n++){let[r,o,a,h=K]=t[n];r&&(G(r)&&(r={mounted:r,updated:r}),r.deep&&rt(o),i.push({dir:r,instance:s,value:o,oldValue:void 0,arg:a,modifiers:h}))}return e}function Tt(e,t,s,i){const n=e.dirs,r=t&&t.dirs;for(let o=0;o<n.length;o++){const a=n[o];r&&(a.oldValue=r[o].value);let h=a.dir[i];h&&(bt(),Qe(h,s,8,[e.el,a,e,t]),yt())}}const Mc=Symbol("_vte"),Fc=e=>e.__isTeleport;function Wn(e,t){e.shapeFlag&6&&e.component?(e.transition=t,Wn(e.component.subTree,t)):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}/*! #__NO_SIDE_EFFECTS__ */function di(e,t){return G(e)?ue({name:e.name},t,{setup:e}):e}function ra(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function ei(e,t,s,i,n=!1){if(q(e)){e.forEach((_,R)=>ei(_,t&&(q(t)?t[R]:t),s,i,n));return}if(Yt(i)&&!n){i.shapeFlag&512&&i.type.__asyncResolved&&i.component.subTree.component&&ei(e,t,s,i.component.subTree);return}const r=i.shapeFlag&4?xi(i.component):i.el,o=n?null:r,{i:a,r:h}=e,l=t&&t.r,c=a.refs===K?a.refs={}:a.refs,f=a.setupState,u=X(f),p=f===K?()=>!1:_=>Y(u,_);if(l!=null&&l!==h&&(re(l)?(c[l]=null,p(l)&&(f[l]=null)):fe(l)&&(l.value=null)),G(h))Ns(h,a,12,[o,c]);else{const _=re(h),R=fe(h);if(_||R){const P=()=>{if(e.f){const A=_?p(h)?f[h]:c[h]:h.value;n?q(A)&&Fn(A,r):q(A)?A.includes(r)||A.push(r):_?(c[h]=[r],p(h)&&(f[h]=c[h])):(h.value=[r],e.k&&(c[e.k]=h.value))}else _?(c[h]=o,p(h)&&(f[h]=o)):R&&(h.value=o,e.k&&(c[e.k]=o))};o?(P.id=-1,Ae(P,s)):P()}}}li().requestIdleCallback;li().cancelIdleCallback;const Yt=e=>!!e.type.__asyncLoader,oa=e=>e.type.__isKeepAlive;function Lc(e,t){aa(e,"a",t)}function Bc(e,t){aa(e,"da",t)}function aa(e,t,s=le){const i=e.__wdc||(e.__wdc=()=>{let n=s;for(;n;){if(n.isDeactivated)return;n=n.parent}return e()});if(mi(t,i,s),s){let n=s.parent;for(;n&&n.parent;)oa(n.parent.vnode)&&wc(i,t,s,n),n=n.parent}}function wc(e,t,s,i){const n=mi(t,e,i,!0);gi(()=>{Fn(i[t],n)},s)}function mi(e,t,s=le,i=!1){if(s){const n=s[e]||(s[e]=[]),r=t.__weh||(t.__weh=(...o)=>{bt();const a=Ms(s),h=Qe(t,s,e,o);return a(),yt(),h});return i?n.unshift(r):n.push(r),r}}const ht=e=>(t,s=le)=>{(!As||e==="sp")&&mi(e,(...i)=>t(...i),s)},Vc=ht("bm"),ha=ht("m"),Gc=ht("bu"),qc=ht("u"),jc=ht("bum"),gi=ht("um"),Uc=ht("sp"),$c=ht("rtg"),Hc=ht("rtc");function Xc(e,t=le){mi("ec",e,t)}const Yc="components";function Wc(e,t){return Jc(Yc,e,!0,t)||e}const zc=Symbol.for("v-ndc");function Jc(e,t,s=!0,i=!1){const n=he||le;if(n){const r=n.type;{const a=Bl(r,!1);if(a&&(a===t||a===Me(t)||a===ci(Me(t))))return r}const o=ur(n[e]||r[e],t)||ur(n.appContext[e],t);return!o&&i?r:o}}function ur(e,t){return e&&(e[t]||e[Me(t)]||e[ci(Me(t))])}function Zc(e,t,s={},i,n){if(he.ce||he.parent&&Yt(he.parent)&&he.parent.ce)return vs(),pn(ke,null,[ye("slot",s,i)],64);let r=e[t];r&&r._c&&(r._d=!1),vs();const o=r&&ca(r(s)),a=s.key||o&&o.key,h=pn(ke,{key:(a&&!at(a)?a:`_${t}`)+""},o||[],o&&e._===1?64:-2);return h.scopeId&&(h.slotScopeIds=[h.scopeId+"-s"]),r&&r._c&&(r._d=!0),h}function ca(e){return e.some(t=>Es(t)?!(t.type===Zt||t.type===ke&&!ca(t.children)):!0)?e:null}const cn=e=>e?ka(e)?xi(e):cn(e.parent):null,ms=ue(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>cn(e.parent),$root:e=>cn(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>fa(e),$forceUpdate:e=>e.f||(e.f=()=>{Yn(e.update)}),$nextTick:e=>e.n||(e.n=Xn.bind(e.proxy)),$watch:e=>Rl.bind(e)}),Oi=(e,t)=>e!==K&&!e.__isScriptSetup&&Y(e,t),Kc={get({_:e},t){if(t==="__v_skip")return!0;const{ctx:s,setupState:i,data:n,props:r,accessCache:o,type:a,appContext:h}=e;let l;if(t[0]!=="$"){const p=o[t];if(p!==void 0)switch(p){case 1:return i[t];case 2:return n[t];case 4:return s[t];case 3:return r[t]}else{if(Oi(i,t))return o[t]=1,i[t];if(n!==K&&Y(n,t))return o[t]=2,n[t];if((l=e.propsOptions[0])&&Y(l,t))return o[t]=3,r[t];if(s!==K&&Y(s,t))return o[t]=4,s[t];ln&&(o[t]=0)}}const c=ms[t];let f,u;if(c)return t==="$attrs"&&ce(e.attrs,"get",""),c(e);if((f=a.__cssModules)&&(f=f[t]))return f;if(s!==K&&Y(s,t))return o[t]=4,s[t];if(u=h.config.globalProperties,Y(u,t))return u[t]},set({_:e},t,s){const{data:i,setupState:n,ctx:r}=e;return Oi(n,t)?(n[t]=s,!0):i!==K&&Y(i,t)?(i[t]=s,!0):Y(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(r[t]=s,!0)},has({_:{data:e,setupState:t,accessCache:s,ctx:i,appContext:n,propsOptions:r}},o){let a;return!!s[o]||e!==K&&Y(e,o)||Oi(t,o)||(a=r[0])&&Y(a,o)||Y(i,o)||Y(ms,o)||Y(n.config.globalProperties,o)},defineProperty(e,t,s){return s.get!=null?e._.accessCache[t]=0:Y(s,"value")&&this.set(e,t,s.value,null),Reflect.defineProperty(e,t,s)}};function pr(e){return q(e)?e.reduce((t,s)=>(t[s]=null,t),{}):e}let ln=!0;function Qc(e){const t=fa(e),s=e.proxy,i=e.ctx;ln=!1,t.beforeCreate&&dr(t.beforeCreate,e,"bc");const{data:n,computed:r,methods:o,watch:a,provide:h,inject:l,created:c,beforeMount:f,mounted:u,beforeUpdate:p,updated:_,activated:R,deactivated:P,beforeDestroy:A,beforeUnmount:T,destroyed:k,unmounted:v,render:j,renderTracked:te,renderTriggered:z,errorCaptured:Ge,serverPrefetch:ct,expose:qe,inheritAttrs:lt,components:vt,directives:je,filters:is}=t;if(l&&el(l,i,null),o)for(const J in o){const $=o[J];G($)&&(i[J]=$.bind(s))}if(n){const J=n.call(s,s);se(J)&&(e.data=ss(J))}if(ln=!0,r)for(const J in r){const $=r[J],et=G($)?$.bind(s,s):G($.get)?$.get.bind(s,s):Ze,ft=!G($)&&G($.set)?$.set.bind(s):Ze,Ue=Ne({get:et,set:ft});Object.defineProperty(i,J,{enumerable:!0,configurable:!0,get:()=>Ue.value,set:xe=>Ue.value=xe})}if(a)for(const J in a)la(a[J],i,s,J);if(h){const J=G(h)?h.call(s):h;Reflect.ownKeys(J).forEach($=>{qs($,J[$])})}c&&dr(c,e,"c");function oe(J,$){q($)?$.forEach(et=>J(et.bind(s))):$&&J($.bind(s))}if(oe(Vc,f),oe(ha,u),oe(Gc,p),oe(qc,_),oe(Lc,R),oe(Bc,P),oe(Xc,Ge),oe(Hc,te),oe($c,z),oe(jc,T),oe(gi,v),oe(Uc,ct),q(qe))if(qe.length){const J=e.exposed||(e.exposed={});qe.forEach($=>{Object.defineProperty(J,$,{get:()=>s[$],set:et=>s[$]=et})})}else e.exposed||(e.exposed={});j&&e.render===Ze&&(e.render=j),lt!=null&&(e.inheritAttrs=lt),vt&&(e.components=vt),je&&(e.directives=je),ct&&ra(e)}function el(e,t,s=Ze){q(e)&&(e=fn(e));for(const i in e){const n=e[i];let r;se(n)?"default"in n?r=we(n.from||i,n.default,!0):r=we(n.from||i):r=we(n),fe(r)?Object.defineProperty(t,i,{enumerable:!0,configurable:!0,get:()=>r.value,set:o=>r.value=o}):t[i]=r}}function dr(e,t,s){Qe(q(e)?e.map(i=>i.bind(t.proxy)):e.bind(t.proxy),t,s)}function la(e,t,s,i){let n=i.includes(".")?Ta(s,i):()=>s[i];if(re(e)){const r=t[e];G(r)&&Ct(n,r)}else if(G(e))Ct(n,e.bind(s));else if(se(e))if(q(e))e.forEach(r=>la(r,t,s,i));else{const r=G(e.handler)?e.handler.bind(s):t[e.handler];G(r)&&Ct(n,r,e)}}function fa(e){const t=e.type,{mixins:s,extends:i}=t,{mixins:n,optionsCache:r,config:{optionMergeStrategies:o}}=e.appContext,a=r.get(t);let h;return a?h=a:!n.length&&!s&&!i?h=t:(h={},n.length&&n.forEach(l=>ti(h,l,o,!0)),ti(h,t,o)),se(t)&&r.set(t,h),h}function ti(e,t,s,i=!1){const{mixins:n,extends:r}=t;r&&ti(e,r,s,!0),n&&n.forEach(o=>ti(e,o,s,!0));for(const o in t)if(!(i&&o==="expose")){const a=tl[o]||s&&s[o];e[o]=a?a(e[o],t[o]):t[o]}return e}const tl={data:mr,props:gr,emits:gr,methods:ls,computed:ls,beforeCreate:de,created:de,beforeMount:de,mounted:de,beforeUpdate:de,updated:de,beforeDestroy:de,beforeUnmount:de,destroyed:de,unmounted:de,activated:de,deactivated:de,errorCaptured:de,serverPrefetch:de,components:ls,directives:ls,watch:il,provide:mr,inject:sl};function mr(e,t){return t?e?function(){return ue(G(e)?e.call(this,this):e,G(t)?t.call(this,this):t)}:t:e}function sl(e,t){return ls(fn(e),fn(t))}function fn(e){if(q(e)){const t={};for(let s=0;s<e.length;s++)t[e[s]]=e[s];return t}return e}function de(e,t){return e?[...new Set([].concat(e,t))]:t}function ls(e,t){return e?ue(Object.create(null),e,t):t}function gr(e,t){return e?q(e)&&q(t)?[...new Set([...e,...t])]:ue(Object.create(null),pr(e),pr(t??{})):t}function il(e,t){if(!e)return t;if(!t)return e;const s=ue(Object.create(null),e);for(const i in t)s[i]=de(e[i],t[i]);return s}function ua(){return{app:null,config:{isNativeTag:$h,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let nl=0;function rl(e,t){return function(i,n=null){G(i)||(i=ue({},i)),n!=null&&!se(n)&&(n=null);const r=ua(),o=new WeakSet,a=[];let h=!1;const l=r.app={_uid:nl++,_component:i,_props:n,_container:null,_context:r,_instance:null,version:Vl,get config(){return r.config},set config(c){},use(c,...f){return o.has(c)||(c&&G(c.install)?(o.add(c),c.install(l,...f)):G(c)&&(o.add(c),c(l,...f))),l},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),l},component(c,f){return f?(r.components[c]=f,l):r.components[c]},directive(c,f){return f?(r.directives[c]=f,l):r.directives[c]},mount(c,f,u){if(!h){const p=l._ceVNode||ye(i,n);return p.appContext=r,u===!0?u="svg":u===!1&&(u=void 0),e(p,c,u),h=!0,l._container=c,c.__vue_app__=l,xi(p.component)}},onUnmount(c){a.push(c)},unmount(){h&&(Qe(a,l._instance,16),e(null,l._container),delete l._container.__vue_app__)},provide(c,f){return r.provides[c]=f,l},runWithContext(c){const f=Wt;Wt=l;try{return c()}finally{Wt=f}}};return l}}let Wt=null;function qs(e,t){if(le){let s=le.provides;const i=le.parent&&le.parent.provides;i===s&&(s=le.provides=Object.create(i)),s[e]=t}}function we(e,t,s=!1){const i=le||he;if(i||Wt){const n=Wt?Wt._context.provides:i?i.parent==null?i.vnode.appContext&&i.vnode.appContext.provides:i.parent.provides:void 0;if(n&&e in n)return n[e];if(arguments.length>1)return s&&G(t)?t.call(i&&i.proxy):t}}const pa={},da=()=>Object.create(pa),ma=e=>Object.getPrototypeOf(e)===pa;function ol(e,t,s,i=!1){const n={},r=da();e.propsDefaults=Object.create(null),ga(e,t,n,r);for(const o in e.propsOptions[0])o in n||(n[o]=void 0);s?e.props=i?n:Jo(n):e.type.props?e.props=n:e.props=r,e.attrs=r}function al(e,t,s,i){const{props:n,attrs:r,vnode:{patchFlag:o}}=e,a=X(n),[h]=e.propsOptions;let l=!1;if((i||o>0)&&!(o&16)){if(o&8){const c=e.vnode.dynamicProps;for(let f=0;f<c.length;f++){let u=c[f];if(_i(e.emitsOptions,u))continue;const p=t[u];if(h)if(Y(r,u))p!==r[u]&&(r[u]=p,l=!0);else{const _=Me(u);n[_]=un(h,a,_,p,e,!1)}else p!==r[u]&&(r[u]=p,l=!0)}}}else{ga(e,t,n,r)&&(l=!0);let c;for(const f in a)(!t||!Y(t,f)&&((c=kt(f))===f||!Y(t,c)))&&(h?s&&(s[f]!==void 0||s[c]!==void 0)&&(n[f]=un(h,a,f,void 0,e,!0)):delete n[f]);if(r!==a)for(const f in r)(!t||!Y(t,f))&&(delete r[f],l=!0)}l&&nt(e.attrs,"set","")}function ga(e,t,s,i){const[n,r]=e.propsOptions;let o=!1,a;if(t)for(let h in t){if(fs(h))continue;const l=t[h];let c;n&&Y(n,c=Me(h))?!r||!r.includes(c)?s[c]=l:(a||(a={}))[c]=l:_i(e.emitsOptions,h)||(!(h in i)||l!==i[h])&&(i[h]=l,o=!0)}if(r){const h=X(s),l=a||K;for(let c=0;c<r.length;c++){const f=r[c];s[f]=un(n,h,f,l[f],e,!Y(l,f))}}return o}function un(e,t,s,i,n,r){const o=e[s];if(o!=null){const a=Y(o,"default");if(a&&i===void 0){const h=o.default;if(o.type!==Function&&!o.skipFactory&&G(h)){const{propsDefaults:l}=n;if(s in l)i=l[s];else{const c=Ms(n);i=l[s]=h.call(null,t),c()}}else i=h;n.ce&&n.ce._setProp(s,i)}o[0]&&(r&&!a?i=!1:o[1]&&(i===""||i===kt(s))&&(i=!0))}return i}const hl=new WeakMap;function _a(e,t,s=!1){const i=s?hl:t.propsCache,n=i.get(e);if(n)return n;const r=e.props,o={},a=[];let h=!1;if(!G(e)){const c=f=>{h=!0;const[u,p]=_a(f,t,!0);ue(o,u),p&&a.push(...p)};!s&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!r&&!h)return se(e)&&i.set(e,$t),$t;if(q(r))for(let c=0;c<r.length;c++){const f=Me(r[c]);_r(f)&&(o[f]=K)}else if(r)for(const c in r){const f=Me(c);if(_r(f)){const u=r[c],p=o[f]=q(u)||G(u)?{type:u}:ue({},u),_=p.type;let R=!1,P=!0;if(q(_))for(let A=0;A<_.length;++A){const T=_[A],k=G(T)&&T.name;if(k==="Boolean"){R=!0;break}else k==="String"&&(P=!1)}else R=G(_)&&_.name==="Boolean";p[0]=R,p[1]=P,(R||Y(p,"default"))&&a.push(f)}}const l=[o,a];return se(e)&&i.set(e,l),l}function _r(e){return e[0]!=="$"&&!fs(e)}const Ra=e=>e[0]==="_"||e==="$stable",zn=e=>q(e)?e.map(ze):[ze(e)],cl=(e,t,s)=>{if(t._n)return t;const i=na((...n)=>zn(t(...n)),s);return i._c=!1,i},xa=(e,t,s)=>{const i=e._ctx;for(const n in e){if(Ra(n))continue;const r=e[n];if(G(r))t[n]=cl(n,r,i);else if(r!=null){const o=zn(r);t[n]=()=>o}}},Sa=(e,t)=>{const s=zn(t);e.slots.default=()=>s},Ca=(e,t,s)=>{for(const i in t)(s||i!=="_")&&(e[i]=t[i])},ll=(e,t,s)=>{const i=e.slots=da();if(e.vnode.shapeFlag&32){const n=t._;n?(Ca(i,t,s),s&&Po(i,"_",n,!0)):xa(t,i)}else t&&Sa(e,t)},fl=(e,t,s)=>{const{vnode:i,slots:n}=e;let r=!0,o=K;if(i.shapeFlag&32){const a=t._;a?s&&a===1?r=!1:Ca(n,t,s):(r=!t.$stable,xa(t,n)),o=t}else t&&(Sa(e,t),o={default:1});if(r)for(const a in n)!Ra(a)&&o[a]==null&&delete n[a]},Ae=Tl;function ul(e){return pl(e)}function pl(e,t){const s=li();s.__VUE__=!0;const{insert:i,remove:n,patchProp:r,createElement:o,createText:a,createComment:h,setText:l,setElementText:c,parentNode:f,nextSibling:u,setScopeId:p=Ze,insertStaticContent:_}=e,R=(d,m,g,x=null,b=null,C=null,I=void 0,D=null,E=!!m.dynamicChildren)=>{if(d===m)return;d&&!as(d,m)&&(x=S(d),xe(d,b,C,!0),d=null),m.patchFlag===-2&&(E=!1,m.dynamicChildren=null);const{type:y,ref:w,shapeFlag:N}=m;switch(y){case Ri:P(d,m,g,x);break;case Zt:A(d,m,g,x);break;case ki:d==null&&T(m,g,x,I);break;case ke:vt(d,m,g,x,b,C,I,D,E);break;default:N&1?j(d,m,g,x,b,C,I,D,E):N&6?je(d,m,g,x,b,C,I,D,E):(N&64||N&128)&&y.process(d,m,g,x,b,C,I,D,E,L)}w!=null&&b&&ei(w,d&&d.ref,C,m||d,!m)},P=(d,m,g,x)=>{if(d==null)i(m.el=a(m.children),g,x);else{const b=m.el=d.el;m.children!==d.children&&l(b,m.children)}},A=(d,m,g,x)=>{d==null?i(m.el=h(m.children||""),g,x):m.el=d.el},T=(d,m,g,x)=>{[d.el,d.anchor]=_(d.children,m,g,x,d.el,d.anchor)},k=({el:d,anchor:m},g,x)=>{let b;for(;d&&d!==m;)b=u(d),i(d,g,x),d=b;i(m,g,x)},v=({el:d,anchor:m})=>{let g;for(;d&&d!==m;)g=u(d),n(d),d=g;n(m)},j=(d,m,g,x,b,C,I,D,E)=>{m.type==="svg"?I="svg":m.type==="math"&&(I="mathml"),d==null?te(m,g,x,b,C,I,D,E):ct(d,m,b,C,I,D,E)},te=(d,m,g,x,b,C,I,D)=>{let E,y;const{props:w,shapeFlag:N,transition:B,dirs:V}=d;if(E=d.el=o(d.type,C,w&&w.is,w),N&8?c(E,d.children):N&16&&Ge(d.children,E,null,x,b,Pi(d,C),I,D),V&&Tt(d,null,x,"created"),z(E,d,d.scopeId,I,x),w){for(const Q in w)Q!=="value"&&!fs(Q)&&r(E,Q,null,w[Q],C,x);"value"in w&&r(E,"value",null,w.value,C),(y=w.onVnodeBeforeMount)&&Ye(y,x,d)}V&&Tt(d,null,x,"beforeMount");const U=dl(b,B);U&&B.beforeEnter(E),i(E,m,g),((y=w&&w.onVnodeMounted)||U||V)&&Ae(()=>{y&&Ye(y,x,d),U&&B.enter(E),V&&Tt(d,null,x,"mounted")},b)},z=(d,m,g,x,b)=>{if(g&&p(d,g),x)for(let C=0;C<x.length;C++)p(d,x[C]);if(b){let C=b.subTree;if(m===C||Aa(C.type)&&(C.ssContent===m||C.ssFallback===m)){const I=b.vnode;z(d,I,I.scopeId,I.slotScopeIds,b.parent)}}},Ge=(d,m,g,x,b,C,I,D,E=0)=>{for(let y=E;y<d.length;y++){const w=d[y]=D?_t(d[y]):ze(d[y]);R(null,w,m,g,x,b,C,I,D)}},ct=(d,m,g,x,b,C,I)=>{const D=m.el=d.el;let{patchFlag:E,dynamicChildren:y,dirs:w}=m;E|=d.patchFlag&16;const N=d.props||K,B=m.props||K;let V;if(g&&Et(g,!1),(V=B.onVnodeBeforeUpdate)&&Ye(V,g,m,d),w&&Tt(m,d,g,"beforeUpdate"),g&&Et(g,!0),(N.innerHTML&&B.innerHTML==null||N.textContent&&B.textContent==null)&&c(D,""),y?qe(d.dynamicChildren,y,D,g,x,Pi(m,b),C):I||$(d,m,D,null,g,x,Pi(m,b),C,!1),E>0){if(E&16)lt(D,N,B,g,b);else if(E&2&&N.class!==B.class&&r(D,"class",null,B.class,b),E&4&&r(D,"style",N.style,B.style,b),E&8){const U=m.dynamicProps;for(let Q=0;Q<U.length;Q++){const W=U[Q],ve=N[W],Se=B[W];(Se!==ve||W==="value")&&r(D,W,ve,Se,b,g)}}E&1&&d.children!==m.children&&c(D,m.children)}else!I&&y==null&&lt(D,N,B,g,b);((V=B.onVnodeUpdated)||w)&&Ae(()=>{V&&Ye(V,g,m,d),w&&Tt(m,d,g,"updated")},x)},qe=(d,m,g,x,b,C,I)=>{for(let D=0;D<m.length;D++){const E=d[D],y=m[D],w=E.el&&(E.type===ke||!as(E,y)||E.shapeFlag&70)?f(E.el):g;R(E,y,w,null,x,b,C,I,!0)}},lt=(d,m,g,x,b)=>{if(m!==g){if(m!==K)for(const C in m)!fs(C)&&!(C in g)&&r(d,C,m[C],null,b,x);for(const C in g){if(fs(C))continue;const I=g[C],D=m[C];I!==D&&C!=="value"&&r(d,C,D,I,b,x)}"value"in g&&r(d,"value",m.value,g.value,b)}},vt=(d,m,g,x,b,C,I,D,E)=>{const y=m.el=d?d.el:a(""),w=m.anchor=d?d.anchor:a("");let{patchFlag:N,dynamicChildren:B,slotScopeIds:V}=m;V&&(D=D?D.concat(V):V),d==null?(i(y,g,x),i(w,g,x),Ge(m.children||[],g,w,b,C,I,D,E)):N>0&&N&64&&B&&d.dynamicChildren?(qe(d.dynamicChildren,B,g,b,C,I,D),(m.key!=null||b&&m===b.subTree)&&ba(d,m,!0)):$(d,m,g,w,b,C,I,D,E)},je=(d,m,g,x,b,C,I,D,E)=>{m.slotScopeIds=D,d==null?m.shapeFlag&512?b.ctx.activate(m,g,x,I,E):is(m,g,x,b,C,I,E):Lt(d,m,E)},is=(d,m,g,x,b,C,I)=>{const D=d.component=kl(d,x,b);if(oa(d)&&(D.ctx.renderer=L),Nl(D,!1,I),D.asyncDep){if(b&&b.registerDep(D,oe,I),!d.el){const E=D.subTree=ye(Zt);A(null,E,m,g)}}else oe(D,d,m,g,b,C,I)},Lt=(d,m,g)=>{const x=m.component=d.component;if(yl(d,m,g))if(x.asyncDep&&!x.asyncResolved){J(x,m,g);return}else x.next=m,x.update();else m.el=d.el,x.vnode=m},oe=(d,m,g,x,b,C,I)=>{const D=()=>{if(d.isMounted){let{next:N,bu:B,u:V,parent:U,vnode:Q}=d;{const He=ya(d);if(He){N&&(N.el=Q.el,J(d,N,I)),He.asyncDep.then(()=>{d.isUnmounted||D()});return}}let W=N,ve;Et(d,!1),N?(N.el=Q.el,J(d,N,I)):N=Q,B&&Gs(B),(ve=N.props&&N.props.onVnodeBeforeUpdate)&&Ye(ve,U,N,Q),Et(d,!0);const Se=xr(d),$e=d.subTree;d.subTree=Se,R($e,Se,f($e.el),S($e),d,b,C),N.el=Se.el,W===null&&vl(d,Se.el),V&&Ae(V,b),(ve=N.props&&N.props.onVnodeUpdated)&&Ae(()=>Ye(ve,U,N,Q),b)}else{let N;const{el:B,props:V}=m,{bm:U,m:Q,parent:W,root:ve,type:Se}=d,$e=Yt(m);Et(d,!1),U&&Gs(U),!$e&&(N=V&&V.onVnodeBeforeMount)&&Ye(N,W,m),Et(d,!0);{ve.ce&&ve.ce._injectChildStyle(Se);const He=d.subTree=xr(d);R(null,He,g,x,d,b,C),m.el=He.el}if(Q&&Ae(Q,b),!$e&&(N=V&&V.onVnodeMounted)){const He=m;Ae(()=>Ye(N,W,He),b)}(m.shapeFlag&256||W&&Yt(W.vnode)&&W.vnode.shapeFlag&256)&&d.a&&Ae(d.a,b),d.isMounted=!0,m=g=x=null}};d.scope.on();const E=d.effect=new Lo(D);d.scope.off();const y=d.update=E.run.bind(E),w=d.job=E.runIfDirty.bind(E);w.i=d,w.id=d.uid,E.scheduler=()=>Yn(w),Et(d,!0),y()},J=(d,m,g)=>{m.component=d;const x=d.vnode.props;d.vnode=m,d.next=null,al(d,m.props,x,g),fl(d,m.children,g),bt(),fr(d),yt()},$=(d,m,g,x,b,C,I,D,E=!1)=>{const y=d&&d.children,w=d?d.shapeFlag:0,N=m.children,{patchFlag:B,shapeFlag:V}=m;if(B>0){if(B&128){ft(y,N,g,x,b,C,I,D,E);return}else if(B&256){et(y,N,g,x,b,C,I,D,E);return}}V&8?(w&16&&Pe(y,b,C),N!==y&&c(g,N)):w&16?V&16?ft(y,N,g,x,b,C,I,D,E):Pe(y,b,C,!0):(w&8&&c(g,""),V&16&&Ge(N,g,x,b,C,I,D,E))},et=(d,m,g,x,b,C,I,D,E)=>{d=d||$t,m=m||$t;const y=d.length,w=m.length,N=Math.min(y,w);let B;for(B=0;B<N;B++){const V=m[B]=E?_t(m[B]):ze(m[B]);R(d[B],V,g,null,b,C,I,D,E)}y>w?Pe(d,b,C,!0,!1,N):Ge(m,g,x,b,C,I,D,E,N)},ft=(d,m,g,x,b,C,I,D,E)=>{let y=0;const w=m.length;let N=d.length-1,B=w-1;for(;y<=N&&y<=B;){const V=d[y],U=m[y]=E?_t(m[y]):ze(m[y]);if(as(V,U))R(V,U,g,null,b,C,I,D,E);else break;y++}for(;y<=N&&y<=B;){const V=d[N],U=m[B]=E?_t(m[B]):ze(m[B]);if(as(V,U))R(V,U,g,null,b,C,I,D,E);else break;N--,B--}if(y>N){if(y<=B){const V=B+1,U=V<w?m[V].el:x;for(;y<=B;)R(null,m[y]=E?_t(m[y]):ze(m[y]),g,U,b,C,I,D,E),y++}}else if(y>B)for(;y<=N;)xe(d[y],b,C,!0),y++;else{const V=y,U=y,Q=new Map;for(y=U;y<=B;y++){const Te=m[y]=E?_t(m[y]):ze(m[y]);Te.key!=null&&Q.set(Te.key,y)}let W,ve=0;const Se=B-U+1;let $e=!1,He=0;const ns=new Array(Se);for(y=0;y<Se;y++)ns[y]=0;for(y=V;y<=N;y++){const Te=d[y];if(ve>=Se){xe(Te,b,C,!0);continue}let Xe;if(Te.key!=null)Xe=Q.get(Te.key);else for(W=U;W<=B;W++)if(ns[W-U]===0&&as(Te,m[W])){Xe=W;break}Xe===void 0?xe(Te,b,C,!0):(ns[Xe-U]=y+1,Xe>=He?He=Xe:$e=!0,R(Te,m[Xe],g,null,b,C,I,D,E),ve++)}const nr=$e?ml(ns):$t;for(W=nr.length-1,y=Se-1;y>=0;y--){const Te=U+y,Xe=m[Te],rr=Te+1<w?m[Te+1].el:x;ns[y]===0?R(null,Xe,g,rr,b,C,I,D,E):$e&&(W<0||y!==nr[W]?Ue(Xe,g,rr,2):W--)}}},Ue=(d,m,g,x,b=null)=>{const{el:C,type:I,transition:D,children:E,shapeFlag:y}=d;if(y&6){Ue(d.component.subTree,m,g,x);return}if(y&128){d.suspense.move(m,g,x);return}if(y&64){I.move(d,m,g,L);return}if(I===ke){i(C,m,g);for(let N=0;N<E.length;N++)Ue(E[N],m,g,x);i(d.anchor,m,g);return}if(I===ki){k(d,m,g);return}if(x!==2&&y&1&&D)if(x===0)D.beforeEnter(C),i(C,m,g),Ae(()=>D.enter(C),b);else{const{leave:N,delayLeave:B,afterLeave:V}=D,U=()=>i(C,m,g),Q=()=>{N(C,()=>{U(),V&&V()})};B?B(C,U,Q):Q()}else i(C,m,g)},xe=(d,m,g,x=!1,b=!1)=>{const{type:C,props:I,ref:D,children:E,dynamicChildren:y,shapeFlag:w,patchFlag:N,dirs:B,cacheIndex:V}=d;if(N===-2&&(b=!1),D!=null&&ei(D,null,g,d,!0),V!=null&&(m.renderCache[V]=void 0),w&256){m.ctx.deactivate(d);return}const U=w&1&&B,Q=!Yt(d);let W;if(Q&&(W=I&&I.onVnodeBeforeUnmount)&&Ye(W,m,d),w&6)Fs(d.component,g,x);else{if(w&128){d.suspense.unmount(g,x);return}U&&Tt(d,null,m,"beforeUnmount"),w&64?d.type.remove(d,m,g,L,x):y&&!y.hasOnce&&(C!==ke||N>0&&N&64)?Pe(y,m,g,!1,!0):(C===ke&&N&384||!b&&w&16)&&Pe(E,m,g),x&&Bt(d)}(Q&&(W=I&&I.onVnodeUnmounted)||U)&&Ae(()=>{W&&Ye(W,m,d),U&&Tt(d,null,m,"unmounted")},g)},Bt=d=>{const{type:m,el:g,anchor:x,transition:b}=d;if(m===ke){wt(g,x);return}if(m===ki){v(d);return}const C=()=>{n(g),b&&!b.persisted&&b.afterLeave&&b.afterLeave()};if(d.shapeFlag&1&&b&&!b.persisted){const{leave:I,delayLeave:D}=b,E=()=>I(g,C);D?D(d.el,C,E):E()}else C()},wt=(d,m)=>{let g;for(;d!==m;)g=u(d),n(d),d=g;n(m)},Fs=(d,m,g)=>{const{bum:x,scope:b,job:C,subTree:I,um:D,m:E,a:y}=d;Rr(E),Rr(y),x&&Gs(x),b.stop(),C&&(C.flags|=8,xe(I,d,m,g)),D&&Ae(D,m),Ae(()=>{d.isUnmounted=!0},m),m&&m.pendingBranch&&!m.isUnmounted&&d.asyncDep&&!d.asyncResolved&&d.suspenseId===m.pendingId&&(m.deps--,m.deps===0&&m.resolve())},Pe=(d,m,g,x=!1,b=!1,C=0)=>{for(let I=C;I<d.length;I++)xe(d[I],m,g,x,b)},S=d=>{if(d.shapeFlag&6)return S(d.component.subTree);if(d.shapeFlag&128)return d.suspense.next();const m=u(d.anchor||d.el),g=m&&m[Mc];return g?u(g):m};let M=!1;const O=(d,m,g)=>{d==null?m._vnode&&xe(m._vnode,null,null,!0):R(m._vnode||null,d,m,null,null,null,g),m._vnode=d,M||(M=!0,fr(),ta(),M=!1)},L={p:R,um:xe,m:Ue,r:Bt,mt:is,mc:Ge,pc:$,pbc:qe,n:S,o:e};return{render:O,hydrate:void 0,createApp:rl(O)}}function Pi({type:e,props:t},s){return s==="svg"&&e==="foreignObject"||s==="mathml"&&e==="annotation-xml"&&t&&t.encoding&&t.encoding.includes("html")?void 0:s}function Et({effect:e,job:t},s){s?(e.flags|=32,t.flags|=4):(e.flags&=-33,t.flags&=-5)}function dl(e,t){return(!e||e&&!e.pendingBranch)&&t&&!t.persisted}function ba(e,t,s=!1){const i=e.children,n=t.children;if(q(i)&&q(n))for(let r=0;r<i.length;r++){const o=i[r];let a=n[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=n[r]=_t(n[r]),a.el=o.el),!s&&a.patchFlag!==-2&&ba(o,a)),a.type===Ri&&(a.el=o.el)}}function ml(e){const t=e.slice(),s=[0];let i,n,r,o,a;const h=e.length;for(i=0;i<h;i++){const l=e[i];if(l!==0){if(n=s[s.length-1],e[n]<l){t[i]=n,s.push(i);continue}for(r=0,o=s.length-1;r<o;)a=r+o>>1,e[s[a]]<l?r=a+1:o=a;l<e[s[r]]&&(r>0&&(t[i]=s[r-1]),s[r]=i)}}for(r=s.length,o=s[r-1];r-- >0;)s[r]=o,o=t[o];return s}function ya(e){const t=e.subTree.component;if(t)return t.asyncDep&&!t.asyncResolved?t:ya(t)}function Rr(e){if(e)for(let t=0;t<e.length;t++)e[t].flags|=8}const gl=Symbol.for("v-scx"),_l=()=>we(gl);function Ct(e,t,s){return va(e,t,s)}function va(e,t,s=K){const{immediate:i,deep:n,flush:r,once:o}=s,a=ue({},s),h=t&&i||!t&&r!=="post";let l;if(As){if(r==="sync"){const p=_l();l=p.__watcherHandles||(p.__watcherHandles=[])}else if(!h){const p=()=>{};return p.stop=Ze,p.resume=Ze,p.pause=Ze,p}}const c=le;a.call=(p,_,R)=>Qe(p,c,_,R);let f=!1;r==="post"?a.scheduler=p=>{Ae(p,c&&c.suspense)}:r!=="sync"&&(f=!0,a.scheduler=(p,_)=>{_?p():Yn(p)}),a.augmentJob=p=>{t&&(p.flags|=4),f&&(p.flags|=2,c&&(p.id=c.uid,p.i=c))};const u=Oc(e,t,a);return As&&(l?l.push(u):h&&u()),u}function Rl(e,t,s){const i=this.proxy,n=re(e)?e.includes(".")?Ta(i,e):()=>i[e]:e.bind(i,i);let r;G(t)?r=t:(r=t.handler,s=t);const o=Ms(this),a=va(n,r.bind(i),s);return o(),a}function Ta(e,t){const s=t.split(".");return()=>{let i=e;for(let n=0;n<s.length&&i;n++)i=i[s[n]];return i}}const xl=(e,t)=>t==="modelValue"||t==="model-value"?e.modelModifiers:e[`${t}Modifiers`]||e[`${Me(t)}Modifiers`]||e[`${kt(t)}Modifiers`];function Sl(e,t,...s){if(e.isUnmounted)return;const i=e.vnode.props||K;let n=s;const r=t.startsWith("update:"),o=r&&xl(i,t.slice(7));o&&(o.trim&&(n=s.map(c=>re(c)?c.trim():c)),o.number&&(n=s.map(tn)));let a,h=i[a=Ti(t)]||i[a=Ti(Me(t))];!h&&r&&(h=i[a=Ti(kt(t))]),h&&Qe(h,e,6,n);const l=i[a+"Once"];if(l){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,Qe(l,e,6,n)}}function Ea(e,t,s=!1){const i=t.emitsCache,n=i.get(e);if(n!==void 0)return n;const r=e.emits;let o={},a=!1;if(!G(e)){const h=l=>{const c=Ea(l,t,!0);c&&(a=!0,ue(o,c))};!s&&t.mixins.length&&t.mixins.forEach(h),e.extends&&h(e.extends),e.mixins&&e.mixins.forEach(h)}return!r&&!a?(se(e)&&i.set(e,null),null):(q(r)?r.forEach(h=>o[h]=null):ue(o,r),se(e)&&i.set(e,o),o)}function _i(e,t){return!e||!oi(t)?!1:(t=t.slice(2).replace(/Once$/,""),Y(e,t[0].toLowerCase()+t.slice(1))||Y(e,kt(t))||Y(e,t))}function xr(e){const{type:t,vnode:s,proxy:i,withProxy:n,propsOptions:[r],slots:o,attrs:a,emit:h,render:l,renderCache:c,props:f,data:u,setupState:p,ctx:_,inheritAttrs:R}=e,P=Qs(e);let A,T;try{if(s.shapeFlag&4){const v=n||i,j=v;A=ze(l.call(j,v,c,f,p,u,_)),T=a}else{const v=t;A=ze(v.length>1?v(f,{attrs:a,slots:o,emit:h}):v(f,null)),T=t.props?a:Cl(a)}}catch(v){gs.length=0,pi(v,e,1),A=ye(Zt)}let k=A;if(T&&R!==!1){const v=Object.keys(T),{shapeFlag:j}=k;v.length&&j&7&&(r&&v.some(Mn)&&(T=bl(T,r)),k=Kt(k,T,!1,!0))}return s.dirs&&(k=Kt(k,null,!1,!0),k.dirs=k.dirs?k.dirs.concat(s.dirs):s.dirs),s.transition&&Wn(k,s.transition),A=k,Qs(P),A}const Cl=e=>{let t;for(const s in e)(s==="class"||s==="style"||oi(s))&&((t||(t={}))[s]=e[s]);return t},bl=(e,t)=>{const s={};for(const i in e)(!Mn(i)||!(i.slice(9)in t))&&(s[i]=e[i]);return s};function yl(e,t,s){const{props:i,children:n,component:r}=e,{props:o,children:a,patchFlag:h}=t,l=r.emitsOptions;if(t.dirs||t.transition)return!0;if(s&&h>=0){if(h&1024)return!0;if(h&16)return i?Sr(i,o,l):!!o;if(h&8){const c=t.dynamicProps;for(let f=0;f<c.length;f++){const u=c[f];if(o[u]!==i[u]&&!_i(l,u))return!0}}}else return(n||a)&&(!a||!a.$stable)?!0:i===o?!1:i?o?Sr(i,o,l):!0:!!o;return!1}function Sr(e,t,s){const i=Object.keys(t);if(i.length!==Object.keys(e).length)return!0;for(let n=0;n<i.length;n++){const r=i[n];if(t[r]!==e[r]&&!_i(s,r))return!0}return!1}function vl({vnode:e,parent:t},s){for(;t;){const i=t.subTree;if(i.suspense&&i.suspense.activeBranch===e&&(i.el=e.el),i===e)(e=t.vnode).el=s,t=t.parent;else break}}const Aa=e=>e.__isSuspense;function Tl(e,t){t&&t.pendingBranch?q(e)?t.effects.push(...e):t.effects.push(e):Nc(e)}const ke=Symbol.for("v-fgt"),Ri=Symbol.for("v-txt"),Zt=Symbol.for("v-cmt"),ki=Symbol.for("v-stc"),gs=[];let Ie=null;function vs(e=!1){gs.push(Ie=e?null:[])}function El(){gs.pop(),Ie=gs[gs.length-1]||null}let Ts=1;function Cr(e,t=!1){Ts+=e,e<0&&Ie&&t&&(Ie.hasOnce=!0)}function Da(e){return e.dynamicChildren=Ts>0?Ie||$t:null,El(),Ts>0&&Ie&&Ie.push(e),e}function Ia(e,t,s,i,n,r){return Da(Dt(e,t,s,i,n,r,!0))}function pn(e,t,s,i,n){return Da(ye(e,t,s,i,n,!0))}function Es(e){return e?e.__v_isVNode===!0:!1}function as(e,t){return e.type===t.type&&e.key===t.key}const Oa=({key:e})=>e??null,js=({ref:e,ref_key:t,ref_for:s})=>(typeof e=="number"&&(e=""+e),e!=null?re(e)||fe(e)||G(e)?{i:he,r:e,k:t,f:!!s}:e:null);function Dt(e,t=null,s=null,i=0,n=null,r=e===ke?0:1,o=!1,a=!1){const h={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Oa(t),ref:t&&js(t),scopeId:ia,slotScopeIds:null,children:s,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:i,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:he};return a?(Jn(h,s),r&128&&e.normalize(h)):s&&(h.shapeFlag|=re(s)?8:16),Ts>0&&!o&&Ie&&(h.patchFlag>0||r&6)&&h.patchFlag!==32&&Ie.push(h),h}const ye=Al;function Al(e,t=null,s=null,i=0,n=null,r=!1){if((!e||e===zc)&&(e=Zt),Es(e)){const a=Kt(e,t,!0);return s&&Jn(a,s),Ts>0&&!r&&Ie&&(a.shapeFlag&6?Ie[Ie.indexOf(e)]=a:Ie.push(a)),a.patchFlag=-2,a}if(wl(e)&&(e=e.__vccOpts),t){t=Dl(t);let{class:a,style:h}=t;a&&!re(a)&&(t.class=fi(a)),se(h)&&(Hn(h)&&!q(h)&&(h=ue({},h)),t.style=Bn(h))}const o=re(e)?1:Aa(e)?128:Fc(e)?64:se(e)?4:G(e)?2:0;return Dt(e,t,s,i,n,o,r,!0)}function Dl(e){return e?Hn(e)||ma(e)?ue({},e):e:null}function Kt(e,t,s=!1,i=!1){const{props:n,ref:r,patchFlag:o,children:a,transition:h}=e,l=t?Il(n||{},t):n,c={__v_isVNode:!0,__v_skip:!0,type:e.type,props:l,key:l&&Oa(l),ref:t&&t.ref?s&&r?q(r)?r.concat(js(t)):[r,js(t)]:js(t):r,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==ke?o===-1?16:o|16:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:h,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Kt(e.ssContent),ssFallback:e.ssFallback&&Kt(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return h&&i&&Wn(c,h.clone(c)),c}function Pa(e=" ",t=0){return ye(Ri,null,e,t)}function ze(e){return e==null||typeof e=="boolean"?ye(Zt):q(e)?ye(ke,null,e.slice()):Es(e)?_t(e):ye(Ri,null,String(e))}function _t(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Kt(e)}function Jn(e,t){let s=0;const{shapeFlag:i}=e;if(t==null)t=null;else if(q(t))s=16;else if(typeof t=="object")if(i&65){const n=t.default;n&&(n._c&&(n._d=!1),Jn(e,n()),n._c&&(n._d=!0));return}else{s=32;const n=t._;!n&&!ma(t)?t._ctx=he:n===3&&he&&(he.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else G(t)?(t={default:t,_ctx:he},s=32):(t=String(t),i&64?(s=16,t=[Pa(t)]):s=8);e.children=t,e.shapeFlag|=s}function Il(...e){const t={};for(let s=0;s<e.length;s++){const i=e[s];for(const n in i)if(n==="class")t.class!==i.class&&(t.class=fi([t.class,i.class]));else if(n==="style")t.style=Bn([t.style,i.style]);else if(oi(n)){const r=t[n],o=i[n];o&&r!==o&&!(q(r)&&r.includes(o))&&(t[n]=r?[].concat(r,o):o)}else n!==""&&(t[n]=i[n])}return t}function Ye(e,t,s,i=null){Qe(e,t,7,[s,i])}const Ol=ua();let Pl=0;function kl(e,t,s){const i=e.type,n=(t?t.appContext:e.appContext)||Ol,r={uid:Pl++,vnode:e,type:i,parent:t,appContext:n,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new tc(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(n.provides),ids:t?t.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:_a(i,n),emitsOptions:Ea(i,n),emit:null,emitted:null,propsDefaults:K,inheritAttrs:i.inheritAttrs,ctx:K,data:K,props:K,attrs:K,slots:K,refs:K,setupState:K,setupContext:null,suspense:s,suspenseId:s?s.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=Sl.bind(null,r),e.ce&&e.ce(r),r}let le=null,si,dn;{const e=li(),t=(s,i)=>{let n;return(n=e[s])||(n=e[s]=[]),n.push(i),r=>{n.length>1?n.forEach(o=>o(r)):n[0](r)}};si=t("__VUE_INSTANCE_SETTERS__",s=>le=s),dn=t("__VUE_SSR_SETTERS__",s=>As=s)}const Ms=e=>{const t=le;return si(e),e.scope.on(),()=>{e.scope.off(),si(t)}},br=()=>{le&&le.scope.off(),si(null)};function ka(e){return e.vnode.shapeFlag&4}let As=!1;function Nl(e,t=!1,s=!1){t&&dn(t);const{props:i,children:n}=e.vnode,r=ka(e);ol(e,i,r,t),ll(e,n,s);const o=r?Ml(e,t):void 0;return t&&dn(!1),o}function Ml(e,t){const s=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,Kc);const{setup:i}=s;if(i){bt();const n=e.setupContext=i.length>1?Ll(e):null,r=Ms(e),o=Ns(i,e,0,[e.props,n]),a=Do(o);if(yt(),r(),(a||e.sp)&&!Yt(e)&&ra(e),a){if(o.then(br,br),t)return o.then(h=>{yr(e,h)}).catch(h=>{pi(h,e,0)});e.asyncDep=o}else yr(e,o)}else Na(e)}function yr(e,t,s){G(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:se(t)&&(e.setupState=Ko(t)),Na(e)}function Na(e,t,s){const i=e.type;e.render||(e.render=i.render||Ze);{const n=Ms(e);bt();try{Qc(e)}finally{yt(),n()}}}const Fl={get(e,t){return ce(e,"get",""),e[t]}};function Ll(e){const t=s=>{e.exposed=s||{}};return{attrs:new Proxy(e.attrs,Fl),slots:e.slots,emit:e.emit,expose:t}}function xi(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(Ko(Cc(e.exposed)),{get(t,s){if(s in t)return t[s];if(s in ms)return ms[s](e)},has(t,s){return s in t||s in ms}})):e.proxy}function Bl(e,t=!0){return G(e)?e.displayName||e.name:e.name||t&&e.__name}function wl(e){return G(e)&&"__vccOpts"in e}const Ne=(e,t)=>Dc(e,t,As);function Ma(e,t,s){const i=arguments.length;return i===2?se(t)&&!q(t)?Es(t)?ye(e,null,[t]):ye(e,t):ye(e,null,t):(i>3?s=Array.prototype.slice.call(arguments,2):i===3&&Es(s)&&(s=[s]),ye(e,t,s))}const Vl="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let mn;const vr=typeof window<"u"&&window.trustedTypes;if(vr)try{mn=vr.createPolicy("vue",{createHTML:e=>e})}catch{}const Fa=mn?e=>mn.createHTML(e):e=>e,Gl="http://www.w3.org/2000/svg",ql="http://www.w3.org/1998/Math/MathML",it=typeof document<"u"?document:null,Tr=it&&it.createElement("template"),jl={insert:(e,t,s)=>{t.insertBefore(e,s||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,s,i)=>{const n=t==="svg"?it.createElementNS(Gl,e):t==="mathml"?it.createElementNS(ql,e):s?it.createElement(e,{is:s}):it.createElement(e);return e==="select"&&i&&i.multiple!=null&&n.setAttribute("multiple",i.multiple),n},createText:e=>it.createTextNode(e),createComment:e=>it.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>it.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,s,i,n,r){const o=s?s.previousSibling:t.lastChild;if(n&&(n===r||n.nextSibling))for(;t.insertBefore(n.cloneNode(!0),s),!(n===r||!(n=n.nextSibling)););else{Tr.innerHTML=Fa(i==="svg"?`<svg>${e}</svg>`:i==="mathml"?`<math>${e}</math>`:e);const a=Tr.content;if(i==="svg"||i==="mathml"){const h=a.firstChild;for(;h.firstChild;)a.appendChild(h.firstChild);a.removeChild(h)}t.insertBefore(a,s)}return[o?o.nextSibling:t.firstChild,s?s.previousSibling:t.lastChild]}},Ul=Symbol("_vtc");function $l(e,t,s){const i=e[Ul];i&&(t=(t?[t,...i]:[...i]).join(" ")),t==null?e.removeAttribute("class"):s?e.setAttribute("class",t):e.className=t}const Er=Symbol("_vod"),Hl=Symbol("_vsh"),Xl=Symbol(""),Yl=/(^|;)\s*display\s*:/;function Wl(e,t,s){const i=e.style,n=re(s);let r=!1;if(s&&!n){if(t)if(re(t))for(const o of t.split(";")){const a=o.slice(0,o.indexOf(":")).trim();s[a]==null&&Us(i,a,"")}else for(const o in t)s[o]==null&&Us(i,o,"");for(const o in s)o==="display"&&(r=!0),Us(i,o,s[o])}else if(n){if(t!==s){const o=i[Xl];o&&(s+=";"+o),i.cssText=s,r=Yl.test(s)}}else t&&e.removeAttribute("style");Er in e&&(e[Er]=r?i.display:"",e[Hl]&&(i.display="none"))}const Ar=/\s*!important$/;function Us(e,t,s){if(q(s))s.forEach(i=>Us(e,t,i));else if(s==null&&(s=""),t.startsWith("--"))e.setProperty(t,s);else{const i=zl(e,t);Ar.test(s)?e.setProperty(kt(i),s.replace(Ar,""),"important"):e[i]=s}}const Dr=["Webkit","Moz","ms"],Ni={};function zl(e,t){const s=Ni[t];if(s)return s;let i=Me(t);if(i!=="filter"&&i in e)return Ni[t]=i;i=ci(i);for(let n=0;n<Dr.length;n++){const r=Dr[n]+i;if(r in e)return Ni[t]=r}return t}const Ir="http://www.w3.org/1999/xlink";function Or(e,t,s,i,n,r=ec(t)){i&&t.startsWith("xlink:")?s==null?e.removeAttributeNS(Ir,t.slice(6,t.length)):e.setAttributeNS(Ir,t,s):s==null||r&&!ko(s)?e.removeAttribute(t):e.setAttribute(t,r?"":at(s)?String(s):s)}function Pr(e,t,s,i,n){if(t==="innerHTML"||t==="textContent"){s!=null&&(e[t]=t==="innerHTML"?Fa(s):s);return}const r=e.tagName;if(t==="value"&&r!=="PROGRESS"&&!r.includes("-")){const a=r==="OPTION"?e.getAttribute("value")||"":e.value,h=s==null?e.type==="checkbox"?"on":"":String(s);(a!==h||!("_value"in e))&&(e.value=h),s==null&&e.removeAttribute(t),e._value=s;return}let o=!1;if(s===""||s==null){const a=typeof e[t];a==="boolean"?s=ko(s):s==null&&a==="string"?(s="",o=!0):a==="number"&&(s=0,o=!0)}try{e[t]=s}catch{}o&&e.removeAttribute(n||t)}function qt(e,t,s,i){e.addEventListener(t,s,i)}function Jl(e,t,s,i){e.removeEventListener(t,s,i)}const kr=Symbol("_vei");function Zl(e,t,s,i,n=null){const r=e[kr]||(e[kr]={}),o=r[t];if(i&&o)o.value=i;else{const[a,h]=Kl(t);if(i){const l=r[t]=tf(i,n);qt(e,a,l,h)}else o&&(Jl(e,a,o,h),r[t]=void 0)}}const Nr=/(?:Once|Passive|Capture)$/;function Kl(e){let t;if(Nr.test(e)){t={};let i;for(;i=e.match(Nr);)e=e.slice(0,e.length-i[0].length),t[i[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):kt(e.slice(2)),t]}let Mi=0;const Ql=Promise.resolve(),ef=()=>Mi||(Ql.then(()=>Mi=0),Mi=Date.now());function tf(e,t){const s=i=>{if(!i._vts)i._vts=Date.now();else if(i._vts<=s.attached)return;Qe(sf(i,s.value),t,5,[i])};return s.value=e,s.attached=ef(),s}function sf(e,t){if(q(t)){const s=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{s.call(e),e._stopped=!0},t.map(i=>n=>!n._stopped&&i&&i(n))}else return t}const Mr=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,nf=(e,t,s,i,n,r)=>{const o=n==="svg";t==="class"?$l(e,i,o):t==="style"?Wl(e,s,i):oi(t)?Mn(t)||Zl(e,t,s,i,r):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):rf(e,t,i,o))?(Pr(e,t,i),!e.tagName.includes("-")&&(t==="value"||t==="checked"||t==="selected")&&Or(e,t,i,o,r,t!=="value")):e._isVueCE&&(/[A-Z]/.test(t)||!re(i))?Pr(e,Me(t),i,r,t):(t==="true-value"?e._trueValue=i:t==="false-value"&&(e._falseValue=i),Or(e,t,i,o))};function rf(e,t,s,i){if(i)return!!(t==="innerHTML"||t==="textContent"||t in e&&Mr(t)&&G(s));if(t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA")return!1;if(t==="width"||t==="height"){const n=e.tagName;if(n==="IMG"||n==="VIDEO"||n==="CANVAS"||n==="SOURCE")return!1}return Mr(t)&&re(s)?!1:t in e}const Fr=e=>{const t=e.props["onUpdate:modelValue"]||!1;return q(t)?s=>Gs(t,s):t};function of(e){e.target.composing=!0}function Lr(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Fi=Symbol("_assign"),Lp={created(e,{modifiers:{lazy:t,trim:s,number:i}},n){e[Fi]=Fr(n);const r=i||n.props&&n.props.type==="number";qt(e,t?"change":"input",o=>{if(o.target.composing)return;let a=e.value;s&&(a=a.trim()),r&&(a=tn(a)),e[Fi](a)}),s&&qt(e,"change",()=>{e.value=e.value.trim()}),t||(qt(e,"compositionstart",of),qt(e,"compositionend",Lr),qt(e,"change",Lr))},mounted(e,{value:t}){e.value=t??""},beforeUpdate(e,{value:t,oldValue:s,modifiers:{lazy:i,trim:n,number:r}},o){if(e[Fi]=Fr(o),e.composing)return;const a=(r||e.type==="number")&&!/^0\d/.test(e.value)?tn(e.value):e.value,h=t??"";a!==h&&(document.activeElement===e&&e.type!=="range"&&(i&&t===s||n&&e.value.trim()===h)||(e.value=h))}},af=ue({patchProp:nf},jl);let Br;function hf(){return Br||(Br=ul(af))}const cf=(...e)=>{const t=hf().createApp(...e),{mount:s}=t;return t.mount=i=>{const n=ff(i);if(!n)return;const r=t._component;!G(r)&&!r.render&&!r.template&&(r.template=n.innerHTML),n.nodeType===1&&(n.textContent="");const o=s(n,!1,lf(n));return n instanceof Element&&(n.removeAttribute("v-cloak"),n.setAttribute("data-v-app","")),o},t};function lf(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function ff(e){return re(e)?document.querySelector(e):e}const uf=["disabled"],pf=di({__name:"NButton",props:{theme:{default:"primary"},disabled:{type:Boolean}},setup(e){return(t,s)=>(vs(),Ia("button",{class:fi(["nes-btn",`is-${t.theme}`,{"is-disabled":t.disabled}]),disabled:t.disabled},[Zc(t.$slots,"default")],10,uf))}});function La(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Li,wr;function Ba(){if(wr)return Li;wr=1;var e=function(){this.state=new Array(8);for(var t=0;t<this.state.length;t++)this.state[t]=64};return e.BUTTON_A=0,e.BUTTON_B=1,e.BUTTON_SELECT=2,e.BUTTON_START=3,e.BUTTON_UP=4,e.BUTTON_DOWN=5,e.BUTTON_LEFT=6,e.BUTTON_RIGHT=7,e.prototype={buttonDown:function(t){this.state[t]=65},buttonUp:function(t){this.state[t]=64}},Li=e,Li}var Bi,Vr;function Si(){return Vr||(Vr=1,Bi={copyArrayElements:function(e,t,s,i,n){for(var r=0;r<n;++r)s[i+r]=e[t+r]},copyArray:function(e){return e.slice(0)},fromJSON:function(e,t){for(var s=0;s<e.JSON_PROPERTIES.length;s++)e[e.JSON_PROPERTIES[s]]=t[e.JSON_PROPERTIES[s]]},toJSON:function(e){for(var t={},s=0;s<e.JSON_PROPERTIES.length;s++)t[e.JSON_PROPERTIES[s]]=e[e.JSON_PROPERTIES[s]];return t}}),Bi}var wi,Gr;function df(){if(Gr)return wi;Gr=1;var e=Si(),t=function(i){this.nes=i,this.mem=null,this.REG_ACC=null,this.REG_X=null,this.REG_Y=null,this.REG_SP=null,this.REG_PC=null,this.REG_PC_NEW=null,this.REG_STATUS=null,this.F_CARRY=null,this.F_DECIMAL=null,this.F_INTERRUPT=null,this.F_INTERRUPT_NEW=null,this.F_OVERFLOW=null,this.F_SIGN=null,this.F_ZERO=null,this.F_NOTUSED=null,this.F_NOTUSED_NEW=null,this.F_BRK=null,this.F_BRK_NEW=null,this.opdata=null,this.cyclesToHalt=null,this.crash=null,this.irqRequested=null,this.irqType=null,this.reset()};t.prototype={IRQ_NORMAL:0,IRQ_NMI:1,IRQ_RESET:2,reset:function(){this.mem=new Array(65536);for(var i=0;i<8192;i++)this.mem[i]=255;for(var n=0;n<4;n++){var r=n*2048;this.mem[r+8]=247,this.mem[r+9]=239,this.mem[r+10]=223,this.mem[r+15]=191}for(var o=8193;o<this.mem.length;o++)this.mem[o]=0;this.REG_ACC=0,this.REG_X=0,this.REG_Y=0,this.REG_SP=511,this.REG_PC=32767,this.REG_PC_NEW=32767,this.REG_STATUS=40,this.setStatus(40),this.F_CARRY=0,this.F_DECIMAL=0,this.F_INTERRUPT=1,this.F_INTERRUPT_NEW=1,this.F_OVERFLOW=0,this.F_SIGN=0,this.F_ZERO=1,this.F_NOTUSED=1,this.F_NOTUSED_NEW=1,this.F_BRK=1,this.F_BRK_NEW=1,this.opdata=new s().opdata,this.cyclesToHalt=0,this.crash=!1,this.irqRequested=!1,this.irqType=null},emulate:function(){var i,n;if(this.irqRequested){switch(i=this.F_CARRY|(this.F_ZERO===0?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7,this.REG_PC_NEW=this.REG_PC,this.F_INTERRUPT_NEW=this.F_INTERRUPT,this.irqType){case 0:{if(this.F_INTERRUPT!==0)break;this.doIrq(i);break}case 1:{this.doNonMaskableInterrupt(i);break}case 2:{this.doResetInterrupt();break}}this.REG_PC=this.REG_PC_NEW,this.F_INTERRUPT=this.F_INTERRUPT_NEW,this.F_BRK=this.F_BRK_NEW,this.irqRequested=!1}var r=this.opdata[this.nes.mmap.load(this.REG_PC+1)],o=r>>24,a=0,h=r>>8&255,l=this.REG_PC;this.REG_PC+=r>>16&255;var c=0;switch(h){case 0:{c=this.load(l+2);break}case 1:{c=this.load(l+2),c<128?c+=this.REG_PC:c+=this.REG_PC-256;break}case 2:break;case 3:{c=this.load16bit(l+2);break}case 4:{c=this.REG_ACC;break}case 5:{c=this.REG_PC;break}case 6:{c=this.load(l+2)+this.REG_X&255;break}case 7:{c=this.load(l+2)+this.REG_Y&255;break}case 8:{c=this.load16bit(l+2),(c&65280)!==(c+this.REG_X&65280)&&(a=1),c+=this.REG_X;break}case 9:{c=this.load16bit(l+2),(c&65280)!==(c+this.REG_Y&65280)&&(a=1),c+=this.REG_Y;break}case 10:{c=this.load(l+2),(c&65280)!==(c+this.REG_X&65280)&&(a=1),c+=this.REG_X,c&=255,c=this.load16bit(c);break}case 11:{c=this.load16bit(this.load(l+2)),(c&65280)!==(c+this.REG_Y&65280)&&(a=1),c+=this.REG_Y;break}case 12:{c=this.load16bit(l+2),c<8191?c=this.mem[c]+(this.mem[c&65280|(c&255)+1&255]<<8):c=this.nes.mmap.load(c)+(this.nes.mmap.load(c&65280|(c&255)+1&255)<<8);break}}switch(c&=65535,r&255){case 0:{i=this.REG_ACC+this.load(c)+this.F_CARRY,!((this.REG_ACC^this.load(c))&128)&&(this.REG_ACC^i)&128?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=i>255?1:0,this.F_SIGN=i>>7&1,this.F_ZERO=i&255,this.REG_ACC=i&255,o+=a;break}case 1:{this.REG_ACC=this.REG_ACC&this.load(c),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,h!==11&&(o+=a);break}case 2:{h===4?(this.F_CARRY=this.REG_ACC>>7&1,this.REG_ACC=this.REG_ACC<<1&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC):(i=this.load(c),this.F_CARRY=i>>7&1,i=i<<1&255,this.F_SIGN=i>>7&1,this.F_ZERO=i,this.write(c,i));break}case 3:{this.F_CARRY===0&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 4:{this.F_CARRY===1&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 5:{this.F_ZERO===0&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 6:{i=this.load(c),this.F_SIGN=i>>7&1,this.F_OVERFLOW=i>>6&1,i&=this.REG_ACC,this.F_ZERO=i;break}case 7:{this.F_SIGN===1&&(o++,this.REG_PC=c);break}case 8:{this.F_ZERO!==0&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 9:{this.F_SIGN===0&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 10:{this.REG_PC+=2,this.push(this.REG_PC>>8&255),this.push(this.REG_PC&255),this.F_BRK=1,this.push(this.F_CARRY|(this.F_ZERO===0?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7),this.F_INTERRUPT=1,this.REG_PC=this.load16bit(65534),this.REG_PC--;break}case 11:{this.F_OVERFLOW===0&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 12:{this.F_OVERFLOW===1&&(o+=(l&65280)!==(c&65280)?2:1,this.REG_PC=c);break}case 13:{this.F_CARRY=0;break}case 14:{this.F_DECIMAL=0;break}case 15:{this.F_INTERRUPT=0;break}case 16:{this.F_OVERFLOW=0;break}case 17:{i=this.REG_ACC-this.load(c),this.F_CARRY=i>=0?1:0,this.F_SIGN=i>>7&1,this.F_ZERO=i&255,o+=a;break}case 18:{i=this.REG_X-this.load(c),this.F_CARRY=i>=0?1:0,this.F_SIGN=i>>7&1,this.F_ZERO=i&255;break}case 19:{i=this.REG_Y-this.load(c),this.F_CARRY=i>=0?1:0,this.F_SIGN=i>>7&1,this.F_ZERO=i&255;break}case 20:{i=this.load(c)-1&255,this.F_SIGN=i>>7&1,this.F_ZERO=i,this.write(c,i);break}case 21:{this.REG_X=this.REG_X-1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break}case 22:{this.REG_Y=this.REG_Y-1&255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break}case 23:{this.REG_ACC=(this.load(c)^this.REG_ACC)&255,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,o+=a;break}case 24:{i=this.load(c)+1&255,this.F_SIGN=i>>7&1,this.F_ZERO=i,this.write(c,i&255);break}case 25:{this.REG_X=this.REG_X+1&255,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break}case 26:{this.REG_Y++,this.REG_Y&=255,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break}case 27:{this.REG_PC=c-1;break}case 28:{this.push(this.REG_PC>>8&255),this.push(this.REG_PC&255),this.REG_PC=c-1;break}case 29:{this.REG_ACC=this.load(c),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,o+=a;break}case 30:{this.REG_X=this.load(c),this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X,o+=a;break}case 31:{this.REG_Y=this.load(c),this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y,o+=a;break}case 32:{h===4?(i=this.REG_ACC&255,this.F_CARRY=i&1,i>>=1,this.REG_ACC=i):(i=this.load(c)&255,this.F_CARRY=i&1,i>>=1,this.write(c,i)),this.F_SIGN=0,this.F_ZERO=i;break}case 33:break;case 34:{i=(this.load(c)|this.REG_ACC)&255,this.F_SIGN=i>>7&1,this.F_ZERO=i,this.REG_ACC=i,h!==11&&(o+=a);break}case 35:{this.push(this.REG_ACC);break}case 36:{this.F_BRK=1,this.push(this.F_CARRY|(this.F_ZERO===0?1:0)<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7);break}case 37:{this.REG_ACC=this.pull(),this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break}case 38:{i=this.pull(),this.F_CARRY=i&1,this.F_ZERO=(i>>1&1)===1?0:1,this.F_INTERRUPT=i>>2&1,this.F_DECIMAL=i>>3&1,this.F_BRK=i>>4&1,this.F_NOTUSED=i>>5&1,this.F_OVERFLOW=i>>6&1,this.F_SIGN=i>>7&1,this.F_NOTUSED=1;break}case 39:{h===4?(i=this.REG_ACC,n=this.F_CARRY,this.F_CARRY=i>>7&1,i=(i<<1&255)+n,this.REG_ACC=i):(i=this.load(c),n=this.F_CARRY,this.F_CARRY=i>>7&1,i=(i<<1&255)+n,this.write(c,i)),this.F_SIGN=i>>7&1,this.F_ZERO=i;break}case 40:{h===4?(n=this.F_CARRY<<7,this.F_CARRY=this.REG_ACC&1,i=(this.REG_ACC>>1)+n,this.REG_ACC=i):(i=this.load(c),n=this.F_CARRY<<7,this.F_CARRY=i&1,i=(i>>1)+n,this.write(c,i)),this.F_SIGN=i>>7&1,this.F_ZERO=i;break}case 41:{if(i=this.pull(),this.F_CARRY=i&1,this.F_ZERO=i>>1&1?0:1,this.F_INTERRUPT=i>>2&1,this.F_DECIMAL=i>>3&1,this.F_BRK=i>>4&1,this.F_NOTUSED=i>>5&1,this.F_OVERFLOW=i>>6&1,this.F_SIGN=i>>7&1,this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,this.REG_PC===65535)return;this.REG_PC--,this.F_NOTUSED=1;break}case 42:{if(this.REG_PC=this.pull(),this.REG_PC+=this.pull()<<8,this.REG_PC===65535)return;break}case 43:{i=this.REG_ACC-this.load(c)-(1-this.F_CARRY),this.F_SIGN=i>>7&1,this.F_ZERO=i&255,(this.REG_ACC^i)&128&&(this.REG_ACC^this.load(c))&128?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=i<0?0:1,this.REG_ACC=i&255,h!==11&&(o+=a);break}case 44:{this.F_CARRY=1;break}case 45:{this.F_DECIMAL=1;break}case 46:{this.F_INTERRUPT=1;break}case 47:{this.write(c,this.REG_ACC);break}case 48:{this.write(c,this.REG_X);break}case 49:{this.write(c,this.REG_Y);break}case 50:{this.REG_X=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break}case 51:{this.REG_Y=this.REG_ACC,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC;break}case 52:{this.REG_X=this.REG_SP-256,this.F_SIGN=this.REG_SP>>7&1,this.F_ZERO=this.REG_X;break}case 53:{this.REG_ACC=this.REG_X,this.F_SIGN=this.REG_X>>7&1,this.F_ZERO=this.REG_X;break}case 54:{this.REG_SP=this.REG_X+256,this.stackWrap();break}case 55:{this.REG_ACC=this.REG_Y,this.F_SIGN=this.REG_Y>>7&1,this.F_ZERO=this.REG_Y;break}case 56:{i=this.REG_ACC&this.load(c),this.F_CARRY=i&1,this.REG_ACC=this.F_ZERO=i>>1,this.F_SIGN=0;break}case 57:{this.REG_ACC=this.F_ZERO=this.REG_ACC&this.load(c),this.F_CARRY=this.F_SIGN=this.REG_ACC>>7&1;break}case 58:{i=this.REG_ACC&this.load(c),this.REG_ACC=this.F_ZERO=(i>>1)+(this.F_CARRY<<7),this.F_SIGN=this.F_CARRY,this.F_CARRY=i>>7&1,this.F_OVERFLOW=(i>>7^i>>6)&1;break}case 59:{i=(this.REG_X&this.REG_ACC)-this.load(c),this.F_SIGN=i>>7&1,this.F_ZERO=i&255,(this.REG_X^i)&128&&(this.REG_X^this.load(c))&128?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=i<0?0:1,this.REG_X=i&255;break}case 60:{this.REG_ACC=this.REG_X=this.F_ZERO=this.load(c),this.F_SIGN=this.REG_ACC>>7&1,o+=a;break}case 61:{this.write(c,this.REG_ACC&this.REG_X);break}case 62:{i=this.load(c)-1&255,this.write(c,i),i=this.REG_ACC-i,this.F_CARRY=i>=0?1:0,this.F_SIGN=i>>7&1,this.F_ZERO=i&255,h!==11&&(o+=a);break}case 63:{i=this.load(c)+1&255,this.write(c,i),i=this.REG_ACC-i-(1-this.F_CARRY),this.F_SIGN=i>>7&1,this.F_ZERO=i&255,(this.REG_ACC^i)&128&&(this.REG_ACC^this.load(c))&128?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=i<0?0:1,this.REG_ACC=i&255,h!==11&&(o+=a);break}case 64:{i=this.load(c),n=this.F_CARRY,this.F_CARRY=i>>7&1,i=(i<<1&255)+n,this.write(c,i),this.REG_ACC=this.REG_ACC&i,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,h!==11&&(o+=a);break}case 65:{i=this.load(c),n=this.F_CARRY<<7,this.F_CARRY=i&1,i=(i>>1)+n,this.write(c,i),i=this.REG_ACC+this.load(c)+this.F_CARRY,!((this.REG_ACC^this.load(c))&128)&&(this.REG_ACC^i)&128?this.F_OVERFLOW=1:this.F_OVERFLOW=0,this.F_CARRY=i>255?1:0,this.F_SIGN=i>>7&1,this.F_ZERO=i&255,this.REG_ACC=i&255,h!==11&&(o+=a);break}case 66:{i=this.load(c),this.F_CARRY=i>>7&1,i=i<<1&255,this.write(c,i),this.REG_ACC=this.REG_ACC|i,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,h!==11&&(o+=a);break}case 67:{i=this.load(c)&255,this.F_CARRY=i&1,i>>=1,this.write(c,i),this.REG_ACC=this.REG_ACC^i,this.F_SIGN=this.REG_ACC>>7&1,this.F_ZERO=this.REG_ACC,h!==11&&(o+=a);break}case 68:break;case 69:{this.load(c),h!==11&&(o+=a);break}default:{this.nes.stop(),this.nes.crashMessage="Game crashed, invalid opcode at address $"+l.toString(16);break}}return o},load:function(i){return i<8192?this.mem[i&2047]:this.nes.mmap.load(i)},load16bit:function(i){return i<8191?this.mem[i&2047]|this.mem[i+1&2047]<<8:this.nes.mmap.load(i)|this.nes.mmap.load(i+1)<<8},write:function(i,n){i<8192?this.mem[i&2047]=n:this.nes.mmap.write(i,n)},requestIrq:function(i){this.irqRequested&&i===this.IRQ_NORMAL||(this.irqRequested=!0,this.irqType=i)},push:function(i){this.nes.mmap.write(this.REG_SP,i),this.REG_SP--,this.REG_SP=256|this.REG_SP&255},stackWrap:function(){this.REG_SP=256|this.REG_SP&255},pull:function(){return this.REG_SP++,this.REG_SP=256|this.REG_SP&255,this.nes.mmap.load(this.REG_SP)},pageCrossed:function(i,n){return(i&65280)!==(n&65280)},haltCycles:function(i){this.cyclesToHalt+=i},doNonMaskableInterrupt:function(i){this.nes.mmap.load(8192)&128&&(this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(this.REG_PC_NEW&255),this.push(i),this.REG_PC_NEW=this.nes.mmap.load(65530)|this.nes.mmap.load(65531)<<8,this.REG_PC_NEW--)},doResetInterrupt:function(){this.REG_PC_NEW=this.nes.mmap.load(65532)|this.nes.mmap.load(65533)<<8,this.REG_PC_NEW--},doIrq:function(i){this.REG_PC_NEW++,this.push(this.REG_PC_NEW>>8&255),this.push(this.REG_PC_NEW&255),this.push(i),this.F_INTERRUPT_NEW=1,this.F_BRK_NEW=0,this.REG_PC_NEW=this.nes.mmap.load(65534)|this.nes.mmap.load(65535)<<8,this.REG_PC_NEW--},getStatus:function(){return this.F_CARRY|this.F_ZERO<<1|this.F_INTERRUPT<<2|this.F_DECIMAL<<3|this.F_BRK<<4|this.F_NOTUSED<<5|this.F_OVERFLOW<<6|this.F_SIGN<<7},setStatus:function(i){this.F_CARRY=i&1,this.F_ZERO=i>>1&1,this.F_INTERRUPT=i>>2&1,this.F_DECIMAL=i>>3&1,this.F_BRK=i>>4&1,this.F_NOTUSED=i>>5&1,this.F_OVERFLOW=i>>6&1,this.F_SIGN=i>>7&1},JSON_PROPERTIES:["mem","cyclesToHalt","irqRequested","irqType","REG_ACC","REG_X","REG_Y","REG_SP","REG_PC","REG_PC_NEW","REG_STATUS","F_CARRY","F_DECIMAL","F_INTERRUPT","F_INTERRUPT_NEW","F_OVERFLOW","F_SIGN","F_ZERO","F_NOTUSED","F_NOTUSED_NEW","F_BRK","F_BRK_NEW"],toJSON:function(){return e.toJSON(this)},fromJSON:function(i){e.fromJSON(this,i)}};var s=function(){this.opdata=new Array(256);for(var i=0;i<256;i++)this.opdata[i]=255;this.setOp(this.INS_ADC,105,this.ADDR_IMM,2,2),this.setOp(this.INS_ADC,101,this.ADDR_ZP,2,3),this.setOp(this.INS_ADC,117,this.ADDR_ZPX,2,4),this.setOp(this.INS_ADC,109,this.ADDR_ABS,3,4),this.setOp(this.INS_ADC,125,this.ADDR_ABSX,3,4),this.setOp(this.INS_ADC,121,this.ADDR_ABSY,3,4),this.setOp(this.INS_ADC,97,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ADC,113,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_AND,41,this.ADDR_IMM,2,2),this.setOp(this.INS_AND,37,this.ADDR_ZP,2,3),this.setOp(this.INS_AND,53,this.ADDR_ZPX,2,4),this.setOp(this.INS_AND,45,this.ADDR_ABS,3,4),this.setOp(this.INS_AND,61,this.ADDR_ABSX,3,4),this.setOp(this.INS_AND,57,this.ADDR_ABSY,3,4),this.setOp(this.INS_AND,33,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_AND,49,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_ASL,10,this.ADDR_ACC,1,2),this.setOp(this.INS_ASL,6,this.ADDR_ZP,2,5),this.setOp(this.INS_ASL,22,this.ADDR_ZPX,2,6),this.setOp(this.INS_ASL,14,this.ADDR_ABS,3,6),this.setOp(this.INS_ASL,30,this.ADDR_ABSX,3,7),this.setOp(this.INS_BCC,144,this.ADDR_REL,2,2),this.setOp(this.INS_BCS,176,this.ADDR_REL,2,2),this.setOp(this.INS_BEQ,240,this.ADDR_REL,2,2),this.setOp(this.INS_BIT,36,this.ADDR_ZP,2,3),this.setOp(this.INS_BIT,44,this.ADDR_ABS,3,4),this.setOp(this.INS_BMI,48,this.ADDR_REL,2,2),this.setOp(this.INS_BNE,208,this.ADDR_REL,2,2),this.setOp(this.INS_BPL,16,this.ADDR_REL,2,2),this.setOp(this.INS_BRK,0,this.ADDR_IMP,1,7),this.setOp(this.INS_BVC,80,this.ADDR_REL,2,2),this.setOp(this.INS_BVS,112,this.ADDR_REL,2,2),this.setOp(this.INS_CLC,24,this.ADDR_IMP,1,2),this.setOp(this.INS_CLD,216,this.ADDR_IMP,1,2),this.setOp(this.INS_CLI,88,this.ADDR_IMP,1,2),this.setOp(this.INS_CLV,184,this.ADDR_IMP,1,2),this.setOp(this.INS_CMP,201,this.ADDR_IMM,2,2),this.setOp(this.INS_CMP,197,this.ADDR_ZP,2,3),this.setOp(this.INS_CMP,213,this.ADDR_ZPX,2,4),this.setOp(this.INS_CMP,205,this.ADDR_ABS,3,4),this.setOp(this.INS_CMP,221,this.ADDR_ABSX,3,4),this.setOp(this.INS_CMP,217,this.ADDR_ABSY,3,4),this.setOp(this.INS_CMP,193,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_CMP,209,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_CPX,224,this.ADDR_IMM,2,2),this.setOp(this.INS_CPX,228,this.ADDR_ZP,2,3),this.setOp(this.INS_CPX,236,this.ADDR_ABS,3,4),this.setOp(this.INS_CPY,192,this.ADDR_IMM,2,2),this.setOp(this.INS_CPY,196,this.ADDR_ZP,2,3),this.setOp(this.INS_CPY,204,this.ADDR_ABS,3,4),this.setOp(this.INS_DEC,198,this.ADDR_ZP,2,5),this.setOp(this.INS_DEC,214,this.ADDR_ZPX,2,6),this.setOp(this.INS_DEC,206,this.ADDR_ABS,3,6),this.setOp(this.INS_DEC,222,this.ADDR_ABSX,3,7),this.setOp(this.INS_DEX,202,this.ADDR_IMP,1,2),this.setOp(this.INS_DEY,136,this.ADDR_IMP,1,2),this.setOp(this.INS_EOR,73,this.ADDR_IMM,2,2),this.setOp(this.INS_EOR,69,this.ADDR_ZP,2,3),this.setOp(this.INS_EOR,85,this.ADDR_ZPX,2,4),this.setOp(this.INS_EOR,77,this.ADDR_ABS,3,4),this.setOp(this.INS_EOR,93,this.ADDR_ABSX,3,4),this.setOp(this.INS_EOR,89,this.ADDR_ABSY,3,4),this.setOp(this.INS_EOR,65,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_EOR,81,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_INC,230,this.ADDR_ZP,2,5),this.setOp(this.INS_INC,246,this.ADDR_ZPX,2,6),this.setOp(this.INS_INC,238,this.ADDR_ABS,3,6),this.setOp(this.INS_INC,254,this.ADDR_ABSX,3,7),this.setOp(this.INS_INX,232,this.ADDR_IMP,1,2),this.setOp(this.INS_INY,200,this.ADDR_IMP,1,2),this.setOp(this.INS_JMP,76,this.ADDR_ABS,3,3),this.setOp(this.INS_JMP,108,this.ADDR_INDABS,3,5),this.setOp(this.INS_JSR,32,this.ADDR_ABS,3,6),this.setOp(this.INS_LDA,169,this.ADDR_IMM,2,2),this.setOp(this.INS_LDA,165,this.ADDR_ZP,2,3),this.setOp(this.INS_LDA,181,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDA,173,this.ADDR_ABS,3,4),this.setOp(this.INS_LDA,189,this.ADDR_ABSX,3,4),this.setOp(this.INS_LDA,185,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDA,161,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LDA,177,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LDX,162,this.ADDR_IMM,2,2),this.setOp(this.INS_LDX,166,this.ADDR_ZP,2,3),this.setOp(this.INS_LDX,182,this.ADDR_ZPY,2,4),this.setOp(this.INS_LDX,174,this.ADDR_ABS,3,4),this.setOp(this.INS_LDX,190,this.ADDR_ABSY,3,4),this.setOp(this.INS_LDY,160,this.ADDR_IMM,2,2),this.setOp(this.INS_LDY,164,this.ADDR_ZP,2,3),this.setOp(this.INS_LDY,180,this.ADDR_ZPX,2,4),this.setOp(this.INS_LDY,172,this.ADDR_ABS,3,4),this.setOp(this.INS_LDY,188,this.ADDR_ABSX,3,4),this.setOp(this.INS_LSR,74,this.ADDR_ACC,1,2),this.setOp(this.INS_LSR,70,this.ADDR_ZP,2,5),this.setOp(this.INS_LSR,86,this.ADDR_ZPX,2,6),this.setOp(this.INS_LSR,78,this.ADDR_ABS,3,6),this.setOp(this.INS_LSR,94,this.ADDR_ABSX,3,7),this.setOp(this.INS_NOP,26,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,58,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,90,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,122,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,218,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,234,this.ADDR_IMP,1,2),this.setOp(this.INS_NOP,250,this.ADDR_IMP,1,2),this.setOp(this.INS_ORA,9,this.ADDR_IMM,2,2),this.setOp(this.INS_ORA,5,this.ADDR_ZP,2,3),this.setOp(this.INS_ORA,21,this.ADDR_ZPX,2,4),this.setOp(this.INS_ORA,13,this.ADDR_ABS,3,4),this.setOp(this.INS_ORA,29,this.ADDR_ABSX,3,4),this.setOp(this.INS_ORA,25,this.ADDR_ABSY,3,4),this.setOp(this.INS_ORA,1,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_ORA,17,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_PHA,72,this.ADDR_IMP,1,3),this.setOp(this.INS_PHP,8,this.ADDR_IMP,1,3),this.setOp(this.INS_PLA,104,this.ADDR_IMP,1,4),this.setOp(this.INS_PLP,40,this.ADDR_IMP,1,4),this.setOp(this.INS_ROL,42,this.ADDR_ACC,1,2),this.setOp(this.INS_ROL,38,this.ADDR_ZP,2,5),this.setOp(this.INS_ROL,54,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROL,46,this.ADDR_ABS,3,6),this.setOp(this.INS_ROL,62,this.ADDR_ABSX,3,7),this.setOp(this.INS_ROR,106,this.ADDR_ACC,1,2),this.setOp(this.INS_ROR,102,this.ADDR_ZP,2,5),this.setOp(this.INS_ROR,118,this.ADDR_ZPX,2,6),this.setOp(this.INS_ROR,110,this.ADDR_ABS,3,6),this.setOp(this.INS_ROR,126,this.ADDR_ABSX,3,7),this.setOp(this.INS_RTI,64,this.ADDR_IMP,1,6),this.setOp(this.INS_RTS,96,this.ADDR_IMP,1,6),this.setOp(this.INS_SBC,233,this.ADDR_IMM,2,2),this.setOp(this.INS_SBC,229,this.ADDR_ZP,2,3),this.setOp(this.INS_SBC,245,this.ADDR_ZPX,2,4),this.setOp(this.INS_SBC,237,this.ADDR_ABS,3,4),this.setOp(this.INS_SBC,253,this.ADDR_ABSX,3,4),this.setOp(this.INS_SBC,249,this.ADDR_ABSY,3,4),this.setOp(this.INS_SBC,225,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SBC,241,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_SEC,56,this.ADDR_IMP,1,2),this.setOp(this.INS_SED,248,this.ADDR_IMP,1,2),this.setOp(this.INS_SEI,120,this.ADDR_IMP,1,2),this.setOp(this.INS_STA,133,this.ADDR_ZP,2,3),this.setOp(this.INS_STA,149,this.ADDR_ZPX,2,4),this.setOp(this.INS_STA,141,this.ADDR_ABS,3,4),this.setOp(this.INS_STA,157,this.ADDR_ABSX,3,5),this.setOp(this.INS_STA,153,this.ADDR_ABSY,3,5),this.setOp(this.INS_STA,129,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_STA,145,this.ADDR_POSTIDXIND,2,6),this.setOp(this.INS_STX,134,this.ADDR_ZP,2,3),this.setOp(this.INS_STX,150,this.ADDR_ZPY,2,4),this.setOp(this.INS_STX,142,this.ADDR_ABS,3,4),this.setOp(this.INS_STY,132,this.ADDR_ZP,2,3),this.setOp(this.INS_STY,148,this.ADDR_ZPX,2,4),this.setOp(this.INS_STY,140,this.ADDR_ABS,3,4),this.setOp(this.INS_TAX,170,this.ADDR_IMP,1,2),this.setOp(this.INS_TAY,168,this.ADDR_IMP,1,2),this.setOp(this.INS_TSX,186,this.ADDR_IMP,1,2),this.setOp(this.INS_TXA,138,this.ADDR_IMP,1,2),this.setOp(this.INS_TXS,154,this.ADDR_IMP,1,2),this.setOp(this.INS_TYA,152,this.ADDR_IMP,1,2),this.setOp(this.INS_ALR,75,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,11,this.ADDR_IMM,2,2),this.setOp(this.INS_ANC,43,this.ADDR_IMM,2,2),this.setOp(this.INS_ARR,107,this.ADDR_IMM,2,2),this.setOp(this.INS_AXS,203,this.ADDR_IMM,2,2),this.setOp(this.INS_LAX,163,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_LAX,167,this.ADDR_ZP,2,3),this.setOp(this.INS_LAX,175,this.ADDR_ABS,3,4),this.setOp(this.INS_LAX,179,this.ADDR_POSTIDXIND,2,5),this.setOp(this.INS_LAX,183,this.ADDR_ZPY,2,4),this.setOp(this.INS_LAX,191,this.ADDR_ABSY,3,4),this.setOp(this.INS_SAX,131,this.ADDR_PREIDXIND,2,6),this.setOp(this.INS_SAX,135,this.ADDR_ZP,2,3),this.setOp(this.INS_SAX,143,this.ADDR_ABS,3,4),this.setOp(this.INS_SAX,151,this.ADDR_ZPY,2,4),this.setOp(this.INS_DCP,195,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_DCP,199,this.ADDR_ZP,2,5),this.setOp(this.INS_DCP,207,this.ADDR_ABS,3,6),this.setOp(this.INS_DCP,211,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_DCP,215,this.ADDR_ZPX,2,6),this.setOp(this.INS_DCP,219,this.ADDR_ABSY,3,7),this.setOp(this.INS_DCP,223,this.ADDR_ABSX,3,7),this.setOp(this.INS_ISC,227,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_ISC,231,this.ADDR_ZP,2,5),this.setOp(this.INS_ISC,239,this.ADDR_ABS,3,6),this.setOp(this.INS_ISC,243,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_ISC,247,this.ADDR_ZPX,2,6),this.setOp(this.INS_ISC,251,this.ADDR_ABSY,3,7),this.setOp(this.INS_ISC,255,this.ADDR_ABSX,3,7),this.setOp(this.INS_RLA,35,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RLA,39,this.ADDR_ZP,2,5),this.setOp(this.INS_RLA,47,this.ADDR_ABS,3,6),this.setOp(this.INS_RLA,51,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RLA,55,this.ADDR_ZPX,2,6),this.setOp(this.INS_RLA,59,this.ADDR_ABSY,3,7),this.setOp(this.INS_RLA,63,this.ADDR_ABSX,3,7),this.setOp(this.INS_RRA,99,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_RRA,103,this.ADDR_ZP,2,5),this.setOp(this.INS_RRA,111,this.ADDR_ABS,3,6),this.setOp(this.INS_RRA,115,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_RRA,119,this.ADDR_ZPX,2,6),this.setOp(this.INS_RRA,123,this.ADDR_ABSY,3,7),this.setOp(this.INS_RRA,127,this.ADDR_ABSX,3,7),this.setOp(this.INS_SLO,3,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SLO,7,this.ADDR_ZP,2,5),this.setOp(this.INS_SLO,15,this.ADDR_ABS,3,6),this.setOp(this.INS_SLO,19,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SLO,23,this.ADDR_ZPX,2,6),this.setOp(this.INS_SLO,27,this.ADDR_ABSY,3,7),this.setOp(this.INS_SLO,31,this.ADDR_ABSX,3,7),this.setOp(this.INS_SRE,67,this.ADDR_PREIDXIND,2,8),this.setOp(this.INS_SRE,71,this.ADDR_ZP,2,5),this.setOp(this.INS_SRE,79,this.ADDR_ABS,3,6),this.setOp(this.INS_SRE,83,this.ADDR_POSTIDXIND,2,8),this.setOp(this.INS_SRE,87,this.ADDR_ZPX,2,6),this.setOp(this.INS_SRE,91,this.ADDR_ABSY,3,7),this.setOp(this.INS_SRE,95,this.ADDR_ABSX,3,7),this.setOp(this.INS_SKB,128,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,130,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,137,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,194,this.ADDR_IMM,2,2),this.setOp(this.INS_SKB,226,this.ADDR_IMM,2,2),this.setOp(this.INS_IGN,12,this.ADDR_ABS,3,4),this.setOp(this.INS_IGN,28,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,60,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,92,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,124,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,220,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,252,this.ADDR_ABSX,3,4),this.setOp(this.INS_IGN,4,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,68,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,100,this.ADDR_ZP,2,3),this.setOp(this.INS_IGN,20,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,52,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,84,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,116,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,212,this.ADDR_ZPX,2,4),this.setOp(this.INS_IGN,244,this.ADDR_ZPX,2,4),this.cycTable=new Array(7,6,2,8,3,3,5,5,3,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,3,2,2,2,3,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,6,6,2,8,3,3,5,5,4,2,2,2,5,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,6,2,6,4,4,4,4,2,5,2,5,5,5,5,5,2,6,2,6,3,3,3,3,2,2,2,2,4,4,4,4,2,5,2,5,4,4,4,4,2,4,2,4,4,4,4,4,2,6,2,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7,2,6,3,8,3,3,5,5,2,2,2,2,4,4,6,6,2,5,2,8,4,4,6,6,2,4,2,7,4,4,7,7),this.instname=new Array(70),this.instname[0]="ADC",this.instname[1]="AND",this.instname[2]="ASL",this.instname[3]="BCC",this.instname[4]="BCS",this.instname[5]="BEQ",this.instname[6]="BIT",this.instname[7]="BMI",this.instname[8]="BNE",this.instname[9]="BPL",this.instname[10]="BRK",this.instname[11]="BVC",this.instname[12]="BVS",this.instname[13]="CLC",this.instname[14]="CLD",this.instname[15]="CLI",this.instname[16]="CLV",this.instname[17]="CMP",this.instname[18]="CPX",this.instname[19]="CPY",this.instname[20]="DEC",this.instname[21]="DEX",this.instname[22]="DEY",this.instname[23]="EOR",this.instname[24]="INC",this.instname[25]="INX",this.instname[26]="INY",this.instname[27]="JMP",this.instname[28]="JSR",this.instname[29]="LDA",this.instname[30]="LDX",this.instname[31]="LDY",this.instname[32]="LSR",this.instname[33]="NOP",this.instname[34]="ORA",this.instname[35]="PHA",this.instname[36]="PHP",this.instname[37]="PLA",this.instname[38]="PLP",this.instname[39]="ROL",this.instname[40]="ROR",this.instname[41]="RTI",this.instname[42]="RTS",this.instname[43]="SBC",this.instname[44]="SEC",this.instname[45]="SED",this.instname[46]="SEI",this.instname[47]="STA",this.instname[48]="STX",this.instname[49]="STY",this.instname[50]="TAX",this.instname[51]="TAY",this.instname[52]="TSX",this.instname[53]="TXA",this.instname[54]="TXS",this.instname[55]="TYA",this.instname[56]="ALR",this.instname[57]="ANC",this.instname[58]="ARR",this.instname[59]="AXS",this.instname[60]="LAX",this.instname[61]="SAX",this.instname[62]="DCP",this.instname[63]="ISC",this.instname[64]="RLA",this.instname[65]="RRA",this.instname[66]="SLO",this.instname[67]="SRE",this.instname[68]="SKB",this.instname[69]="IGN",this.addrDesc=new Array("Zero Page           ","Relative            ","Implied             ","Absolute            ","Accumulator         ","Immediate           ","Zero Page,X         ","Zero Page,Y         ","Absolute,X          ","Absolute,Y          ","Preindexed Indirect ","Postindexed Indirect","Indirect Absolute   ")};return s.prototype={INS_ADC:0,INS_AND:1,INS_ASL:2,INS_BCC:3,INS_BCS:4,INS_BEQ:5,INS_BIT:6,INS_BMI:7,INS_BNE:8,INS_BPL:9,INS_BRK:10,INS_BVC:11,INS_BVS:12,INS_CLC:13,INS_CLD:14,INS_CLI:15,INS_CLV:16,INS_CMP:17,INS_CPX:18,INS_CPY:19,INS_DEC:20,INS_DEX:21,INS_DEY:22,INS_EOR:23,INS_INC:24,INS_INX:25,INS_INY:26,INS_JMP:27,INS_JSR:28,INS_LDA:29,INS_LDX:30,INS_LDY:31,INS_LSR:32,INS_NOP:33,INS_ORA:34,INS_PHA:35,INS_PHP:36,INS_PLA:37,INS_PLP:38,INS_ROL:39,INS_ROR:40,INS_RTI:41,INS_RTS:42,INS_SBC:43,INS_SEC:44,INS_SED:45,INS_SEI:46,INS_STA:47,INS_STX:48,INS_STY:49,INS_TAX:50,INS_TAY:51,INS_TSX:52,INS_TXA:53,INS_TXS:54,INS_TYA:55,INS_ALR:56,INS_ANC:57,INS_ARR:58,INS_AXS:59,INS_LAX:60,INS_SAX:61,INS_DCP:62,INS_ISC:63,INS_RLA:64,INS_RRA:65,INS_SLO:66,INS_SRE:67,INS_SKB:68,INS_IGN:69,INS_DUMMY:70,ADDR_ZP:0,ADDR_REL:1,ADDR_IMP:2,ADDR_ABS:3,ADDR_ACC:4,ADDR_IMM:5,ADDR_ZPX:6,ADDR_ZPY:7,ADDR_ABSX:8,ADDR_ABSY:9,ADDR_PREIDXIND:10,ADDR_POSTIDXIND:11,ADDR_INDABS:12,setOp:function(i,n,r,o,a){this.opdata[n]=i&255|(r&255)<<8|(o&255)<<16|(a&255)<<24}},wi=t,wi}var Vi,qr;function wa(){if(qr)return Vi;qr=1;var e=function(){this.pix=new Array(64),this.fbIndex=null,this.tIndex=null,this.x=null,this.y=null,this.w=null,this.h=null,this.incX=null,this.incY=null,this.palIndex=null,this.tpri=null,this.c=null,this.initialized=!1,this.opaque=new Array(8)};return e.prototype={setBuffer:function(t){for(this.y=0;this.y<8;this.y++)this.setScanline(this.y,t[this.y],t[this.y+8])},setScanline:function(t,s,i){for(this.initialized=!0,this.tIndex=t<<3,this.x=0;this.x<8;this.x++)this.pix[this.tIndex+this.x]=(s>>7-this.x&1)+((i>>7-this.x&1)<<1),this.pix[this.tIndex+this.x]===0&&(this.opaque[t]=!1)},render:function(t,s,i,n,r,o,a,h,l,c,f,u,p){if(!(o<-7||o>=256||a<-7||a>=240))if(this.w=n-s,this.h=r-i,o<0&&(s-=o),o+n>=256&&(n=256-o),a<0&&(i-=a),a+r>=240&&(r=240-a),!c&&!f)for(this.fbIndex=(a<<8)+o,this.tIndex=0,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=s&&this.x<n&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],this.palIndex!==0&&u<=(this.tpri&255)&&(t[this.fbIndex]=l[this.palIndex+h],this.tpri=this.tpri&3840|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256}else if(c&&!f)for(this.fbIndex=(a<<8)+o,this.tIndex=7,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=s&&this.x<n&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],this.palIndex!==0&&u<=(this.tpri&255)&&(t[this.fbIndex]=l[this.palIndex+h],this.tpri=this.tpri&3840|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256,this.tIndex+=16}else if(f&&!c)for(this.fbIndex=(a<<8)+o,this.tIndex=56,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=s&&this.x<n&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],this.palIndex!==0&&u<=(this.tpri&255)&&(t[this.fbIndex]=l[this.palIndex+h],this.tpri=this.tpri&3840|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex++;this.fbIndex-=8,this.fbIndex+=256,this.tIndex-=16}else for(this.fbIndex=(a<<8)+o,this.tIndex=63,this.y=0;this.y<8;this.y++){for(this.x=0;this.x<8;this.x++)this.x>=s&&this.x<n&&this.y>=i&&this.y<r&&(this.palIndex=this.pix[this.tIndex],this.tpri=p[this.fbIndex],this.palIndex!==0&&u<=(this.tpri&255)&&(t[this.fbIndex]=l[this.palIndex+h],this.tpri=this.tpri&3840|u,p[this.fbIndex]=this.tpri)),this.fbIndex++,this.tIndex--;this.fbIndex-=8,this.fbIndex+=256}},isTransparent:function(t,s){return this.pix[(s<<3)+t]===0},toJSON:function(){return{opaque:this.opaque,pix:this.pix}},fromJSON:function(t){this.opaque=t.opaque,this.pix=t.pix}},Vi=e,Vi}var Gi,jr;function mf(){if(jr)return Gi;jr=1;var e=wa(),t=Si(),s=function(r){this.nes=r,this.vramMem=null,this.spriteMem=null,this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=null,this.firstWrite=null,this.sramAddress=null,this.currentMirroring=null,this.requestEndFrame=null,this.nmiOk=null,this.dummyCycleToggle=null,this.validTileData=null,this.nmiCounter=null,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=null,this.f_spriteSize=null,this.f_bgPatternTable=null,this.f_spPatternTable=null,this.f_addrInc=null,this.f_nTblAddress=null,this.f_color=null,this.f_spVisibility=null,this.f_bgVisibility=null,this.f_spClipping=null,this.f_bgClipping=null,this.f_dispType=null,this.cntFV=null,this.cntV=null,this.cntH=null,this.cntVT=null,this.cntHT=null,this.regFV=null,this.regV=null,this.regH=null,this.regVT=null,this.regHT=null,this.regFH=null,this.regS=null,this.curNt=null,this.attrib=null,this.buffer=null,this.bgbuffer=null,this.pixrendered=null,this.validTileData=null,this.scantile=null,this.scanline=null,this.lastRenderedScanline=null,this.curX=null,this.sprX=null,this.sprY=null,this.sprTile=null,this.sprCol=null,this.vertFlip=null,this.horiFlip=null,this.bgPriority=null,this.spr0HitX=null,this.spr0HitY=null,this.hitSpr0=null,this.sprPalette=null,this.imgPalette=null,this.ptTile=null,this.ntable1=null,this.currentMirroring=null,this.nameTable=null,this.vramMirrorTable=null,this.palTable=null,this.showSpr0Hit=!1,this.clipToTvSize=!0,this.reset()};s.prototype={STATUS_VRAMWRITE:4,STATUS_SLSPRITECOUNT:5,STATUS_SPRITE0HIT:6,STATUS_VBLANK:7,reset:function(){var r;for(this.vramMem=new Array(32768),this.spriteMem=new Array(256),r=0;r<this.vramMem.length;r++)this.vramMem[r]=0;for(r=0;r<this.spriteMem.length;r++)this.spriteMem[r]=0;for(this.vramAddress=null,this.vramTmpAddress=null,this.vramBufferedReadValue=0,this.firstWrite=!0,this.sramAddress=0,this.currentMirroring=-1,this.requestEndFrame=!1,this.nmiOk=!1,this.dummyCycleToggle=!1,this.validTileData=!1,this.nmiCounter=0,this.scanlineAlreadyRendered=null,this.f_nmiOnVblank=0,this.f_spriteSize=0,this.f_bgPatternTable=0,this.f_spPatternTable=0,this.f_addrInc=0,this.f_nTblAddress=0,this.f_color=0,this.f_spVisibility=0,this.f_bgVisibility=0,this.f_spClipping=0,this.f_bgClipping=0,this.f_dispType=0,this.cntFV=0,this.cntV=0,this.cntH=0,this.cntVT=0,this.cntHT=0,this.regFV=0,this.regV=0,this.regH=0,this.regVT=0,this.regHT=0,this.regFH=0,this.regS=0,this.curNt=null,this.attrib=new Array(32),this.buffer=new Array(256*240),this.bgbuffer=new Array(256*240),this.pixrendered=new Array(256*240),this.validTileData=null,this.scantile=new Array(32),this.scanline=0,this.lastRenderedScanline=-1,this.curX=0,this.sprX=new Array(64),this.sprY=new Array(64),this.sprTile=new Array(64),this.sprCol=new Array(64),this.vertFlip=new Array(64),this.horiFlip=new Array(64),this.bgPriority=new Array(64),this.spr0HitX=0,this.spr0HitY=0,this.hitSpr0=!1,this.sprPalette=new Array(16),this.imgPalette=new Array(16),this.ptTile=new Array(512),r=0;r<512;r++)this.ptTile[r]=new e;for(this.ntable1=new Array(4),this.currentMirroring=-1,this.nameTable=new Array(4),r=0;r<4;r++)this.nameTable[r]=new i(32,32,"Nt"+r);for(this.vramMirrorTable=new Array(32768),r=0;r<32768;r++)this.vramMirrorTable[r]=r;this.palTable=new n,this.palTable.loadNTSCPalette(),this.updateControlReg1(0),this.updateControlReg2(0)},setMirroring:function(r){if(r!==this.currentMirroring){this.currentMirroring=r,this.triggerRendering(),this.vramMirrorTable===null&&(this.vramMirrorTable=new Array(32768));for(var o=0;o<32768;o++)this.vramMirrorTable[o]=o;this.defineMirrorRegion(16160,16128,32),this.defineMirrorRegion(16192,16128,32),this.defineMirrorRegion(16256,16128,32),this.defineMirrorRegion(16320,16128,32),this.defineMirrorRegion(12288,8192,3840),this.defineMirrorRegion(16384,0,16384),r===this.nes.rom.HORIZONTAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(11264,10240,1024)):r===this.nes.rom.VERTICAL_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=0,this.ntable1[3]=1,this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,9216,1024)):r===this.nes.rom.SINGLESCREEN_MIRRORING?(this.ntable1[0]=0,this.ntable1[1]=0,this.ntable1[2]=0,this.ntable1[3]=0,this.defineMirrorRegion(9216,8192,1024),this.defineMirrorRegion(10240,8192,1024),this.defineMirrorRegion(11264,8192,1024)):r===this.nes.rom.SINGLESCREEN_MIRRORING2?(this.ntable1[0]=1,this.ntable1[1]=1,this.ntable1[2]=1,this.ntable1[3]=1,this.defineMirrorRegion(9216,9216,1024),this.defineMirrorRegion(10240,9216,1024),this.defineMirrorRegion(11264,9216,1024)):(this.ntable1[0]=0,this.ntable1[1]=1,this.ntable1[2]=2,this.ntable1[3]=3)}},defineMirrorRegion:function(r,o,a){for(var h=0;h<a;h++)this.vramMirrorTable[r+h]=o+h},startVBlank:function(){this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI),this.lastRenderedScanline<239&&this.renderFramePartially(this.lastRenderedScanline+1,240-this.lastRenderedScanline),this.endFrame(),this.lastRenderedScanline=-1},endScanline:function(){switch(this.scanline){case 19:this.dummyCycleToggle&&(this.curX=1,this.dummyCycleToggle=!this.dummyCycleToggle);break;case 20:this.setStatusFlag(this.STATUS_VBLANK,!1),this.setStatusFlag(this.STATUS_SPRITE0HIT,!1),this.hitSpr0=!1,this.spr0HitX=-1,this.spr0HitY=-1,(this.f_bgVisibility===1||this.f_spVisibility===1)&&(this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.f_bgVisibility===1&&this.renderBgScanline(!1,0)),this.f_bgVisibility===1&&this.f_spVisibility===1&&this.checkSprite0(0),(this.f_bgVisibility===1||this.f_spVisibility===1)&&this.nes.mmap.clockIrqCounter();break;case 261:this.setStatusFlag(this.STATUS_VBLANK,!0),this.requestEndFrame=!0,this.nmiCounter=9,this.scanline=-1;break;default:this.scanline>=21&&this.scanline<=260&&(this.f_bgVisibility===1&&(this.scanlineAlreadyRendered||(this.cntHT=this.regHT,this.cntH=this.regH,this.renderBgScanline(!0,this.scanline+1-21)),this.scanlineAlreadyRendered=!1,!this.hitSpr0&&this.f_spVisibility===1&&this.sprX[0]>=-7&&this.sprX[0]<256&&this.sprY[0]+1<=this.scanline-20&&this.sprY[0]+1+(this.f_spriteSize===0?8:16)>=this.scanline-20&&this.checkSprite0(this.scanline-20)&&(this.hitSpr0=!0)),(this.f_bgVisibility===1||this.f_spVisibility===1)&&this.nes.mmap.clockIrqCounter())}this.scanline++,this.regsToAddress(),this.cntsToAddress()},startFrame:function(){var r=0;if(this.f_dispType===0)r=this.imgPalette[0];else switch(this.f_color){case 0:r=0;break;case 1:r=65280;break;case 2:r=16711680;break;case 3:r=0;break;case 4:r=255;break;default:r=0}var o=this.buffer,a;for(a=0;a<256*240;a++)o[a]=r;var h=this.pixrendered;for(a=0;a<h.length;a++)h[a]=65},endFrame:function(){var r,o,a,h=this.buffer;if(this.showSpr0Hit){if(this.sprX[0]>=0&&this.sprX[0]<256&&this.sprY[0]>=0&&this.sprY[0]<240){for(r=0;r<256;r++)h[(this.sprY[0]<<8)+r]=16733525;for(r=0;r<240;r++)h[(r<<8)+this.sprX[0]]=16733525}if(this.spr0HitX>=0&&this.spr0HitX<256&&this.spr0HitY>=0&&this.spr0HitY<240){for(r=0;r<256;r++)h[(this.spr0HitY<<8)+r]=5635925;for(r=0;r<240;r++)h[(r<<8)+this.spr0HitX]=5635925}}if(this.clipToTvSize||this.f_bgClipping===0||this.f_spClipping===0)for(a=0;a<240;a++)for(o=0;o<8;o++)h[(a<<8)+o]=0;if(this.clipToTvSize)for(a=0;a<240;a++)for(o=0;o<8;o++)h[(a<<8)+255-o]=0;if(this.clipToTvSize)for(a=0;a<8;a++)for(o=0;o<256;o++)h[(a<<8)+o]=0,h[(239-a<<8)+o]=0;this.nes.ui.writeFrame(h)},updateControlReg1:function(r){this.triggerRendering(),this.f_nmiOnVblank=r>>7&1,this.f_spriteSize=r>>5&1,this.f_bgPatternTable=r>>4&1,this.f_spPatternTable=r>>3&1,this.f_addrInc=r>>2&1,this.f_nTblAddress=r&3,this.regV=r>>1&1,this.regH=r&1,this.regS=r>>4&1},updateControlReg2:function(r){this.triggerRendering(),this.f_color=r>>5&7,this.f_spVisibility=r>>4&1,this.f_bgVisibility=r>>3&1,this.f_spClipping=r>>2&1,this.f_bgClipping=r>>1&1,this.f_dispType=r&1,this.f_dispType===0&&this.palTable.setEmphasis(this.f_color),this.updatePalettes()},setStatusFlag:function(r,o){var a=1<<r;this.nes.cpu.mem[8194]=this.nes.cpu.mem[8194]&255-a|(o?a:0)},readStatusRegister:function(){var r=this.nes.cpu.mem[8194];return this.firstWrite=!0,this.setStatusFlag(this.STATUS_VBLANK,!1),r},writeSRAMAddress:function(r){this.sramAddress=r},sramLoad:function(){return this.spriteMem[this.sramAddress]},sramWrite:function(r){this.spriteMem[this.sramAddress]=r,this.spriteRamWriteUpdate(this.sramAddress,r),this.sramAddress++,this.sramAddress%=256},scrollWrite:function(r){this.triggerRendering(),this.firstWrite?(this.regHT=r>>3&31,this.regFH=r&7):(this.regFV=r&7,this.regVT=r>>3&31),this.firstWrite=!this.firstWrite},writeVRAMAddress:function(r){this.firstWrite?(this.regFV=r>>4&3,this.regV=r>>3&1,this.regH=r>>2&1,this.regVT=this.regVT&7|(r&3)<<3):(this.triggerRendering(),this.regVT=this.regVT&24|r>>5&7,this.regHT=r&31,this.cntFV=this.regFV,this.cntV=this.regV,this.cntH=this.regH,this.cntVT=this.regVT,this.cntHT=this.regHT,this.checkSprite0(this.scanline-20)),this.firstWrite=!this.firstWrite,this.cntsToAddress(),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress)},vramLoad:function(){var r;return this.cntsToAddress(),this.regsToAddress(),this.vramAddress<=16127?(r=this.vramBufferedReadValue,this.vramAddress<8192?this.vramBufferedReadValue=this.vramMem[this.vramAddress]:this.vramBufferedReadValue=this.mirroredLoad(this.vramAddress),this.vramAddress<8192&&this.nes.mmap.latchAccess(this.vramAddress),this.vramAddress+=this.f_addrInc===1?32:1,this.cntsFromAddress(),this.regsFromAddress(),r):(r=this.mirroredLoad(this.vramAddress),this.vramAddress+=this.f_addrInc===1?32:1,this.cntsFromAddress(),this.regsFromAddress(),r)},vramWrite:function(r){this.triggerRendering(),this.cntsToAddress(),this.regsToAddress(),this.vramAddress>=8192?this.mirroredWrite(this.vramAddress,r):(this.writeMem(this.vramAddress,r),this.nes.mmap.latchAccess(this.vramAddress)),this.vramAddress+=this.f_addrInc===1?32:1,this.regsFromAddress(),this.cntsFromAddress()},sramDMA:function(r){for(var o=r*256,a,h=this.sramAddress;h<256;h++)a=this.nes.cpu.mem[o+h],this.spriteMem[h]=a,this.spriteRamWriteUpdate(h,a);this.nes.cpu.haltCycles(513)},regsFromAddress:function(){var r=this.vramTmpAddress>>8&255;this.regFV=r>>4&7,this.regV=r>>3&1,this.regH=r>>2&1,this.regVT=this.regVT&7|(r&3)<<3,r=this.vramTmpAddress&255,this.regVT=this.regVT&24|r>>5&7,this.regHT=r&31},cntsFromAddress:function(){var r=this.vramAddress>>8&255;this.cntFV=r>>4&3,this.cntV=r>>3&1,this.cntH=r>>2&1,this.cntVT=this.cntVT&7|(r&3)<<3,r=this.vramAddress&255,this.cntVT=this.cntVT&24|r>>5&7,this.cntHT=r&31},regsToAddress:function(){var r=(this.regFV&7)<<4;r|=(this.regV&1)<<3,r|=(this.regH&1)<<2,r|=this.regVT>>3&3;var o=(this.regVT&7)<<5;o|=this.regHT&31,this.vramTmpAddress=(r<<8|o)&32767},cntsToAddress:function(){var r=(this.cntFV&7)<<4;r|=(this.cntV&1)<<3,r|=(this.cntH&1)<<2,r|=this.cntVT>>3&3;var o=(this.cntVT&7)<<5;o|=this.cntHT&31,this.vramAddress=(r<<8|o)&32767},incTileCounter:function(r){for(var o=r;o!==0;o--)this.cntHT++,this.cntHT===32&&(this.cntHT=0,this.cntVT++,this.cntVT>=30&&(this.cntH++,this.cntH===2&&(this.cntH=0,this.cntV++,this.cntV===2&&(this.cntV=0,this.cntFV++,this.cntFV&=7))))},mirroredLoad:function(r){return this.vramMem[this.vramMirrorTable[r]]},mirroredWrite:function(r,o){if(r>=16128&&r<16160)r===16128||r===16144?(this.writeMem(16128,o),this.writeMem(16144,o)):r===16132||r===16148?(this.writeMem(16132,o),this.writeMem(16148,o)):r===16136||r===16152?(this.writeMem(16136,o),this.writeMem(16152,o)):r===16140||r===16156?(this.writeMem(16140,o),this.writeMem(16156,o)):this.writeMem(r,o);else if(r<this.vramMirrorTable.length)this.writeMem(this.vramMirrorTable[r],o);else throw new Error("Invalid VRAM address: "+r.toString(16))},triggerRendering:function(){this.scanline>=21&&this.scanline<=260&&(this.renderFramePartially(this.lastRenderedScanline+1,this.scanline-21-this.lastRenderedScanline),this.lastRenderedScanline=this.scanline-21)},renderFramePartially:function(r,o){if(this.f_spVisibility===1&&this.renderSpritesPartially(r,o,!0),this.f_bgVisibility===1){var a=r<<8,h=r+o<<8;h>61440&&(h=61440);for(var l=this.buffer,c=this.bgbuffer,f=this.pixrendered,u=a;u<h;u++)f[u]>255&&(l[u]=c[u])}this.f_spVisibility===1&&this.renderSpritesPartially(r,o,!1),this.validTileData=!1},renderBgScanline:function(r,o){var a=this.regS===0?0:256,h=(o<<8)-this.regFH;if(this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],this.cntHT=this.regHT,this.cntH=this.regH,this.curNt=this.ntable1[this.cntV+this.cntV+this.cntH],o<240&&o-this.cntFV>=0){for(var l=this.cntFV<<3,c=this.scantile,f=this.attrib,u=this.ptTile,p=this.nameTable,_=this.imgPalette,R=this.pixrendered,P=r?this.bgbuffer:this.buffer,A,T,k,v,j=0;j<32;j++){if(o>=0){if(this.validTileData){if(A=c[j],typeof A>"u")continue;T=A.pix,k=f[j]}else{if(A=u[a+p[this.curNt].getTileIndex(this.cntHT,this.cntVT)],typeof A>"u")continue;T=A.pix,k=p[this.curNt].getAttrib(this.cntHT,this.cntVT),c[j]=A,f[j]=k}var te=0,z=(j<<3)-this.regFH;if(z>-8)if(z<0&&(h-=z,te=-z),A.opaque[this.cntFV])for(;te<8;te++)P[h]=_[T[l+te]+k],R[h]|=256,h++;else for(;te<8;te++)v=T[l+te],v!==0&&(P[h]=_[v+k],R[h]|=256),h++}++this.cntHT===32&&(this.cntHT=0,this.cntH++,this.cntH%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH])}this.validTileData=!0}this.cntFV++,this.cntFV===8&&(this.cntFV=0,this.cntVT++,this.cntVT===30?(this.cntVT=0,this.cntV++,this.cntV%=2,this.curNt=this.ntable1[(this.cntV<<1)+this.cntH]):this.cntVT===32&&(this.cntVT=0),this.validTileData=!1)},renderSpritesPartially:function(r,o,a){if(this.f_spVisibility===1){for(var h=0;h<64;h++)if(this.bgPriority[h]===a&&this.sprX[h]>=0&&this.sprX[h]<256&&this.sprY[h]+8>=r&&this.sprY[h]<r+o)if(this.f_spriteSize===0)this.srcy1=0,this.srcy2=8,this.sprY[h]<r&&(this.srcy1=r-this.sprY[h]-1),this.sprY[h]+8>r+o&&(this.srcy2=r+o-this.sprY[h]+1),this.f_spPatternTable===0?this.ptTile[this.sprTile[h]].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[h],this.sprY[h]+1,this.sprCol[h],this.sprPalette,this.horiFlip[h],this.vertFlip[h],h,this.pixrendered):this.ptTile[this.sprTile[h]+256].render(this.buffer,0,this.srcy1,8,this.srcy2,this.sprX[h],this.sprY[h]+1,this.sprCol[h],this.sprPalette,this.horiFlip[h],this.vertFlip[h],h,this.pixrendered);else{var l=this.sprTile[h];l&1&&(l=this.sprTile[h]-1+256);var c=0,f=8;this.sprY[h]<r&&(c=r-this.sprY[h]-1),this.sprY[h]+8>r+o&&(f=r+o-this.sprY[h]),this.ptTile[l+(this.vertFlip[h]?1:0)].render(this.buffer,0,c,8,f,this.sprX[h],this.sprY[h]+1,this.sprCol[h],this.sprPalette,this.horiFlip[h],this.vertFlip[h],h,this.pixrendered),c=0,f=8,this.sprY[h]+8<r&&(c=r-(this.sprY[h]+8+1)),this.sprY[h]+16>r+o&&(f=r+o-(this.sprY[h]+8)),this.ptTile[l+(this.vertFlip[h]?0:1)].render(this.buffer,0,c,8,f,this.sprX[h],this.sprY[h]+1+8,this.sprCol[h],this.sprPalette,this.horiFlip[h],this.vertFlip[h],h,this.pixrendered)}}},checkSprite0:function(r){this.spr0HitX=-1,this.spr0HitY=-1;var o,a=this.f_spPatternTable===0?0:256,h,l,c,f,u;if(h=this.sprX[0],l=this.sprY[0]+1,this.f_spriteSize===0){if(l<=r&&l+8>r&&h>=-7&&h<256)if(c=this.ptTile[this.sprTile[0]+a],this.vertFlip[0]?o=7-(r-l):o=r-l,o*=8,u=r*256+h,this.horiFlip[0])for(f=7;f>=0;f--){if(h>=0&&h<256&&u>=0&&u<61440&&this.pixrendered[u]!==0&&c.pix[o+f]!==0)return this.spr0HitX=u%256,this.spr0HitY=r,!0;h++,u++}else for(f=0;f<8;f++){if(h>=0&&h<256&&u>=0&&u<61440&&this.pixrendered[u]!==0&&c.pix[o+f]!==0)return this.spr0HitX=u%256,this.spr0HitY=r,!0;h++,u++}}else if(l<=r&&l+16>r&&h>=-7&&h<256)if(this.vertFlip[0]?o=15-(r-l):o=r-l,o<8?c=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?1:0)+(this.sprTile[0]&1?255:0)]:(c=this.ptTile[this.sprTile[0]+(this.vertFlip[0]?0:1)+(this.sprTile[0]&1?255:0)],this.vertFlip[0]?o=15-o:o-=8),o*=8,u=r*256+h,this.horiFlip[0])for(f=7;f>=0;f--){if(h>=0&&h<256&&u>=0&&u<61440&&this.pixrendered[u]!==0&&c.pix[o+f]!==0)return this.spr0HitX=u%256,this.spr0HitY=r,!0;h++,u++}else for(f=0;f<8;f++){if(h>=0&&h<256&&u>=0&&u<61440&&this.pixrendered[u]!==0&&c.pix[o+f]!==0)return this.spr0HitX=u%256,this.spr0HitY=r,!0;h++,u++}return!1},writeMem:function(r,o){this.vramMem[r]=o,r<8192?(this.vramMem[r]=o,this.patternWrite(r,o)):r>=8192&&r<9152?this.nameTableWrite(this.ntable1[0],r-8192,o):r>=9152&&r<9216?this.attribTableWrite(this.ntable1[0],r-9152,o):r>=9216&&r<10176?this.nameTableWrite(this.ntable1[1],r-9216,o):r>=10176&&r<10240?this.attribTableWrite(this.ntable1[1],r-10176,o):r>=10240&&r<11200?this.nameTableWrite(this.ntable1[2],r-10240,o):r>=11200&&r<11264?this.attribTableWrite(this.ntable1[2],r-11200,o):r>=11264&&r<12224?this.nameTableWrite(this.ntable1[3],r-11264,o):r>=12224&&r<12288?this.attribTableWrite(this.ntable1[3],r-12224,o):r>=16128&&r<16160&&this.updatePalettes()},updatePalettes:function(){var r;for(r=0;r<16;r++)this.f_dispType===0?this.imgPalette[r]=this.palTable.getEntry(this.vramMem[16128+r]&63):this.imgPalette[r]=this.palTable.getEntry(this.vramMem[16128+r]&32);for(r=0;r<16;r++)this.f_dispType===0?this.sprPalette[r]=this.palTable.getEntry(this.vramMem[16144+r]&63):this.sprPalette[r]=this.palTable.getEntry(this.vramMem[16144+r]&32)},patternWrite:function(r,o){var a=Math.floor(r/16),h=r%16;h<8?this.ptTile[a].setScanline(h,o,this.vramMem[r+8]):this.ptTile[a].setScanline(h-8,this.vramMem[r-8],o)},nameTableWrite:function(r,o,a){this.nameTable[r].tile[o]=a,this.checkSprite0(this.scanline-20)},attribTableWrite:function(r,o,a){this.nameTable[r].writeAttrib(o,a)},spriteRamWriteUpdate:function(r,o){var a=Math.floor(r/4);a===0&&this.checkSprite0(this.scanline-20),r%4===0?this.sprY[a]=o:r%4===1?this.sprTile[a]=o:r%4===2?(this.vertFlip[a]=(o&128)!==0,this.horiFlip[a]=(o&64)!==0,this.bgPriority[a]=(o&32)!==0,this.sprCol[a]=(o&3)<<2):r%4===3&&(this.sprX[a]=o)},doNMI:function(){this.setStatusFlag(this.STATUS_VBLANK,!0),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NMI)},isPixelWhite:function(r,o){return this.triggerRendering(),this.nes.ppu.buffer[(o<<8)+r]===16777215},JSON_PROPERTIES:["vramMem","spriteMem","cntFV","cntV","cntH","cntVT","cntHT","regFV","regV","regH","regVT","regHT","regFH","regS","vramAddress","vramTmpAddress","f_nmiOnVblank","f_spriteSize","f_bgPatternTable","f_spPatternTable","f_addrInc","f_nTblAddress","f_color","f_spVisibility","f_bgVisibility","f_spClipping","f_bgClipping","f_dispType","vramBufferedReadValue","firstWrite","currentMirroring","vramMirrorTable","ntable1","sramAddress","hitSpr0","sprPalette","imgPalette","curX","scanline","lastRenderedScanline","curNt","scantile","attrib","buffer","bgbuffer","pixrendered","requestEndFrame","nmiOk","dummyCycleToggle","nmiCounter","validTileData","scanlineAlreadyRendered"],toJSON:function(){var r,o=t.toJSON(this);for(o.nameTable=[],r=0;r<this.nameTable.length;r++)o.nameTable[r]=this.nameTable[r].toJSON();for(o.ptTile=[],r=0;r<this.ptTile.length;r++)o.ptTile[r]=this.ptTile[r].toJSON();return o},fromJSON:function(r){var o;for(t.fromJSON(this,r),o=0;o<this.nameTable.length;o++)this.nameTable[o].fromJSON(r.nameTable[o]);for(o=0;o<this.ptTile.length;o++)this.ptTile[o].fromJSON(r.ptTile[o]);for(o=0;o<this.spriteMem.length;o++)this.spriteRamWriteUpdate(o,this.spriteMem[o])}};var i=function(r,o,a){this.width=r,this.height=o,this.name=a,this.tile=new Array(r*o),this.attrib=new Array(r*o);for(var h=0;h<r*o;h++)this.tile[h]=0,this.attrib[h]=0};i.prototype={getTileIndex:function(r,o){return this.tile[o*this.width+r]},getAttrib:function(r,o){return this.attrib[o*this.width+r]},writeAttrib:function(r,o){for(var a=r%8*4,h=Math.floor(r/8)*4,l,c,f,u,p=0;p<2;p++)for(var _=0;_<2;_++){l=o>>2*(p*2+_)&3;for(var R=0;R<2;R++)for(var P=0;P<2;P++)c=a+_*2+P,f=h+p*2+R,u=f*this.width+c,this.attrib[u]=l<<2&12}},toJSON:function(){return{tile:this.tile,attrib:this.attrib}},fromJSON:function(r){this.tile=r.tile,this.attrib=r.attrib}};var n=function(){this.curTable=new Array(64),this.emphTable=new Array(8),this.currentEmph=-1};return n.prototype={reset:function(){this.setEmphasis(0)},loadNTSCPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},loadPALPalette:function(){this.curTable=[5395026,11796480,10485760,11599933,7602281,91,95,6208,12048,543240,26368,1196544,7153664,0,0,0,12899815,16728064,14421538,16729963,14090399,6818519,6588,21681,27227,35843,43776,2918400,10777088,0,0,0,16316664,16755516,16742785,16735173,16730354,14633471,4681215,46327,57599,58229,259115,7911470,15065624,7895160,0,0,16777215,16773822,16300216,16300248,16758527,16761855,13095423,10148607,8973816,8650717,12122296,16119980,16777136,16308472,0,0],this.makeTables(),this.setEmphasis(0)},makeTables:function(){for(var r,o,a,h,l,c,f,u,p=0;p<8;p++)for(c=1,f=1,u=1,p&1&&(c=.75,u=.75),p&2&&(c=.75,f=.75),p&4&&(f=.75,u=.75),this.emphTable[p]=new Array(64),l=0;l<64;l++)h=this.curTable[l],r=Math.floor(this.getRed(h)*c),o=Math.floor(this.getGreen(h)*f),a=Math.floor(this.getBlue(h)*u),this.emphTable[p][l]=this.getRgb(r,o,a)},setEmphasis:function(r){if(r!==this.currentEmph){this.currentEmph=r;for(var o=0;o<64;o++)this.curTable[o]=this.emphTable[r][o]}},getEntry:function(r){return this.curTable[r]},getRed:function(r){return r>>16&255},getGreen:function(r){return r>>8&255},getBlue:function(r){return r&255},getRgb:function(r,o,a){return r<<16|o<<8|a},loadDefaultPalette:function(){this.curTable[0]=this.getRgb(117,117,117),this.curTable[1]=this.getRgb(39,27,143),this.curTable[2]=this.getRgb(0,0,171),this.curTable[3]=this.getRgb(71,0,159),this.curTable[4]=this.getRgb(143,0,119),this.curTable[5]=this.getRgb(171,0,19),this.curTable[6]=this.getRgb(167,0,0),this.curTable[7]=this.getRgb(127,11,0),this.curTable[8]=this.getRgb(67,47,0),this.curTable[9]=this.getRgb(0,71,0),this.curTable[10]=this.getRgb(0,81,0),this.curTable[11]=this.getRgb(0,63,23),this.curTable[12]=this.getRgb(27,63,95),this.curTable[13]=this.getRgb(0,0,0),this.curTable[14]=this.getRgb(0,0,0),this.curTable[15]=this.getRgb(0,0,0),this.curTable[16]=this.getRgb(188,188,188),this.curTable[17]=this.getRgb(0,115,239),this.curTable[18]=this.getRgb(35,59,239),this.curTable[19]=this.getRgb(131,0,243),this.curTable[20]=this.getRgb(191,0,191),this.curTable[21]=this.getRgb(231,0,91),this.curTable[22]=this.getRgb(219,43,0),this.curTable[23]=this.getRgb(203,79,15),this.curTable[24]=this.getRgb(139,115,0),this.curTable[25]=this.getRgb(0,151,0),this.curTable[26]=this.getRgb(0,171,0),this.curTable[27]=this.getRgb(0,147,59),this.curTable[28]=this.getRgb(0,131,139),this.curTable[29]=this.getRgb(0,0,0),this.curTable[30]=this.getRgb(0,0,0),this.curTable[31]=this.getRgb(0,0,0),this.curTable[32]=this.getRgb(255,255,255),this.curTable[33]=this.getRgb(63,191,255),this.curTable[34]=this.getRgb(95,151,255),this.curTable[35]=this.getRgb(167,139,253),this.curTable[36]=this.getRgb(247,123,255),this.curTable[37]=this.getRgb(255,119,183),this.curTable[38]=this.getRgb(255,119,99),this.curTable[39]=this.getRgb(255,155,59),this.curTable[40]=this.getRgb(243,191,63),this.curTable[41]=this.getRgb(131,211,19),this.curTable[42]=this.getRgb(79,223,75),this.curTable[43]=this.getRgb(88,248,152),this.curTable[44]=this.getRgb(0,235,219),this.curTable[45]=this.getRgb(0,0,0),this.curTable[46]=this.getRgb(0,0,0),this.curTable[47]=this.getRgb(0,0,0),this.curTable[48]=this.getRgb(255,255,255),this.curTable[49]=this.getRgb(171,231,255),this.curTable[50]=this.getRgb(199,215,255),this.curTable[51]=this.getRgb(215,203,255),this.curTable[52]=this.getRgb(255,199,255),this.curTable[53]=this.getRgb(255,199,219),this.curTable[54]=this.getRgb(255,191,179),this.curTable[55]=this.getRgb(255,219,171),this.curTable[56]=this.getRgb(255,231,163),this.curTable[57]=this.getRgb(227,255,163),this.curTable[58]=this.getRgb(171,243,191),this.curTable[59]=this.getRgb(179,255,207),this.curTable[60]=this.getRgb(159,255,243),this.curTable[61]=this.getRgb(0,0,0),this.curTable[62]=this.getRgb(0,0,0),this.curTable[63]=this.getRgb(0,0,0),this.makeTables(),this.setEmphasis(0)}},Gi=s,Gi}var qi,Ur;function gf(){if(Ur)return qi;Ur=1;var e=Si(),t=17897725e-1,s=function(a){this.nes=a,this.square1=new r(this,!0),this.square2=new r(this,!1),this.triangle=new o(this),this.noise=new n(this),this.dmc=new i(this),this.frameIrqCounter=null,this.frameIrqCounterMax=4,this.initCounter=2048,this.channelEnableValue=null,this.sampleRate=44100,this.lengthLookup=null,this.dmcFreqLookup=null,this.noiseWavelengthLookup=null,this.square_table=null,this.tnd_table=null,this.frameIrqEnabled=!1,this.frameIrqActive=null,this.frameClockNow=null,this.startedPlaying=!1,this.recordOutput=!1,this.initingHardware=!1,this.masterFrameCounter=null,this.derivedFrameCounter=null,this.countSequence=null,this.sampleTimer=null,this.frameTime=null,this.sampleTimerMax=null,this.sampleCount=null,this.triValue=0,this.smpSquare1=null,this.smpSquare2=null,this.smpTriangle=null,this.smpDmc=null,this.accCount=null,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.dacRange=0,this.dcValue=0,this.masterVolume=256,this.stereoPosLSquare1=null,this.stereoPosLSquare2=null,this.stereoPosLTriangle=null,this.stereoPosLNoise=null,this.stereoPosLDMC=null,this.stereoPosRSquare1=null,this.stereoPosRSquare2=null,this.stereoPosRTriangle=null,this.stereoPosRNoise=null,this.stereoPosRDMC=null,this.extraCycles=null,this.maxSample=null,this.minSample=null,this.panning=[80,170,100,150,128],this.setPanning(this.panning),this.initLengthLookup(),this.initDmcFrequencyLookup(),this.initNoiseWavelengthLookup(),this.initDACtables();for(var h=0;h<20;h++)h===16?this.writeReg(16400,16):this.writeReg(16384+h,0);this.reset()};s.prototype={reset:function(){this.sampleRate=this.nes.opts.sampleRate,this.sampleTimerMax=Math.floor(1024*t*this.nes.opts.preferredFrameRate/(this.sampleRate*60)),this.frameTime=Math.floor(14915*this.nes.opts.preferredFrameRate/60),this.sampleTimer=0,this.updateChannelEnable(0),this.masterFrameCounter=0,this.derivedFrameCounter=0,this.countSequence=0,this.sampleCount=0,this.initCounter=2048,this.frameIrqEnabled=!1,this.initingHardware=!1,this.resetCounter(),this.square1.reset(),this.square2.reset(),this.triangle.reset(),this.noise.reset(),this.dmc.reset(),this.accCount=0,this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0,this.frameIrqEnabled=!1,this.frameIrqCounterMax=4,this.channelEnableValue=255,this.startedPlaying=!1,this.prevSampleL=0,this.prevSampleR=0,this.smpAccumL=0,this.smpAccumR=0,this.maxSample=-5e5,this.minSample=5e5},readReg:function(a){var h=0;return h|=this.square1.getLengthStatus(),h|=this.square2.getLengthStatus()<<1,h|=this.triangle.getLengthStatus()<<2,h|=this.noise.getLengthStatus()<<3,h|=this.dmc.getLengthStatus()<<4,h|=(this.frameIrqActive&&this.frameIrqEnabled?1:0)<<6,h|=this.dmc.getIrqStatus()<<7,this.frameIrqActive=!1,this.dmc.irqGenerated=!1,h&65535},writeReg:function(a,h){a>=16384&&a<16388?this.square1.writeReg(a,h):a>=16388&&a<16392?this.square2.writeReg(a,h):a>=16392&&a<16396?this.triangle.writeReg(a,h):a>=16396&&a<=16399?this.noise.writeReg(a,h):a===16400?this.dmc.writeReg(a,h):a===16401?this.dmc.writeReg(a,h):a===16402?this.dmc.writeReg(a,h):a===16403?this.dmc.writeReg(a,h):a===16405?(this.updateChannelEnable(h),h!==0&&this.initCounter>0&&(this.initingHardware=!0),this.dmc.writeReg(a,h)):a===16407&&(this.countSequence=h>>7&1,this.masterFrameCounter=0,this.frameIrqActive=!1,h>>6&1?this.frameIrqEnabled=!1:this.frameIrqEnabled=!0,this.countSequence===0?(this.frameIrqCounterMax=4,this.derivedFrameCounter=4):(this.frameIrqCounterMax=5,this.derivedFrameCounter=0,this.frameCounterTick()))},resetCounter:function(){this.countSequence===0?this.derivedFrameCounter=4:this.derivedFrameCounter=0},updateChannelEnable:function(a){this.channelEnableValue=a&65535,this.square1.setEnabled((a&1)!==0),this.square2.setEnabled((a&2)!==0),this.triangle.setEnabled((a&4)!==0),this.noise.setEnabled((a&8)!==0),this.dmc.setEnabled((a&16)!==0)},clockFrameCounter:function(a){if(this.initCounter>0&&this.initingHardware){this.initCounter-=a,this.initCounter<=0&&(this.initingHardware=!1);return}a+=this.extraCycles;var h=this.sampleTimerMax-this.sampleTimer;a<<10>h?(this.extraCycles=(a<<10)-h>>10,a-=this.extraCycles):this.extraCycles=0;var l=this.dmc,c=this.triangle,f=this.square1,u=this.square2,p=this.noise;if(l.isEnabled)for(l.shiftCounter-=a<<3;l.shiftCounter<=0&&l.dmaFrequency>0;)l.shiftCounter+=l.dmaFrequency,l.clockDmc();if(c.progTimerMax>0)for(c.progTimerCount-=a;c.progTimerCount<=0;)c.progTimerCount+=c.progTimerMax+1,c.linearCounter>0&&c.lengthCounter>0&&(c.triangleCounter++,c.triangleCounter&=31,c.isEnabled&&(c.triangleCounter>=16?c.sampleValue=c.triangleCounter&15:c.sampleValue=15-(c.triangleCounter&15),c.sampleValue<<=4));f.progTimerCount-=a,f.progTimerCount<=0&&(f.progTimerCount+=f.progTimerMax+1<<1,f.squareCounter++,f.squareCounter&=7,f.updateSampleValue()),u.progTimerCount-=a,u.progTimerCount<=0&&(u.progTimerCount+=u.progTimerMax+1<<1,u.squareCounter++,u.squareCounter&=7,u.updateSampleValue());var _=a;if(p.progTimerCount-_>0)p.progTimerCount-=_,p.accCount+=_,p.accValue+=_*p.sampleValue;else for(;_-- >0;)--p.progTimerCount<=0&&p.progTimerMax>0&&(p.shiftReg<<=1,p.tmp=(p.shiftReg<<(p.randomMode===0?1:6)^p.shiftReg)&32768,p.tmp!==0?(p.shiftReg|=1,p.randomBit=0,p.sampleValue=0):(p.randomBit=1,p.isEnabled&&p.lengthCounter>0?p.sampleValue=p.masterVolume:p.sampleValue=0),p.progTimerCount+=p.progTimerMax),p.accValue+=p.sampleValue,p.accCount++;this.frameIrqEnabled&&this.frameIrqActive&&this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.masterFrameCounter+=a<<1,this.masterFrameCounter>=this.frameTime&&(this.masterFrameCounter-=this.frameTime,this.frameCounterTick()),this.accSample(a),this.sampleTimer+=a<<10,this.sampleTimer>=this.sampleTimerMax&&(this.sample(),this.sampleTimer-=this.sampleTimerMax)},accSample:function(a){this.triangle.sampleCondition&&(this.triValue=Math.floor((this.triangle.progTimerCount<<4)/(this.triangle.progTimerMax+1)),this.triValue>16&&(this.triValue=16),this.triangle.triangleCounter>=16&&(this.triValue=16-this.triValue),this.triValue+=this.triangle.sampleValue),a===2?(this.smpTriangle+=this.triValue<<1,this.smpDmc+=this.dmc.sample<<1,this.smpSquare1+=this.square1.sampleValue<<1,this.smpSquare2+=this.square2.sampleValue<<1,this.accCount+=2):a===4?(this.smpTriangle+=this.triValue<<2,this.smpDmc+=this.dmc.sample<<2,this.smpSquare1+=this.square1.sampleValue<<2,this.smpSquare2+=this.square2.sampleValue<<2,this.accCount+=4):(this.smpTriangle+=a*this.triValue,this.smpDmc+=a*this.dmc.sample,this.smpSquare1+=a*this.square1.sampleValue,this.smpSquare2+=a*this.square2.sampleValue,this.accCount+=a)},frameCounterTick:function(){this.derivedFrameCounter++,this.derivedFrameCounter>=this.frameIrqCounterMax&&(this.derivedFrameCounter=0),(this.derivedFrameCounter===1||this.derivedFrameCounter===3)&&(this.triangle.clockLengthCounter(),this.square1.clockLengthCounter(),this.square2.clockLengthCounter(),this.noise.clockLengthCounter(),this.square1.clockSweep(),this.square2.clockSweep()),this.derivedFrameCounter>=0&&this.derivedFrameCounter<4&&(this.square1.clockEnvDecay(),this.square2.clockEnvDecay(),this.noise.clockEnvDecay(),this.triangle.clockLinearCounter()),this.derivedFrameCounter===3&&this.countSequence===0&&(this.frameIrqActive=!0)},sample:function(){var a,h;this.accCount>0?(this.smpSquare1<<=4,this.smpSquare1=Math.floor(this.smpSquare1/this.accCount),this.smpSquare2<<=4,this.smpSquare2=Math.floor(this.smpSquare2/this.accCount),this.smpTriangle=Math.floor(this.smpTriangle/this.accCount),this.smpDmc<<=4,this.smpDmc=Math.floor(this.smpDmc/this.accCount),this.accCount=0):(this.smpSquare1=this.square1.sampleValue<<4,this.smpSquare2=this.square2.sampleValue<<4,this.smpTriangle=this.triangle.sampleValue,this.smpDmc=this.dmc.sample<<4);var l=Math.floor((this.noise.accValue<<4)/this.noise.accCount);this.noise.accValue=l>>4,this.noise.accCount=1,a=this.smpSquare1*this.stereoPosLSquare1+this.smpSquare2*this.stereoPosLSquare2>>8,h=3*this.smpTriangle*this.stereoPosLTriangle+(l<<1)*this.stereoPosLNoise+this.smpDmc*this.stereoPosLDMC>>8,a>=this.square_table.length&&(a=this.square_table.length-1),h>=this.tnd_table.length&&(h=this.tnd_table.length-1);var c=this.square_table[a]+this.tnd_table[h]-this.dcValue;a=this.smpSquare1*this.stereoPosRSquare1+this.smpSquare2*this.stereoPosRSquare2>>8,h=3*this.smpTriangle*this.stereoPosRTriangle+(l<<1)*this.stereoPosRNoise+this.smpDmc*this.stereoPosRDMC>>8,a>=this.square_table.length&&(a=this.square_table.length-1),h>=this.tnd_table.length&&(h=this.tnd_table.length-1);var f=this.square_table[a]+this.tnd_table[h]-this.dcValue,u=c-this.prevSampleL;this.prevSampleL+=u,this.smpAccumL+=u-(this.smpAccumL>>10),c=this.smpAccumL;var p=f-this.prevSampleR;this.prevSampleR+=p,this.smpAccumR+=p-(this.smpAccumR>>10),f=this.smpAccumR,c>this.maxSample&&(this.maxSample=c),c<this.minSample&&(this.minSample=c),this.nes.opts.onAudioSample&&this.nes.opts.onAudioSample(c/32768,f/32768),this.smpSquare1=0,this.smpSquare2=0,this.smpTriangle=0,this.smpDmc=0},getLengthMax:function(a){return this.lengthLookup[a>>3]},getDmcFrequency:function(a){return a>=0&&a<16?this.dmcFreqLookup[a]:0},getNoiseWaveLength:function(a){return a>=0&&a<16?this.noiseWavelengthLookup[a]:0},setPanning:function(a){for(var h=0;h<5;h++)this.panning[h]=a[h];this.updateStereoPos()},setMasterVolume:function(a){a<0&&(a=0),a>256&&(a=256),this.masterVolume=a,this.updateStereoPos()},updateStereoPos:function(){this.stereoPosLSquare1=this.panning[0]*this.masterVolume>>8,this.stereoPosLSquare2=this.panning[1]*this.masterVolume>>8,this.stereoPosLTriangle=this.panning[2]*this.masterVolume>>8,this.stereoPosLNoise=this.panning[3]*this.masterVolume>>8,this.stereoPosLDMC=this.panning[4]*this.masterVolume>>8,this.stereoPosRSquare1=this.masterVolume-this.stereoPosLSquare1,this.stereoPosRSquare2=this.masterVolume-this.stereoPosLSquare2,this.stereoPosRTriangle=this.masterVolume-this.stereoPosLTriangle,this.stereoPosRNoise=this.masterVolume-this.stereoPosLNoise,this.stereoPosRDMC=this.masterVolume-this.stereoPosLDMC},initLengthLookup:function(){this.lengthLookup=[10,254,20,2,40,4,80,6,160,8,60,10,14,12,26,14,12,16,24,18,48,20,96,22,192,24,72,26,16,28,32,30]},initDmcFrequencyLookup:function(){this.dmcFreqLookup=new Array(16),this.dmcFreqLookup[0]=3424,this.dmcFreqLookup[1]=3040,this.dmcFreqLookup[2]=2720,this.dmcFreqLookup[3]=2560,this.dmcFreqLookup[4]=2288,this.dmcFreqLookup[5]=2032,this.dmcFreqLookup[6]=1808,this.dmcFreqLookup[7]=1712,this.dmcFreqLookup[8]=1520,this.dmcFreqLookup[9]=1280,this.dmcFreqLookup[10]=1136,this.dmcFreqLookup[11]=1024,this.dmcFreqLookup[12]=848,this.dmcFreqLookup[13]=672,this.dmcFreqLookup[14]=576,this.dmcFreqLookup[15]=432},initNoiseWavelengthLookup:function(){this.noiseWavelengthLookup=new Array(16),this.noiseWavelengthLookup[0]=4,this.noiseWavelengthLookup[1]=8,this.noiseWavelengthLookup[2]=16,this.noiseWavelengthLookup[3]=32,this.noiseWavelengthLookup[4]=64,this.noiseWavelengthLookup[5]=96,this.noiseWavelengthLookup[6]=128,this.noiseWavelengthLookup[7]=160,this.noiseWavelengthLookup[8]=202,this.noiseWavelengthLookup[9]=254,this.noiseWavelengthLookup[10]=380,this.noiseWavelengthLookup[11]=508,this.noiseWavelengthLookup[12]=762,this.noiseWavelengthLookup[13]=1016,this.noiseWavelengthLookup[14]=2034,this.noiseWavelengthLookup[15]=4068},initDACtables:function(){var a,h,l,c=0,f=0;for(this.square_table=new Array(32*16),this.tnd_table=new Array(204*16),l=0;l<32*16;l++)a=95.52/(8128/(l/16)+100),a*=.98411,a*=5e4,h=Math.floor(a),this.square_table[l]=h,h>c&&(c=h);for(l=0;l<204*16;l++)a=163.67/(24329/(l/16)+100),a*=.98411,a*=5e4,h=Math.floor(a),this.tnd_table[l]=h,h>f&&(f=h);this.dacRange=c+f,this.dcValue=this.dacRange/2},JSON_PROPERTIES:["frameIrqCounter","frameIrqCounterMax","initCounter","channelEnableValue","sampleRate","frameIrqEnabled","frameIrqActive","frameClockNow","startedPlaying","recordOutput","initingHardware","masterFrameCounter","derivedFrameCounter","countSequence","sampleTimer","frameTime","sampleTimerMax","sampleCount","triValue","smpSquare1","smpSquare2","smpTriangle","smpDmc","accCount","prevSampleL","prevSampleR","smpAccumL","smpAccumR","masterVolume","stereoPosLSquare1","stereoPosLSquare2","stereoPosLTriangle","stereoPosLNoise","stereoPosLDMC","stereoPosRSquare1","stereoPosRSquare2","stereoPosRTriangle","stereoPosRNoise","stereoPosRDMC","extraCycles","maxSample","minSample","panning"],toJSON:function(){let a=e.toJSON(this);return a.dmc=this.dmc.toJSON(),a.noise=this.noise.toJSON(),a.square1=this.square1.toJSON(),a.square2=this.square2.toJSON(),a.triangle=this.triangle.toJSON(),a},fromJSON:function(a){e.fromJSON(this,a),this.dmc.fromJSON(a.dmc),this.noise.fromJSON(a.noise),this.square1.fromJSON(a.square1),this.square2.fromJSON(a.square2),this.triangle.fromJSON(a.triangle)}};var i=function(a){this.papu=a,this.MODE_NORMAL=0,this.MODE_LOOP=1,this.MODE_IRQ=2,this.isEnabled=null,this.hasSample=null,this.irqGenerated=!1,this.playMode=null,this.dmaFrequency=null,this.dmaCounter=null,this.deltaCounter=null,this.playStartAddress=null,this.playAddress=null,this.playLength=null,this.playLengthCounter=null,this.shiftCounter=null,this.reg4012=null,this.reg4013=null,this.sample=null,this.dacLsb=null,this.data=null,this.reset()};i.prototype={clockDmc:function(){this.hasSample&&(this.data&1?this.deltaCounter<63&&this.deltaCounter++:this.deltaCounter>0&&this.deltaCounter--,this.sample=this.isEnabled?(this.deltaCounter<<1)+this.dacLsb:0,this.data>>=1),this.dmaCounter--,this.dmaCounter<=0&&(this.hasSample=!1,this.endOfSample(),this.dmaCounter=8),this.irqGenerated&&this.papu.nes.cpu.requestIrq(this.papu.nes.cpu.IRQ_NORMAL)},endOfSample:function(){this.playLengthCounter===0&&this.playMode===this.MODE_LOOP&&(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength),this.playLengthCounter>0&&(this.nextSample(),this.playLengthCounter===0&&this.playMode===this.MODE_IRQ&&(this.irqGenerated=!0))},nextSample:function(){this.data=this.papu.nes.mmap.load(this.playAddress),this.papu.nes.cpu.haltCycles(4),this.playLengthCounter--,this.playAddress++,this.playAddress>65535&&(this.playAddress=32768),this.hasSample=!0},writeReg:function(a,h){a===16400?(h>>6?(h>>6&1)===1?this.playMode=this.MODE_LOOP:h>>6===2&&(this.playMode=this.MODE_IRQ):this.playMode=this.MODE_NORMAL,h&128||(this.irqGenerated=!1),this.dmaFrequency=this.papu.getDmcFrequency(h&15)):a===16401?(this.deltaCounter=h>>1&63,this.dacLsb=h&1,this.sample=(this.deltaCounter<<1)+this.dacLsb):a===16402?(this.playStartAddress=h<<6|49152,this.playAddress=this.playStartAddress,this.reg4012=h):a===16403?(this.playLength=(h<<4)+1,this.playLengthCounter=this.playLength,this.reg4013=h):a===16405&&(h>>4&1?(this.playAddress=this.playStartAddress,this.playLengthCounter=this.playLength):this.playLengthCounter=0,this.irqGenerated=!1)},setEnabled:function(a){!this.isEnabled&&a&&(this.playLengthCounter=this.playLength),this.isEnabled=a},getLengthStatus:function(){return this.playLengthCounter===0||!this.isEnabled?0:1},getIrqStatus:function(){return this.irqGenerated?1:0},reset:function(){this.isEnabled=!1,this.irqGenerated=!1,this.playMode=this.MODE_NORMAL,this.dmaFrequency=0,this.dmaCounter=0,this.deltaCounter=0,this.playStartAddress=0,this.playAddress=0,this.playLength=0,this.playLengthCounter=0,this.sample=0,this.dacLsb=0,this.shiftCounter=0,this.reg4012=0,this.reg4013=0,this.data=0},JSON_PROPERTIES:["MODE_NORMAL","MODE_LOOP","MODE_IRQ","isEnabled","hasSample","irqGenerated","playMode","dmaFrequency","dmaCounter","deltaCounter","playStartAddress","playAddress","playLength","playLengthCounter","shiftCounter","reg4012","reg4013","sample","dacLsb","data"],toJSON:function(){return e.toJSON(this)},fromJSON:function(a){e.fromJSON(this,a)}};var n=function(a){this.papu=a,this.isEnabled=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.lengthCounterEnable=null,this.envReset=null,this.shiftNow=null,this.lengthCounter=null,this.progTimerCount=null,this.progTimerMax=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.shiftReg=16384,this.randomBit=null,this.randomMode=null,this.sampleValue=null,this.accValue=0,this.accCount=1,this.tmp=null,this.reset()};n.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.isEnabled=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1,this.shiftNow=!1,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.shiftReg=1,this.randomBit=0,this.randomMode=0,this.sampleValue=0,this.tmp=0},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,this.lengthCounter===0&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&(this.sampleValue=this.randomBit*this.masterVolume)},writeReg:function(a,h){a===16396?(this.envDecayDisable=(h&16)!==0,this.envDecayRate=h&15,this.envDecayLoopEnable=(h&32)!==0,this.lengthCounterEnable=(h&32)===0,this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume):a===16398?(this.progTimerMax=this.papu.getNoiseWaveLength(h&15),this.randomMode=h>>7):a===16399&&(this.lengthCounter=this.papu.getLengthMax(h&248),this.envReset=!0)},setEnabled:function(a){this.isEnabled=a,a||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return this.lengthCounter===0||!this.isEnabled?0:1},JSON_PROPERTIES:["isEnabled","envDecayDisable","envDecayLoopEnable","lengthCounterEnable","envReset","shiftNow","lengthCounter","progTimerCount","progTimerMax","envDecayRate","envDecayCounter","envVolume","masterVolume","shiftReg","randomBit","randomMode","sampleValue","accValue","accCount","tmp"],toJSON:function(){return e.toJSON(this)},fromJSON:function(a){e.fromJSON(this,a)}};var r=function(a,h){this.papu=a,this.dutyLookup=[0,1,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,1,1,1,1,0,0,0,1,0,0,1,1,1,1,1],this.impLookup=[1,-1,0,0,0,0,0,0,1,0,-1,0,0,0,0,0,1,0,0,0,-1,0,0,0,-1,0,1,0,0,0,0,0],this.sqr1=h,this.isEnabled=null,this.lengthCounterEnable=null,this.sweepActive=null,this.envDecayDisable=null,this.envDecayLoopEnable=null,this.envReset=null,this.sweepCarry=null,this.updateSweepPeriod=null,this.progTimerCount=null,this.progTimerMax=null,this.lengthCounter=null,this.squareCounter=null,this.sweepCounter=null,this.sweepCounterMax=null,this.sweepMode=null,this.sweepShiftAmount=null,this.envDecayRate=null,this.envDecayCounter=null,this.envVolume=null,this.masterVolume=null,this.dutyMode=null,this.sweepResult=null,this.sampleValue=null,this.vol=null,this.reset()};r.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.lengthCounter=0,this.squareCounter=0,this.sweepCounter=0,this.sweepCounterMax=0,this.sweepMode=0,this.sweepShiftAmount=0,this.envDecayRate=0,this.envDecayCounter=0,this.envVolume=0,this.masterVolume=0,this.dutyMode=0,this.vol=0,this.isEnabled=!1,this.lengthCounterEnable=!1,this.sweepActive=!1,this.sweepCarry=!1,this.envDecayDisable=!1,this.envDecayLoopEnable=!1},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,this.lengthCounter===0&&this.updateSampleValue())},clockEnvDecay:function(){this.envReset?(this.envReset=!1,this.envDecayCounter=this.envDecayRate+1,this.envVolume=15):--this.envDecayCounter<=0&&(this.envDecayCounter=this.envDecayRate+1,this.envVolume>0?this.envVolume--:this.envVolume=this.envDecayLoopEnable?15:0),this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()},clockSweep:function(){--this.sweepCounter<=0&&(this.sweepCounter=this.sweepCounterMax+1,this.sweepActive&&this.sweepShiftAmount>0&&this.progTimerMax>7&&(this.sweepCarry=!1,this.sweepMode===0?(this.progTimerMax+=this.progTimerMax>>this.sweepShiftAmount,this.progTimerMax>4095&&(this.progTimerMax=4095,this.sweepCarry=!0)):this.progTimerMax=this.progTimerMax-((this.progTimerMax>>this.sweepShiftAmount)-(this.sqr1?1:0)))),this.updateSweepPeriod&&(this.updateSweepPeriod=!1,this.sweepCounter=this.sweepCounterMax+1)},updateSampleValue:function(){this.isEnabled&&this.lengthCounter>0&&this.progTimerMax>7?this.sweepMode===0&&this.progTimerMax+(this.progTimerMax>>this.sweepShiftAmount)>4095?this.sampleValue=0:this.sampleValue=this.masterVolume*this.dutyLookup[(this.dutyMode<<3)+this.squareCounter]:this.sampleValue=0},writeReg:function(a,h){var l=this.sqr1?0:4;a===16384+l?(this.envDecayDisable=(h&16)!==0,this.envDecayRate=h&15,this.envDecayLoopEnable=(h&32)!==0,this.dutyMode=h>>6&3,this.lengthCounterEnable=(h&32)===0,this.envDecayDisable?this.masterVolume=this.envDecayRate:this.masterVolume=this.envVolume,this.updateSampleValue()):a===16385+l?(this.sweepActive=(h&128)!==0,this.sweepCounterMax=h>>4&7,this.sweepMode=h>>3&1,this.sweepShiftAmount=h&7,this.updateSweepPeriod=!0):a===16386+l?(this.progTimerMax&=1792,this.progTimerMax|=h):a===16387+l&&(this.progTimerMax&=255,this.progTimerMax|=(h&7)<<8,this.isEnabled&&(this.lengthCounter=this.papu.getLengthMax(h&248)),this.envReset=!0)},setEnabled:function(a){this.isEnabled=a,a||(this.lengthCounter=0),this.updateSampleValue()},getLengthStatus:function(){return this.lengthCounter===0||!this.isEnabled?0:1},JSON_PROPERTIES:["isEnabled","lengthCounterEnable","sweepActive","envDecayDisable","envDecayLoopEnable","envReset","sweepCarry","updateSweepPeriod","progTimerCount","progTimerMax","lengthCounter","squareCounter","sweepCounter","sweepCounterMax","sweepMode","sweepShiftAmount","envDecayRate","envDecayCounter","envVolume","masterVolume","dutyMode","sweepResult","sampleValue","vol"],toJSON:function(){return e.toJSON(this)},fromJSON:function(a){e.fromJSON(this,a)}};var o=function(a){this.papu=a,this.isEnabled=null,this.sampleCondition=null,this.lengthCounterEnable=null,this.lcHalt=null,this.lcControl=null,this.progTimerCount=null,this.progTimerMax=null,this.triangleCounter=null,this.lengthCounter=null,this.linearCounter=null,this.lcLoadValue=null,this.sampleValue=null,this.tmp=null,this.reset()};return o.prototype={reset:function(){this.progTimerCount=0,this.progTimerMax=0,this.triangleCounter=0,this.isEnabled=!1,this.sampleCondition=!1,this.lengthCounter=0,this.lengthCounterEnable=!1,this.linearCounter=0,this.lcLoadValue=0,this.lcHalt=!0,this.lcControl=!1,this.tmp=0,this.sampleValue=15},clockLengthCounter:function(){this.lengthCounterEnable&&this.lengthCounter>0&&(this.lengthCounter--,this.lengthCounter===0&&this.updateSampleCondition())},clockLinearCounter:function(){this.lcHalt?(this.linearCounter=this.lcLoadValue,this.updateSampleCondition()):this.linearCounter>0&&(this.linearCounter--,this.updateSampleCondition()),this.lcControl||(this.lcHalt=!1)},getLengthStatus:function(){return this.lengthCounter===0||!this.isEnabled?0:1},readReg:function(a){return 0},writeReg:function(a,h){a===16392?(this.lcControl=(h&128)!==0,this.lcLoadValue=h&127,this.lengthCounterEnable=!this.lcControl):a===16394?(this.progTimerMax&=1792,this.progTimerMax|=h):a===16395&&(this.progTimerMax&=255,this.progTimerMax|=(h&7)<<8,this.lengthCounter=this.papu.getLengthMax(h&248),this.lcHalt=!0),this.updateSampleCondition()},clockProgrammableTimer:function(a){if(this.progTimerMax>0)for(this.progTimerCount+=a;this.progTimerMax>0&&this.progTimerCount>=this.progTimerMax;)this.progTimerCount-=this.progTimerMax,this.isEnabled&&this.lengthCounter>0&&this.linearCounter>0&&this.clockTriangleGenerator()},clockTriangleGenerator:function(){this.triangleCounter++,this.triangleCounter&=31},setEnabled:function(a){this.isEnabled=a,a||(this.lengthCounter=0),this.updateSampleCondition()},updateSampleCondition:function(){this.sampleCondition=this.isEnabled&&this.progTimerMax>7&&this.linearCounter>0&&this.lengthCounter>0},JSON_PROPERTIES:["isEnabled","sampleCondition","lengthCounterEnable","lcHalt","lcControl","progTimerCount","progTimerMax","triangleCounter","lengthCounter","linearCounter","lcLoadValue","sampleValue","tmp"],toJSON:function(){return e.toJSON(this)},fromJSON:function(a){e.fromJSON(this,a)}},qi=s,qi}var ji,$r;function _f(){if($r)return ji;$r=1;var e=Si(),t={};return t[0]=function(s){this.nes=s},t[0].prototype={reset:function(){this.joy1StrobeState=0,this.joy2StrobeState=0,this.joypadLastWrite=0,this.zapperFired=!1,this.zapperX=null,this.zapperY=null},write:function(s,i){s<8192?this.nes.cpu.mem[s&2047]=i:s>16407?(this.nes.cpu.mem[s]=i,s>=24576&&s<32768&&this.nes.opts.onBatteryRamWrite(s,i)):s>8199&&s<16384?this.regWrite(8192+(s&7),i):this.regWrite(s,i)},writelow:function(s,i){s<8192?this.nes.cpu.mem[s&2047]=i:s>16407?this.nes.cpu.mem[s]=i:s>8199&&s<16384?this.regWrite(8192+(s&7),i):this.regWrite(s,i)},load:function(s){return s&=65535,s>16407?this.nes.cpu.mem[s]:s>=8192?this.regLoad(s):this.nes.cpu.mem[s&2047]},regLoad:function(s){switch(s>>12){case 0:break;case 1:break;case 2:case 3:switch(s&7){case 0:return this.nes.cpu.mem[8192];case 1:return this.nes.cpu.mem[8193];case 2:return this.nes.ppu.readStatusRegister();case 3:return 0;case 4:return this.nes.ppu.sramLoad();case 5:return 0;case 6:return 0;case 7:return this.nes.ppu.vramLoad()}break;case 4:switch(s-16405){case 0:return this.nes.papu.readReg(s);case 1:return this.joy1Read();case 2:var i;return this.zapperX!==null&&this.zapperY!==null&&this.nes.ppu.isPixelWhite(this.zapperX,this.zapperY)?i=0:i=8,this.zapperFired&&(i|=16),(this.joy2Read()|i)&65535}break}return 0},regWrite:function(s,i){switch(s){case 8192:this.nes.cpu.mem[s]=i,this.nes.ppu.updateControlReg1(i);break;case 8193:this.nes.cpu.mem[s]=i,this.nes.ppu.updateControlReg2(i);break;case 8195:this.nes.ppu.writeSRAMAddress(i);break;case 8196:this.nes.ppu.sramWrite(i);break;case 8197:this.nes.ppu.scrollWrite(i);break;case 8198:this.nes.ppu.writeVRAMAddress(i);break;case 8199:this.nes.ppu.vramWrite(i);break;case 16404:this.nes.ppu.sramDMA(i);break;case 16405:this.nes.papu.writeReg(s,i);break;case 16406:!(i&1)&&(this.joypadLastWrite&1)===1&&(this.joy1StrobeState=0,this.joy2StrobeState=0),this.joypadLastWrite=i;break;case 16407:this.nes.papu.writeReg(s,i);break;default:s>=16384&&s<=16407&&this.nes.papu.writeReg(s,i)}},joy1Read:function(){var s;switch(this.joy1StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s=this.nes.controllers[1].state[this.joy1StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:s=0;break;case 19:s=1;break;default:s=0}return this.joy1StrobeState++,this.joy1StrobeState===24&&(this.joy1StrobeState=0),s},joy2Read:function(){var s;switch(this.joy2StrobeState){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s=this.nes.controllers[2].state[this.joy2StrobeState];break;case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:s=0;break;case 19:s=1;break;default:s=0}return this.joy2StrobeState++,this.joy2StrobeState===24&&(this.joy2StrobeState=0),s},loadROM:function(){if(!this.nes.rom.valid||this.nes.rom.romCount<1)throw new Error("NoMapper: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},loadPRGROM:function(){this.nes.rom.romCount>1?(this.loadRomBank(0,32768),this.loadRomBank(1,49152)):(this.loadRomBank(0,32768),this.loadRomBank(0,49152))},loadCHRROM:function(){this.nes.rom.vromCount>0&&(this.nes.rom.vromCount===1?(this.loadVromBank(0,0),this.loadVromBank(0,4096)):(this.loadVromBank(0,0),this.loadVromBank(1,4096)))},loadBatteryRam:function(){if(this.nes.rom.batteryRam){var s=this.nes.rom.batteryRam;s!==null&&s.length===8192&&e.copyArrayElements(s,0,this.nes.cpu.mem,24576,8192)}},loadRomBank:function(s,i){s%=this.nes.rom.romCount,e.copyArrayElements(this.nes.rom.rom[s],0,this.nes.cpu.mem,i,16384)},loadVromBank:function(s,i){if(this.nes.rom.vromCount!==0){this.nes.ppu.triggerRendering(),e.copyArrayElements(this.nes.rom.vrom[s%this.nes.rom.vromCount],0,this.nes.ppu.vramMem,i,4096);var n=this.nes.rom.vromTile[s%this.nes.rom.vromCount];e.copyArrayElements(n,0,this.nes.ppu.ptTile,i>>4,256)}},load32kRomBank:function(s,i){this.loadRomBank(s*2%this.nes.rom.romCount,i),this.loadRomBank((s*2+1)%this.nes.rom.romCount,i+16384)},load8kVromBank:function(s,i){this.nes.rom.vromCount!==0&&(this.nes.ppu.triggerRendering(),this.loadVromBank(s%this.nes.rom.vromCount,i),this.loadVromBank((s+1)%this.nes.rom.vromCount,i+4096))},load1kVromBank:function(s,i){if(this.nes.rom.vromCount!==0){this.nes.ppu.triggerRendering();var n=Math.floor(s/4)%this.nes.rom.vromCount,r=s%4*1024;e.copyArrayElements(this.nes.rom.vrom[n],r,this.nes.ppu.vramMem,i,1024);for(var o=this.nes.rom.vromTile[n],a=i>>4,h=0;h<64;h++)this.nes.ppu.ptTile[a+h]=o[(s%4<<6)+h]}},load2kVromBank:function(s,i){if(this.nes.rom.vromCount!==0){this.nes.ppu.triggerRendering();var n=Math.floor(s/2)%this.nes.rom.vromCount,r=s%2*2048;e.copyArrayElements(this.nes.rom.vrom[n],r,this.nes.ppu.vramMem,i,2048);for(var o=this.nes.rom.vromTile[n],a=i>>4,h=0;h<128;h++)this.nes.ppu.ptTile[a+h]=o[(s%2<<7)+h]}},load8kRomBank:function(s,i){var n=Math.floor(s/2)%this.nes.rom.romCount,r=s%2*8192;e.copyArrayElements(this.nes.rom.rom[n],r,this.nes.cpu.mem,i,8192)},clockIrqCounter:function(){},latchAccess:function(s){},toJSON:function(){return{joy1StrobeState:this.joy1StrobeState,joy2StrobeState:this.joy2StrobeState,joypadLastWrite:this.joypadLastWrite}},fromJSON:function(s){this.joy1StrobeState=s.joy1StrobeState,this.joy2StrobeState=s.joy2StrobeState,this.joypadLastWrite=s.joypadLastWrite}},t[1]=function(s){this.nes=s},t[1].prototype=new t[0],t[1].prototype.reset=function(){t[0].prototype.reset.apply(this),this.regBuffer=0,this.regBufferCounter=0,this.mirroring=0,this.oneScreenMirroring=0,this.prgSwitchingArea=1,this.prgSwitchingSize=1,this.vromSwitchingSize=0,this.romSelectionReg0=0,this.romSelectionReg1=0,this.romBankSelect=0},t[1].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}i&128?(this.regBufferCounter=0,this.regBuffer=0,this.getRegNumber(s)===0&&(this.prgSwitchingArea=1,this.prgSwitchingSize=1)):(this.regBuffer=this.regBuffer&255-(1<<this.regBufferCounter)|(i&1)<<this.regBufferCounter,this.regBufferCounter++,this.regBufferCounter===5&&(this.setReg(this.getRegNumber(s),this.regBuffer),this.regBuffer=0,this.regBufferCounter=0))},t[1].prototype.setReg=function(s,i){var n;switch(s){case 0:n=i&3,n!==this.mirroring&&(this.mirroring=n,this.mirroring&2?this.mirroring&1?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING)),this.prgSwitchingArea=i>>2&1,this.prgSwitchingSize=i>>3&1,this.vromSwitchingSize=i>>4&1;break;case 1:this.romSelectionReg0=i>>4&1,this.nes.rom.vromCount>0&&(this.vromSwitchingSize===0?this.romSelectionReg0===0?this.load8kVromBank(i&15,0):this.load8kVromBank(Math.floor(this.nes.rom.vromCount/2)+(i&15),0):this.romSelectionReg0===0?this.loadVromBank(i&15,0):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(i&15),0));break;case 2:this.romSelectionReg1=i>>4&1,this.nes.rom.vromCount>0&&this.vromSwitchingSize===1&&(this.romSelectionReg1===0?this.loadVromBank(i&15,4096):this.loadVromBank(Math.floor(this.nes.rom.vromCount/2)+(i&15),4096));break;default:n=i&15;var r,o=0;this.nes.rom.romCount>=32?this.vromSwitchingSize===0?this.romSelectionReg0===1&&(o=16):o=(this.romSelectionReg0|this.romSelectionReg1<<1)<<3:this.nes.rom.romCount>=16&&this.romSelectionReg0===1&&(o=8),this.prgSwitchingSize===0?(r=o+(i&15),this.load32kRomBank(r,32768)):(r=o*2+(i&15),this.prgSwitchingArea===0?this.loadRomBank(r,49152):this.loadRomBank(r,32768))}},t[1].prototype.getRegNumber=function(s){return s>=32768&&s<=40959?0:s>=40960&&s<=49151?1:s>=49152&&s<=57343?2:3},t[1].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC1: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t[1].prototype.switchLowHighPrgRom=function(s){},t[1].prototype.switch16to32=function(){},t[1].prototype.switch32to16=function(){},t[1].prototype.toJSON=function(){var s=t[0].prototype.toJSON.apply(this);return s.mirroring=this.mirroring,s.oneScreenMirroring=this.oneScreenMirroring,s.prgSwitchingArea=this.prgSwitchingArea,s.prgSwitchingSize=this.prgSwitchingSize,s.vromSwitchingSize=this.vromSwitchingSize,s.romSelectionReg0=this.romSelectionReg0,s.romSelectionReg1=this.romSelectionReg1,s.romBankSelect=this.romBankSelect,s.regBuffer=this.regBuffer,s.regBufferCounter=this.regBufferCounter,s},t[1].prototype.fromJSON=function(s){t[0].prototype.fromJSON.apply(this,arguments),this.mirroring=s.mirroring,this.oneScreenMirroring=s.oneScreenMirroring,this.prgSwitchingArea=s.prgSwitchingArea,this.prgSwitchingSize=s.prgSwitchingSize,this.vromSwitchingSize=s.vromSwitchingSize,this.romSelectionReg0=s.romSelectionReg0,this.romSelectionReg1=s.romSelectionReg1,this.romBankSelect=s.romBankSelect,this.regBuffer=s.regBuffer,this.regBufferCounter=s.regBufferCounter},t[2]=function(s){this.nes=s},t[2].prototype=new t[0],t[2].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else this.loadRomBank(i,32768)},t[2].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t[3]=function(s){this.nes=s},t[3].prototype=new t[0],t[3].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else{var n=i%(this.nes.rom.vromCount/2)*2;this.loadVromBank(n,0),this.loadVromBank(n+1,4096),this.load8kVromBank(i*2,0)}},t[4]=function(s){this.nes=s,this.CMD_SEL_2_1K_VROM_0000=0,this.CMD_SEL_2_1K_VROM_0800=1,this.CMD_SEL_1K_VROM_1000=2,this.CMD_SEL_1K_VROM_1400=3,this.CMD_SEL_1K_VROM_1800=4,this.CMD_SEL_1K_VROM_1C00=5,this.CMD_SEL_ROM_PAGE1=6,this.CMD_SEL_ROM_PAGE2=7,this.command=null,this.prgAddressSelect=null,this.chrAddressSelect=null,this.pageNumber=null,this.irqCounter=null,this.irqLatchValue=null,this.irqEnable=null,this.prgAddressChanged=!1},t[4].prototype=new t[0],t[4].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}switch(s){case 32768:this.command=i&7;var n=i>>6&1;n!==this.prgAddressSelect&&(this.prgAddressChanged=!0),this.prgAddressSelect=n,this.chrAddressSelect=i>>7&1;break;case 32769:this.executeCommand(this.command,i);break;case 40960:i&1?this.nes.ppu.setMirroring(this.nes.rom.HORIZONTAL_MIRRORING):this.nes.ppu.setMirroring(this.nes.rom.VERTICAL_MIRRORING);break;case 40961:break;case 49152:this.irqCounter=i;break;case 49153:this.irqLatchValue=i;break;case 57344:this.irqEnable=0;break;case 57345:this.irqEnable=1;break}},t[4].prototype.executeCommand=function(s,i){switch(s){case this.CMD_SEL_2_1K_VROM_0000:this.chrAddressSelect===0?(this.load1kVromBank(i,0),this.load1kVromBank(i+1,1024)):(this.load1kVromBank(i,4096),this.load1kVromBank(i+1,5120));break;case this.CMD_SEL_2_1K_VROM_0800:this.chrAddressSelect===0?(this.load1kVromBank(i,2048),this.load1kVromBank(i+1,3072)):(this.load1kVromBank(i,6144),this.load1kVromBank(i+1,7168));break;case this.CMD_SEL_1K_VROM_1000:this.chrAddressSelect===0?this.load1kVromBank(i,4096):this.load1kVromBank(i,0);break;case this.CMD_SEL_1K_VROM_1400:this.chrAddressSelect===0?this.load1kVromBank(i,5120):this.load1kVromBank(i,1024);break;case this.CMD_SEL_1K_VROM_1800:this.chrAddressSelect===0?this.load1kVromBank(i,6144):this.load1kVromBank(i,2048);break;case this.CMD_SEL_1K_VROM_1C00:this.chrAddressSelect===0?this.load1kVromBank(i,7168):this.load1kVromBank(i,3072);break;case this.CMD_SEL_ROM_PAGE1:this.prgAddressChanged&&(this.prgAddressSelect===0?this.load8kRomBank((this.nes.rom.romCount-1)*2,49152):this.load8kRomBank((this.nes.rom.romCount-1)*2,32768),this.prgAddressChanged=!1),this.prgAddressSelect===0?this.load8kRomBank(i,32768):this.load8kRomBank(i,49152);break;case this.CMD_SEL_ROM_PAGE2:this.load8kRomBank(i,40960),this.prgAddressChanged&&(this.prgAddressSelect===0?this.load8kRomBank((this.nes.rom.romCount-1)*2,49152):this.load8kRomBank((this.nes.rom.romCount-1)*2,32768),this.prgAddressChanged=!1)}},t[4].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("MMC3: Invalid ROM! Unable to load.");this.load8kRomBank((this.nes.rom.romCount-1)*2,49152),this.load8kRomBank((this.nes.rom.romCount-1)*2+1,57344),this.load8kRomBank(0,32768),this.load8kRomBank(1,40960),this.loadCHRROM(),this.loadBatteryRam(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t[4].prototype.clockIrqCounter=function(){this.irqEnable===1&&(this.irqCounter--,this.irqCounter<0&&(this.nes.cpu.requestIrq(this.nes.cpu.IRQ_NORMAL),this.irqCounter=this.irqLatchValue))},t[4].prototype.toJSON=function(){var s=t[0].prototype.toJSON.apply(this);return s.command=this.command,s.prgAddressSelect=this.prgAddressSelect,s.chrAddressSelect=this.chrAddressSelect,s.pageNumber=this.pageNumber,s.irqCounter=this.irqCounter,s.irqLatchValue=this.irqLatchValue,s.irqEnable=this.irqEnable,s.prgAddressChanged=this.prgAddressChanged,s},t[4].prototype.fromJSON=function(s){t[0].prototype.fromJSON.apply(this,arguments),this.command=s.command,this.prgAddressSelect=s.prgAddressSelect,this.chrAddressSelect=s.chrAddressSelect,this.pageNumber=s.pageNumber,this.irqCounter=s.irqCounter,this.irqLatchValue=s.irqLatchValue,this.irqEnable=s.irqEnable,this.prgAddressChanged=s.prgAddressChanged},t[5]=function(s){this.nes=s},t[5].prototype=new t[0],t[5].prototype.write=function(s,i){s<32768?t[0].prototype.write.apply(this,arguments):this.load8kVromBank(i,0)},t[5].prototype.write=function(s,i){if(s<20480){t[0].prototype.write.apply(this,arguments);return}switch(s){case 20736:this.prg_size=i&3;break;case 20737:this.chr_size=i&3;break;case 20738:this.sram_we_a=i&3;break;case 20739:this.sram_we_b=i&3;break;case 20740:this.graphic_mode=i&3;break;case 20741:this.nametable_mode=i,this.nametable_type[0]=i&3,this.load1kVromBank(i&3,8192),i>>=2,this.nametable_type[1]=i&3,this.load1kVromBank(i&3,9216),i>>=2,this.nametable_type[2]=i&3,this.load1kVromBank(i&3,10240),i>>=2,this.nametable_type[3]=i&3,this.load1kVromBank(i&3,11264);break;case 20742:this.fill_chr=i;break;case 20743:this.fill_pal=i&3;break;case 20755:this.SetBank_SRAM(3,i&3);break;case 20756:case 20757:case 20758:case 20759:this.SetBank_CPU(s,i);break;case 20768:case 20769:case 20770:case 20771:case 20772:case 20773:case 20774:case 20775:this.chr_mode=0,this.chr_page[0][s&7]=i,this.SetBank_PPU();break;case 20776:case 20777:case 20778:case 20779:this.chr_mode=1,this.chr_page[1][(s&3)+0]=i,this.chr_page[1][(s&3)+4]=i,this.SetBank_PPU();break;case 20992:this.split_control=i;break;case 20993:this.split_scroll=i;break;case 20994:this.split_page=i&63;break;case 20995:this.irq_line=i,this.nes.cpu.ClearIRQ();break;case 20996:this.irq_enable=i,this.nes.cpu.ClearIRQ();break;case 20997:this.mult_a=i;break;case 20998:this.mult_b=i;break;default:s>=20480&&s<=20501?this.nes.papu.exWrite(s,i):s>=23552&&s<=24575?this.graphic_mode===2||this.graphic_mode!==3&&this.irq_status&64:s>=24576&&s<=32767&&this.sram_we_a===2&&this.sram_we_b;break}},t[5].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UNROM: Invalid ROM! Unable to load.");this.load8kRomBank(this.nes.rom.romCount*2-1,32768),this.load8kRomBank(this.nes.rom.romCount*2-1,40960),this.load8kRomBank(this.nes.rom.romCount*2-1,49152),this.load8kRomBank(this.nes.rom.romCount*2-1,57344),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t[7]=function(s){this.nes=s},t[7].prototype=new t[0],t[7].prototype.write=function(s,i){s<32768?t[0].prototype.write.apply(this,arguments):(this.load32kRomBank(i&7,32768),i&16?this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING2):this.nes.ppu.setMirroring(this.nes.rom.SINGLESCREEN_MIRRORING))},t[7].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("AOROM: Invalid ROM! Unable to load.");this.loadPRGROM(),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t[11]=function(s){this.nes=s},t[11].prototype=new t[0],t[11].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else{var n=(i&15)*2%this.nes.rom.romCount,r=((i&15)*2+1)%this.nes.rom.romCount;if(this.loadRomBank(n,32768),this.loadRomBank(r,49152),this.nes.rom.vromCount>0){var o=(i>>4)*2%this.nes.rom.vromCount;this.loadVromBank(o,0),this.loadVromBank(o+1,4096)}}},t[34]=function(s){this.nes=s},t[34].prototype=new t[0],t[34].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else this.load32kRomBank(i,32768)},t[38]=function(s){this.nes=s},t[38].prototype=new t[0],t[38].prototype.write=function(s,i){if(s<28672||s>32767){t[0].prototype.write.apply(this,arguments);return}else this.load32kRomBank(i&3,32768),this.load8kVromBank((i>>2&3)*2,0)},t[66]=function(s){this.nes=s},t[66].prototype=new t[0],t[66].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else this.load32kRomBank(i>>4&3,32768),this.load8kVromBank((i&3)*2,0)},t[94]=function(s){this.nes=s},t[94].prototype=new t[0],t[94].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else this.loadRomBank(i>>2,32768)},t[94].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("UN1ROM: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},t[140]=function(s){this.nes=s},t[140].prototype=new t[0],t[140].prototype.write=function(s,i){if(s<24576||s>32767){t[0].prototype.write.apply(this,arguments);return}else this.load32kRomBank(i>>4&3,32768),this.load8kVromBank((i&15)*2,0)},t[180]=function(s){this.nes=s},t[180].prototype=new t[0],t[180].prototype.write=function(s,i){if(s<32768){t[0].prototype.write.apply(this,arguments);return}else this.loadRomBank(i,49152)},t[180].prototype.loadROM=function(){if(!this.nes.rom.valid)throw new Error("Mapper 180: Invalid ROM! Unable to load.");this.loadRomBank(0,32768),this.loadRomBank(this.nes.rom.romCount-1,49152),this.loadCHRROM(),this.nes.cpu.requestIrq(this.nes.cpu.IRQ_RESET)},ji=t,ji}var Ui,Hr;function Rf(){if(Hr)return Ui;Hr=1;var e=_f(),t=wa(),s=function(i){this.nes=i,this.mapperName=new Array(92);for(var n=0;n<92;n++)this.mapperName[n]="Unknown Mapper";this.mapperName[0]="Direct Access",this.mapperName[1]="Nintendo MMC1",this.mapperName[2]="UNROM",this.mapperName[3]="CNROM",this.mapperName[4]="Nintendo MMC3",this.mapperName[5]="Nintendo MMC5",this.mapperName[6]="FFE F4xxx",this.mapperName[7]="AOROM",this.mapperName[8]="FFE F3xxx",this.mapperName[9]="Nintendo MMC2",this.mapperName[10]="Nintendo MMC4",this.mapperName[11]="Color Dreams Chip",this.mapperName[12]="FFE F6xxx",this.mapperName[15]="100-in-1 switch",this.mapperName[16]="Bandai chip",this.mapperName[17]="FFE F8xxx",this.mapperName[18]="Jaleco SS8806 chip",this.mapperName[19]="Namcot 106 chip",this.mapperName[20]="Famicom Disk System",this.mapperName[21]="Konami VRC4a",this.mapperName[22]="Konami VRC2a",this.mapperName[23]="Konami VRC2a",this.mapperName[24]="Konami VRC6",this.mapperName[25]="Konami VRC4b",this.mapperName[32]="Irem G-101 chip",this.mapperName[33]="Taito TC0190/TC0350",this.mapperName[34]="32kB ROM switch",this.mapperName[64]="Tengen RAMBO-1 chip",this.mapperName[65]="Irem H-3001 chip",this.mapperName[66]="GNROM switch",this.mapperName[67]="SunSoft3 chip",this.mapperName[68]="SunSoft4 chip",this.mapperName[69]="SunSoft5 FME-7 chip",this.mapperName[71]="Camerica chip",this.mapperName[78]="Irem 74HC161/32-based",this.mapperName[91]="Pirate HK-SF3 chip"};return s.prototype={VERTICAL_MIRRORING:0,HORIZONTAL_MIRRORING:1,FOURSCREEN_MIRRORING:2,SINGLESCREEN_MIRRORING:3,SINGLESCREEN_MIRRORING2:4,SINGLESCREEN_MIRRORING3:5,SINGLESCREEN_MIRRORING4:6,CHRROM_MIRRORING:7,header:null,rom:null,vrom:null,vromTile:null,romCount:null,vromCount:null,mirroring:null,batteryRam:null,trainer:null,fourScreen:null,mapperType:null,valid:!1,load:function(i){var n,r,o;if(i.indexOf("NES")===-1)throw new Error("Not a valid NES ROM.");for(this.header=new Array(16),n=0;n<16;n++)this.header[n]=i.charCodeAt(n)&255;this.romCount=this.header[4],this.vromCount=this.header[5]*2,this.mirroring=this.header[6]&1?1:0,this.batteryRam=(this.header[6]&2)!==0,this.trainer=(this.header[6]&4)!==0,this.fourScreen=(this.header[6]&8)!==0,this.mapperType=this.header[6]>>4|this.header[7]&240;var a=!1;for(n=8;n<16;n++)if(this.header[n]!==0){a=!0;break}a&&(this.mapperType&=15),this.rom=new Array(this.romCount);var h=16;for(n=0;n<this.romCount;n++){for(this.rom[n]=new Array(16384),r=0;r<16384&&!(h+r>=i.length);r++)this.rom[n][r]=i.charCodeAt(h+r)&255;h+=16384}for(this.vrom=new Array(this.vromCount),n=0;n<this.vromCount;n++){for(this.vrom[n]=new Array(4096),r=0;r<4096&&!(h+r>=i.length);r++)this.vrom[n][r]=i.charCodeAt(h+r)&255;h+=4096}for(this.vromTile=new Array(this.vromCount),n=0;n<this.vromCount;n++)for(this.vromTile[n]=new Array(256),r=0;r<256;r++)this.vromTile[n][r]=new t;var l,c;for(o=0;o<this.vromCount;o++)for(n=0;n<4096;n++)l=n>>4,c=n%16,c<8?this.vromTile[o][l].setScanline(c,this.vrom[o][n],this.vrom[o][n+8]):this.vromTile[o][l].setScanline(c-8,this.vrom[o][n-8],this.vrom[o][n]);this.valid=!0},getMirroringType:function(){return this.fourScreen?this.FOURSCREEN_MIRRORING:this.mirroring===0?this.HORIZONTAL_MIRRORING:this.VERTICAL_MIRRORING},getMapperName:function(){return this.mapperType>=0&&this.mapperType<this.mapperName.length?this.mapperName[this.mapperType]:"Unknown Mapper, "+this.mapperType},mapperSupported:function(){return typeof e[this.mapperType]<"u"},createMapper:function(){if(this.mapperSupported())return new e[this.mapperType](this.nes);throw new Error("This ROM uses a mapper not supported by JSNES: "+this.getMapperName()+"("+this.mapperType+")")}},Ui=s,Ui}var $i,Xr;function xf(){if(Xr)return $i;Xr=1;var e=df(),t=Ba(),s=mf(),i=gf(),n=Rf(),r=function(o){if(this.opts={onFrame:function(){},onAudioSample:null,onStatusUpdate:function(){},onBatteryRamWrite:function(){},preferredFrameRate:60,emulateSound:!0,sampleRate:48e3},typeof o<"u"){var a;for(a in this.opts)typeof o[a]<"u"&&(this.opts[a]=o[a])}this.frameTime=1e3/this.opts.preferredFrameRate,this.ui={writeFrame:this.opts.onFrame,updateStatus:this.opts.onStatusUpdate},this.cpu=new e(this),this.ppu=new s(this),this.papu=new i(this),this.mmap=null,this.controllers={1:new t,2:new t},this.ui.updateStatus("Ready to load a ROM."),this.frame=this.frame.bind(this),this.buttonDown=this.buttonDown.bind(this),this.buttonUp=this.buttonUp.bind(this),this.zapperMove=this.zapperMove.bind(this),this.zapperFireDown=this.zapperFireDown.bind(this),this.zapperFireUp=this.zapperFireUp.bind(this)};return r.prototype={fpsFrameCount:0,romData:null,break:!1,stop:function(){this.break=!0},reset:function(){this.mmap!==null&&this.mmap.reset(),this.cpu.reset(),this.ppu.reset(),this.papu.reset(),this.lastFpsTime=null,this.fpsFrameCount=0,this.break=!1},frame:function(){this.ppu.startFrame();var o=0,a=this.opts.emulateSound,h=this.cpu,l=this.ppu,c=this.papu;e:for(;!this.break;)for(h.cyclesToHalt===0?(o=h.emulate(),a&&c.clockFrameCounter(o),o*=3):h.cyclesToHalt>8?(o=24,a&&c.clockFrameCounter(8),h.cyclesToHalt-=8):(o=h.cyclesToHalt*3,a&&c.clockFrameCounter(h.cyclesToHalt),h.cyclesToHalt=0);o>0;o--){if(l.curX===l.spr0HitX&&l.f_spVisibility===1&&l.scanline-21===l.spr0HitY&&l.setStatusFlag(l.STATUS_SPRITE0HIT,!0),l.requestEndFrame&&(l.nmiCounter--,l.nmiCounter===0)){l.requestEndFrame=!1,l.startVBlank();break e}l.curX++,l.curX===341&&(l.curX=0,l.endScanline())}this.fpsFrameCount++},buttonDown:function(o,a){this.controllers[o].buttonDown(a)},buttonUp:function(o,a){this.controllers[o].buttonUp(a)},zapperMove:function(o,a){this.mmap&&(this.mmap.zapperX=o,this.mmap.zapperY=a)},zapperFireDown:function(){this.mmap&&(this.mmap.zapperFired=!0)},zapperFireUp:function(){this.mmap&&(this.mmap.zapperFired=!1)},getFPS:function(){var o=+new Date,a=null;return this.lastFpsTime&&(a=this.fpsFrameCount/((o-this.lastFpsTime)/1e3)),this.fpsFrameCount=0,this.lastFpsTime=o,a},reloadROM:function(){this.romData!==null&&this.loadROM(this.romData)},loadROM:function(o){this.rom=new n(this),this.rom.load(o),this.reset(),this.mmap=this.rom.createMapper(),this.mmap.loadROM(),this.ppu.setMirroring(this.rom.getMirroringType()),this.romData=o},setFramerate:function(o){this.opts.preferredFrameRate=o,this.frameTime=1e3/o,this.papu.setSampleRate(this.opts.sampleRate,!1)},toJSON:function(){return{cpu:this.cpu.toJSON(),mmap:this.mmap.toJSON(),ppu:this.ppu.toJSON(),papu:this.papu.toJSON()}},fromJSON:function(o){this.reset(),this.cpu.fromJSON(o.cpu),this.mmap.fromJSON(o.mmap),this.ppu.fromJSON(o.ppu),this.papu.fromJSON(o.papu)}},$i=r,$i}var Hi,Yr;function Sf(){return Yr||(Yr=1,Hi={Controller:Ba(),NES:xf()}),Hi}var ne=Sf(),Xi,Wr;function Cf(){if(Wr)return Xi;Wr=1,Xi=e;function e(t,s){this._elements=new Array(t||50),this._first=0,this._last=0,this._size=0,this._evictedCb=s}return e.prototype.capacity=function(){return this._elements.length},e.prototype.isEmpty=function(){return this.size()===0},e.prototype.isFull=function(){return this.size()===this.capacity()},e.prototype.peek=function(){if(this.isEmpty())throw new Error("RingBuffer is empty");return this._elements[this._first]},e.prototype.peekN=function(t){if(t>this._size)throw new Error("Not enough elements in RingBuffer");var s=Math.min(this._first+t,this.capacity()),i=this._elements.slice(this._first,s);if(s<this.capacity())return i;var n=this._elements.slice(0,t-i.length);return i.concat(n)},e.prototype.deq=function(){var t=this.peek();return this._size--,this._first=(this._first+1)%this.capacity(),t},e.prototype.deqN=function(t){var s=this.peekN(t);return this._size-=t,this._first=(this._first+t)%this.capacity(),s},e.prototype.enq=function(t){this._end=(this._first+this.size())%this.capacity();var s=this.isFull();return s&&this._evictedCb&&this._evictedCb(this._elements[this._end]),this._elements[this._end]=t,s?this._first=(this._first+1)%this.capacity():this._size++,this.size()},e.prototype.size=function(){return this._size},Xi}var bf=Cf();const yf=La(bf);var zr="class ";function vf(e){return String(e).slice(0,zr.length)===zr}function Tf(e){return typeof e=="function"&&!vf(e)}var gn=(e,t)=>{const s=[];if(Tf(t))for(let i=0;i<e.length;i++)t(e[i],i)&&(s.push(...e.splice(i,1)),i--);else{const i=e.indexOf(t);i>=0&&s.push(...e.splice(i,1))}return s},dt={Pending:"pending",Fulfilled:"fulfilled",Rejected:"rejected"};function Ef(){let e,t,s=dt.Pending;const i=new Promise((n,r)=>{e=o=>{s===dt.Pending&&(s=dt.Fulfilled,n(o))},t=o=>{s===dt.Pending&&(s=dt.Rejected,r(o))}});return{get status(){return s},get isPending(){return s===dt.Pending},get isFulfilled(){return s===dt.Fulfilled},get isRejected(){return s===dt.Rejected},instance:i,resolve:e,reject:t}}function Bp(e=0){let t;const s=Ef(),i=s.instance;return i.cancel=()=>{clearTimeout(t),s.reject("canceled")},t=setTimeout(s.resolve,e),i}var De,xt,Fe,_n,jt,Eo,Af=(Eo=class{constructor(e=0){ut(this,Fe);ut(this,De);ut(this,xt);Ls(this,xt,e),Ls(this,De,{})}get capacity(){return Ee(this,xt)}events(e){if(!e){const s=Object.keys(Ee(this,De));return Object.fromEntries(s.map(i=>[i,this.events(i)]))}return[...pt(this,Fe,jt).call(this,e).keys()]}on(e,t){const s=pt(this,Fe,jt).call(this,e);pt(this,Fe,_n).call(this,s.size);const i=s.get(t)||0;return s.set(t,i|1),()=>this.off(e,t)}once(e,t){const s=pt(this,Fe,jt).call(this,e);pt(this,Fe,_n).call(this,s.size);const i=s.get(t)||0;return s.set(t,i|2),()=>this.off(e,t)}off(e,t){if(!e){const i=Object.values(Ee(this,De));return Ls(this,De,{}),i.length>0}if(!t){const i=Ee(this,De)[e];return i&&delete Ee(this,De)[e],((i==null?void 0:i.size)||0)>0}return pt(this,Fe,jt).call(this,e).delete(t)}emit(e,...t){const s=pt(this,Fe,jt).call(this,e),i=[];for(const[n,r]of s){try{n(...t)}catch(o){console.error(o)}r&2&&(r&1?s.set(n,1):i.push(n))}for(const n of i)s.delete(n)}},De=new WeakMap,xt=new WeakMap,Fe=new WeakSet,_n=function(e){if(Ee(this,xt)&&e>=Ee(this,xt))throw new Error(`Listeners reached limit size: ${Ee(this,xt)}`)},jt=function(e){return e?(Ee(this,De)[e]||(Ee(this,De)[e]=new Map),Ee(this,De)[e]):Ee(this,De)},Eo);const Df={xbox:{0:"a",1:"b",2:"x",3:"y",4:"lBumper",5:"rBumper",6:"lTrigger",7:"rTrigger",8:"view",9:"menu",10:"lAxes",11:"rAxes",12:"up",13:"down",14:"left",15:"right",16:"xbox",17:"dPad"}};class If extends Af{constructor(s){super();rs(this,"_rafId",0);rs(this,"_data");rs(this,"_updateLoop",()=>{document.hasFocus()&&this._update(),this._rafId=requestAnimationFrame(this._updateLoop)});rs(this,"_update",()=>{const s={axes:{left:{},right:{}},buttons:{}},i=navigator.getGamepads().find(l=>(l==null?void 0:l.id)===this.id);if(!i)return;const[n,r,o,a]=i.axes;s.axes.left.x=n,s.axes.left.y=r,s.axes.right.x=o,s.axes.right.y=a,i.buttons.forEach((l,c)=>{const f=Df.xbox[c];s.buttons[f]=l});const h=this._data;if(!h){this._data=s;return}Jr(h.axes.left,s.axes.left)&&(this.emit("move","left",s.axes.left),h.axes.left=s.axes.left),Jr(h.axes.right,s.axes.right)&&(this.emit("move","right",s.axes.right),h.axes.right=s.axes.right),Object.keys(s.buttons).forEach(l=>{const c=l,f=h.buttons[c],u=s.buttons[c];(u.pressed!==f.pressed||u.touched!==f.touched||!Rn(u.value,f.value))&&(u.pressed||u.touched?this.emit("press",c,u):this.emit("release",c,u),h.buttons[c]=s.buttons[c])})});this.id=s,this._updateLoop()}dispose(){cancelAnimationFrame(this._rafId)}}function Jr(e,t){return!Rn(e.x,t.x)||!Rn(e.y,t.y)}function Rn(e,t){return Math.abs(e-t)<.01}function Ci(e){return Fo()?(sc(e),!0):!1}const Zn=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const Of=Object.prototype.toString,Pf=e=>Of.call(e)==="[object Object]";function Yi(e){return Array.isArray(e)?e:[e]}function kf(e,t,s={}){const{immediate:i=!0}=s,n=Jt(!1);let r=null;function o(){r&&(clearTimeout(r),r=null)}function a(){n.value=!1,o()}function h(...l){o(),n.value=!0,r=setTimeout(()=>{n.value=!1,r=null,e(...l)},ot(t))}return i&&(n.value=!0,Zn&&h()),Ci(a),{isPending:Un(n),start:h,stop:a}}function Nf(e,t,s){return Ct(e,t,{...s,immediate:!0})}const Mf=Zn?window:void 0;function Ff(e){var t;const s=ot(e);return(t=s==null?void 0:s.$el)!=null?t:s}function ii(...e){const t=[],s=()=>{t.forEach(a=>a()),t.length=0},i=(a,h,l,c)=>(a.addEventListener(h,l,c),()=>a.removeEventListener(h,l,c)),n=Ne(()=>{const a=Yi(ot(e[0])).filter(h=>h!=null);return a.every(h=>typeof h!="string")?a:void 0}),r=Nf(()=>{var a,h;return[(h=(a=n.value)==null?void 0:a.map(l=>Ff(l)))!=null?h:[Mf].filter(l=>l!=null),Yi(ot(n.value?e[1]:e[0])),Yi(Oe(n.value?e[2]:e[1])),ot(n.value?e[3]:e[2])]},([a,h,l,c])=>{if(s(),!(a!=null&&a.length)||!(h!=null&&h.length)||!(l!=null&&l.length))return;const f=Pf(c)?{...c}:c;t.push(...a.flatMap(u=>h.flatMap(p=>l.map(_=>i(u,p,_,f)))))},{flush:"post"}),o=()=>{r(),s()};return Ci(s),o}function Lf(e,t,s={}){const{immediate:i=!0}=s,{start:n}=kf(o,t,{immediate:!1}),r=Jt(!1);async function o(){r.value&&(await e(),n())}function a(){r.value||(r.value=!0,o())}function h(){r.value=!1}return i&&Zn&&a(),Ci(h),{isActive:r,pause:h,resume:a}}function Bf(e){const t=[];return ii("gamepadconnected",i=>s(i,!0)),ii("gamepaddisconnected",i=>s(i,!1)),gi(()=>t.forEach(i=>i.controller.dispose())),t;function s(i,n){var a;const r=i.gamepad;if(n){const h=new If(r.id),l={id:r.id,controller:h};t.push(l),e.connect(l);return}const o=t.find(h=>h.id===r.id);o&&(o.controller.dispose(),gn(t,o),(a=e.disconnect)==null||a.call(e,o))}}const Ce={w:256,h:240,scale:2};function wf(e){const t=new yf(new AudioContext().sampleRate*2),s=Vf(),i=Gf(l),{ctx2d:n}=s,r=ss({paused:!1}),o={_id:0},a={buf32:new Uint32Array(0)},h=new ne.NES({onFrame:R=>{for(let P=0;P<Ce.h;++P)for(let A=0;A<Ce.w;++A){const T=P*Ce.w+A;a.buf32[T]=4278190080|R[T]}},onStatusUpdate:console.log,sampleRate:i.ctx.sampleRate,onAudioSample:(R,P)=>{t.enq(R),t.enq(P)}});return p(),gi(()=>{cancelAnimationFrame(o._id)}),{nes:h,audio:i,video:s,mount(R){R.appendChild(s.dom)},init(){n.fillStyle="black",n.fillRect(0,0,Ce.w,Ce.h);const R=n.getImageData(0,0,Ce.w,Ce.h),P=new ArrayBuffer(R.data.length);a.buf32=new Uint32Array(P);for(var A=0;A<a.buf32.length;++A)a.buf32[A]=4278190080},load:f,pause(){r.paused=!0},keyEvent(R,P,A){h[R](A,P)}};function l(R){const P=R.outputBuffer.getChannelData(0),A=R.outputBuffer.getChannelData(1),T=P.length;if(!(t.size()<T*2))try{const k=t.deqN(T*2);for(let v=0;v<T;v++)P[v]=k[v*2],A[v]=k[v*2+1]}catch{for(let v=0;v<T;v++)P[v]=0,A[v]=0;return}}function c(){const R=new ImageData(new Uint8ClampedArray(a.buf32.buffer),Ce.w,Ce.h);n.putImageData(jf(R,Ce.scale),0,0)}async function f(R){const P=await qf(R);h.loadROM(P),i.start(),u()}function u(){h.frame(),c(),o._id=requestAnimationFrame(u)}function p(){const R={w:ne.Controller.BUTTON_UP,s:ne.Controller.BUTTON_DOWN,a:ne.Controller.BUTTON_LEFT,d:ne.Controller.BUTTON_RIGHT,j:ne.Controller.BUTTON_A,k:ne.Controller.BUTTON_B,g:ne.Controller.BUTTON_SELECT,h:ne.Controller.BUTTON_START};ii("keydown",T=>A(T,"buttonDown")),ii("keyup",T=>A(T,"buttonUp"));const P={a:ne.Controller.BUTTON_A,b:ne.Controller.BUTTON_B,view:ne.Controller.BUTTON_SELECT,menu:ne.Controller.BUTTON_START};Bf({connect(T){T.controller.on("press",k=>{const v=P[k];v!=null&&_("buttonDown",v)}),T.controller.on("release",k=>{const v=P[k];v!=null&&_("buttonUp",v)}),T.controller.on("move",(k,v)=>{if(k!=="left")return;const j=.4;v.x<-.4?_("buttonDown",ne.Controller.BUTTON_LEFT):v.x<j?(_("buttonUp",ne.Controller.BUTTON_LEFT),_("buttonUp",ne.Controller.BUTTON_RIGHT)):_("buttonDown",ne.Controller.BUTTON_RIGHT),v.y<-.4?_("buttonDown",ne.Controller.BUTTON_UP):v.y<j?(_("buttonUp",ne.Controller.BUTTON_UP),_("buttonUp",ne.Controller.BUTTON_DOWN)):_("buttonDown",ne.Controller.BUTTON_DOWN)})}});function A(T,k){const v=R[T.key];v!=null&&_(k,v)}}function _(R,P,A){var T;h[R]((e==null?void 0:e.player)||1,P),(T=e==null?void 0:e.onKeyEvent)==null||T.call(e,R,[P])}}function Vf(){const e=document.createElement("canvas");return e.style.width="100%",e.width=Ce.w*Ce.scale,e.height=Ce.h*Ce.scale,{ctx2d:e.getContext("2d"),dom:e}}function Gf(e){const s=new AudioContext,i=s.createScriptProcessor(8192*2,0,2),n=s.createBufferSource();i.onaudioprocess=e,i.connect(s.destination),n.connect(i);const r=s.createMediaStreamDestination();i.connect(r);const o=r.stream;return{ctx:s,media:o,start(){n.start()},stop(){n.stop()}}}async function qf(e){const t=await(await fetch(e)).blob();return new Promise((s,i)=>{const n=new FileReader;n.onload=()=>s(n.result),n.onerror=r=>i(r),n.readAsBinaryString(t)})}function jf(e,t){const s=e.width,i=e.height,n=new ImageData(s*t,i*t);for(let r=0;r<i;r++)for(let o=0;o<s;o++){const a=(r*s+o)*4,h=e.data[a],l=e.data[a+1],c=e.data[a+2],f=e.data[a+3];for(let u=0;u<t;u++)for(let p=0;p<t;p++){const _=((r*t+u)*s*t+(o*t+p))*4;n.data[_]=h,n.data[_+1]=l,n.data[_+2]=c,n.data[_+3]=f}}return n}class Uf{constructor(){this.encoder=new TextEncoder,this._pieces=[],this._parts=[]}append_buffer(t){this.flush(),this._parts.push(t)}append(t){this._pieces.push(t)}flush(){if(this._pieces.length>0){const t=new Uint8Array(this._pieces);this._parts.push(t),this._pieces=[]}}toArrayBuffer(){const t=[];for(const s of this._parts)t.push(s);return $f(t).buffer}}function $f(e){let t=0;for(const n of e)t+=n.byteLength;const s=new Uint8Array(t);let i=0;for(const n of e){const r=new Uint8Array(n.buffer,n.byteOffset,n.byteLength);s.set(r,i),i+=n.byteLength}return s}function Va(e){return new Hf(e).unpack()}function Ga(e){const t=new Xf,s=t.pack(e);return s instanceof Promise?s.then(()=>t.getBuffer()):t.getBuffer()}class Hf{constructor(t){this.index=0,this.dataBuffer=t,this.dataView=new Uint8Array(this.dataBuffer),this.length=this.dataBuffer.byteLength}unpack(){const t=this.unpack_uint8();if(t<128)return t;if((t^224)<32)return(t^224)-32;let s;if((s=t^160)<=15)return this.unpack_raw(s);if((s=t^176)<=15)return this.unpack_string(s);if((s=t^144)<=15)return this.unpack_array(s);if((s=t^128)<=15)return this.unpack_map(s);switch(t){case 192:return null;case 193:return;case 194:return!1;case 195:return!0;case 202:return this.unpack_float();case 203:return this.unpack_double();case 204:return this.unpack_uint8();case 205:return this.unpack_uint16();case 206:return this.unpack_uint32();case 207:return this.unpack_uint64();case 208:return this.unpack_int8();case 209:return this.unpack_int16();case 210:return this.unpack_int32();case 211:return this.unpack_int64();case 212:return;case 213:return;case 214:return;case 215:return;case 216:return s=this.unpack_uint16(),this.unpack_string(s);case 217:return s=this.unpack_uint32(),this.unpack_string(s);case 218:return s=this.unpack_uint16(),this.unpack_raw(s);case 219:return s=this.unpack_uint32(),this.unpack_raw(s);case 220:return s=this.unpack_uint16(),this.unpack_array(s);case 221:return s=this.unpack_uint32(),this.unpack_array(s);case 222:return s=this.unpack_uint16(),this.unpack_map(s);case 223:return s=this.unpack_uint32(),this.unpack_map(s)}}unpack_uint8(){const t=this.dataView[this.index]&255;return this.index++,t}unpack_uint16(){const t=this.read(2),s=(t[0]&255)*256+(t[1]&255);return this.index+=2,s}unpack_uint32(){const t=this.read(4),s=((t[0]*256+t[1])*256+t[2])*256+t[3];return this.index+=4,s}unpack_uint64(){const t=this.read(8),s=((((((t[0]*256+t[1])*256+t[2])*256+t[3])*256+t[4])*256+t[5])*256+t[6])*256+t[7];return this.index+=8,s}unpack_int8(){const t=this.unpack_uint8();return t<128?t:t-256}unpack_int16(){const t=this.unpack_uint16();return t<32768?t:t-65536}unpack_int32(){const t=this.unpack_uint32();return t<2**31?t:t-2**32}unpack_int64(){const t=this.unpack_uint64();return t<2**63?t:t-2**64}unpack_raw(t){if(this.length<this.index+t)throw new Error(`BinaryPackFailure: index is out of range ${this.index} ${t} ${this.length}`);const s=this.dataBuffer.slice(this.index,this.index+t);return this.index+=t,s}unpack_string(t){const s=this.read(t);let i=0,n="",r,o;for(;i<t;)r=s[i],r<160?(o=r,i++):(r^192)<32?(o=(r&31)<<6|s[i+1]&63,i+=2):(r^224)<16?(o=(r&15)<<12|(s[i+1]&63)<<6|s[i+2]&63,i+=3):(o=(r&7)<<18|(s[i+1]&63)<<12|(s[i+2]&63)<<6|s[i+3]&63,i+=4),n+=String.fromCodePoint(o);return this.index+=t,n}unpack_array(t){const s=new Array(t);for(let i=0;i<t;i++)s[i]=this.unpack();return s}unpack_map(t){const s={};for(let i=0;i<t;i++){const n=this.unpack();s[n]=this.unpack()}return s}unpack_float(){const t=this.unpack_uint32(),s=t>>31,i=(t>>23&255)-127,n=t&8388607|8388608;return(s===0?1:-1)*n*2**(i-23)}unpack_double(){const t=this.unpack_uint32(),s=this.unpack_uint32(),i=t>>31,n=(t>>20&2047)-1023,o=(t&1048575|1048576)*2**(n-20)+s*2**(n-52);return(i===0?1:-1)*o}read(t){const s=this.index;if(s+t<=this.length)return this.dataView.subarray(s,s+t);throw new Error("BinaryPackFailure: read index out of range")}}class Xf{getBuffer(){return this._bufferBuilder.toArrayBuffer()}pack(t){if(typeof t=="string")this.pack_string(t);else if(typeof t=="number")Math.floor(t)===t?this.pack_integer(t):this.pack_double(t);else if(typeof t=="boolean")t===!0?this._bufferBuilder.append(195):t===!1&&this._bufferBuilder.append(194);else if(t===void 0)this._bufferBuilder.append(192);else if(typeof t=="object")if(t===null)this._bufferBuilder.append(192);else{const s=t.constructor;if(t instanceof Array){const i=this.pack_array(t);if(i instanceof Promise)return i.then(()=>this._bufferBuilder.flush())}else if(t instanceof ArrayBuffer)this.pack_bin(new Uint8Array(t));else if("BYTES_PER_ELEMENT"in t){const i=t;this.pack_bin(new Uint8Array(i.buffer,i.byteOffset,i.byteLength))}else if(t instanceof Date)this.pack_string(t.toString());else{if(t instanceof Blob)return t.arrayBuffer().then(i=>{this.pack_bin(new Uint8Array(i)),this._bufferBuilder.flush()});if(s==Object||s.toString().startsWith("class")){const i=this.pack_object(t);if(i instanceof Promise)return i.then(()=>this._bufferBuilder.flush())}else throw new Error(`Type "${s.toString()}" not yet supported`)}}else throw new Error(`Type "${typeof t}" not yet supported`);this._bufferBuilder.flush()}pack_bin(t){const s=t.length;if(s<=15)this.pack_uint8(160+s);else if(s<=65535)this._bufferBuilder.append(218),this.pack_uint16(s);else if(s<=4294967295)this._bufferBuilder.append(219),this.pack_uint32(s);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(t)}pack_string(t){const s=this._textEncoder.encode(t),i=s.length;if(i<=15)this.pack_uint8(176+i);else if(i<=65535)this._bufferBuilder.append(216),this.pack_uint16(i);else if(i<=4294967295)this._bufferBuilder.append(217),this.pack_uint32(i);else throw new Error("Invalid length");this._bufferBuilder.append_buffer(s)}pack_array(t){const s=t.length;if(s<=15)this.pack_uint8(144+s);else if(s<=65535)this._bufferBuilder.append(220),this.pack_uint16(s);else if(s<=4294967295)this._bufferBuilder.append(221),this.pack_uint32(s);else throw new Error("Invalid length");const i=n=>{if(n<s){const r=this.pack(t[n]);return r instanceof Promise?r.then(()=>i(n+1)):i(n+1)}};return i(0)}pack_integer(t){if(t>=-32&&t<=127)this._bufferBuilder.append(t&255);else if(t>=0&&t<=255)this._bufferBuilder.append(204),this.pack_uint8(t);else if(t>=-128&&t<=127)this._bufferBuilder.append(208),this.pack_int8(t);else if(t>=0&&t<=65535)this._bufferBuilder.append(205),this.pack_uint16(t);else if(t>=-32768&&t<=32767)this._bufferBuilder.append(209),this.pack_int16(t);else if(t>=0&&t<=4294967295)this._bufferBuilder.append(206),this.pack_uint32(t);else if(t>=-2147483648&&t<=2147483647)this._bufferBuilder.append(210),this.pack_int32(t);else if(t>=-9223372036854776e3&&t<=9223372036854776e3)this._bufferBuilder.append(211),this.pack_int64(t);else if(t>=0&&t<=18446744073709552e3)this._bufferBuilder.append(207),this.pack_uint64(t);else throw new Error("Invalid integer")}pack_double(t){let s=0;t<0&&(s=1,t=-t);const i=Math.floor(Math.log(t)/Math.LN2),n=t/2**i-1,r=Math.floor(n*2**52),o=2**32,a=s<<31|i+1023<<20|r/o&1048575,h=r%o;this._bufferBuilder.append(203),this.pack_int32(a),this.pack_int32(h)}pack_object(t){const s=Object.keys(t),i=s.length;if(i<=15)this.pack_uint8(128+i);else if(i<=65535)this._bufferBuilder.append(222),this.pack_uint16(i);else if(i<=4294967295)this._bufferBuilder.append(223),this.pack_uint32(i);else throw new Error("Invalid length");const n=r=>{if(r<s.length){const o=s[r];if(t.hasOwnProperty(o)){this.pack(o);const a=this.pack(t[o]);if(a instanceof Promise)return a.then(()=>n(r+1))}return n(r+1)}};return n(0)}pack_uint8(t){this._bufferBuilder.append(t)}pack_uint16(t){this._bufferBuilder.append(t>>8),this._bufferBuilder.append(t&255)}pack_uint32(t){const s=t&4294967295;this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255)}pack_uint64(t){const s=t/4294967296,i=t%2**32;this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255),this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255)}pack_int8(t){this._bufferBuilder.append(t&255)}pack_int16(t){this._bufferBuilder.append((t&65280)>>8),this._bufferBuilder.append(t&255)}pack_int32(t){this._bufferBuilder.append(t>>>24&255),this._bufferBuilder.append((t&16711680)>>>16),this._bufferBuilder.append((t&65280)>>>8),this._bufferBuilder.append(t&255)}pack_int64(t){const s=Math.floor(t/4294967296),i=t%2**32;this._bufferBuilder.append((s&4278190080)>>>24),this._bufferBuilder.append((s&16711680)>>>16),this._bufferBuilder.append((s&65280)>>>8),this._bufferBuilder.append(s&255),this._bufferBuilder.append((i&4278190080)>>>24),this._bufferBuilder.append((i&16711680)>>>16),this._bufferBuilder.append((i&65280)>>>8),this._bufferBuilder.append(i&255)}constructor(){this._bufferBuilder=new Uf,this._textEncoder=new TextEncoder}}let qa=!0,ja=!0;function $s(e,t,s){const i=e.match(t);return i&&i.length>=s&&parseInt(i[s],10)}function Nt(e,t,s){if(!e.RTCPeerConnection)return;const i=e.RTCPeerConnection.prototype,n=i.addEventListener;i.addEventListener=function(o,a){if(o!==t)return n.apply(this,arguments);const h=l=>{const c=s(l);c&&(a.handleEvent?a.handleEvent(c):a(c))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(a,h),n.apply(this,[o,h])};const r=i.removeEventListener;i.removeEventListener=function(o,a){if(o!==t||!this._eventMap||!this._eventMap[t])return r.apply(this,arguments);if(!this._eventMap[t].has(a))return r.apply(this,arguments);const h=this._eventMap[t].get(a);return this._eventMap[t].delete(a),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,r.apply(this,[o,h])},Object.defineProperty(i,"on"+t,{get(){return this["_on"+t]},set(o){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),o&&this.addEventListener(t,this["_on"+t]=o)},enumerable:!0,configurable:!0})}function Yf(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(qa=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Wf(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(ja=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Ua(){if(typeof window=="object"){if(qa)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Kn(e,t){ja&&console.warn(e+" is deprecated, please use "+t+" instead.")}function zf(e){const t={browser:null,version:null};if(typeof e>"u"||!e.navigator||!e.navigator.userAgent)return t.browser="Not a browser.",t;const{navigator:s}=e;if(s.userAgentData&&s.userAgentData.brands){const i=s.userAgentData.brands.find(n=>n.brand==="Chromium");if(i)return{browser:"chrome",version:parseInt(i.version,10)}}if(s.mozGetUserMedia)t.browser="firefox",t.version=$s(s.userAgent,/Firefox\/(\d+)\./,1);else if(s.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=$s(s.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(e.RTCPeerConnection&&s.userAgent.match(/AppleWebKit\/(\d+)\./))t.browser="safari",t.version=$s(s.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype;else return t.browser="Not a supported browser.",t;return t}function Zr(e){return Object.prototype.toString.call(e)==="[object Object]"}function $a(e){return Zr(e)?Object.keys(e).reduce(function(t,s){const i=Zr(e[s]),n=i?$a(e[s]):e[s],r=i&&!Object.keys(n).length;return n===void 0||r?t:Object.assign(t,{[s]:n})},{}):e}function xn(e,t,s){!t||s.has(t.id)||(s.set(t.id,t),Object.keys(t).forEach(i=>{i.endsWith("Id")?xn(e,e.get(t[i]),s):i.endsWith("Ids")&&t[i].forEach(n=>{xn(e,e.get(n),s)})}))}function Kr(e,t,s){const i=s?"outbound-rtp":"inbound-rtp",n=new Map;if(t===null)return n;const r=[];return e.forEach(o=>{o.type==="track"&&o.trackIdentifier===t.id&&r.push(o)}),r.forEach(o=>{e.forEach(a=>{a.type===i&&a.trackId===o.id&&xn(e,a,n)})}),n}const Qr=Ua;function Ha(e,t){const s=e&&e.navigator;if(!s.mediaDevices)return;const i=function(a){if(typeof a!="object"||a.mandatory||a.optional)return a;const h={};return Object.keys(a).forEach(l=>{if(l==="require"||l==="advanced"||l==="mediaSource")return;const c=typeof a[l]=="object"?a[l]:{ideal:a[l]};c.exact!==void 0&&typeof c.exact=="number"&&(c.min=c.max=c.exact);const f=function(u,p){return u?u+p.charAt(0).toUpperCase()+p.slice(1):p==="deviceId"?"sourceId":p};if(c.ideal!==void 0){h.optional=h.optional||[];let u={};typeof c.ideal=="number"?(u[f("min",l)]=c.ideal,h.optional.push(u),u={},u[f("max",l)]=c.ideal,h.optional.push(u)):(u[f("",l)]=c.ideal,h.optional.push(u))}c.exact!==void 0&&typeof c.exact!="number"?(h.mandatory=h.mandatory||{},h.mandatory[f("",l)]=c.exact):["min","max"].forEach(u=>{c[u]!==void 0&&(h.mandatory=h.mandatory||{},h.mandatory[f(u,l)]=c[u])})}),a.advanced&&(h.optional=(h.optional||[]).concat(a.advanced)),h},n=function(a,h){if(t.version>=61)return h(a);if(a=JSON.parse(JSON.stringify(a)),a&&typeof a.audio=="object"){const l=function(c,f,u){f in c&&!(u in c)&&(c[u]=c[f],delete c[f])};a=JSON.parse(JSON.stringify(a)),l(a.audio,"autoGainControl","googAutoGainControl"),l(a.audio,"noiseSuppression","googNoiseSuppression"),a.audio=i(a.audio)}if(a&&typeof a.video=="object"){let l=a.video.facingMode;l=l&&(typeof l=="object"?l:{ideal:l});const c=t.version<66;if(l&&(l.exact==="user"||l.exact==="environment"||l.ideal==="user"||l.ideal==="environment")&&!(s.mediaDevices.getSupportedConstraints&&s.mediaDevices.getSupportedConstraints().facingMode&&!c)){delete a.video.facingMode;let f;if(l.exact==="environment"||l.ideal==="environment"?f=["back","rear"]:(l.exact==="user"||l.ideal==="user")&&(f=["front"]),f)return s.mediaDevices.enumerateDevices().then(u=>{u=u.filter(_=>_.kind==="videoinput");let p=u.find(_=>f.some(R=>_.label.toLowerCase().includes(R)));return!p&&u.length&&f.includes("back")&&(p=u[u.length-1]),p&&(a.video.deviceId=l.exact?{exact:p.deviceId}:{ideal:p.deviceId}),a.video=i(a.video),Qr("chrome: "+JSON.stringify(a)),h(a)})}a.video=i(a.video)}return Qr("chrome: "+JSON.stringify(a)),h(a)},r=function(a){return t.version>=64?a:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[a.name]||a.name,message:a.message,constraint:a.constraint||a.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},o=function(a,h,l){n(a,c=>{s.webkitGetUserMedia(c,h,f=>{l&&l(r(f))})})};if(s.getUserMedia=o.bind(s),s.mediaDevices.getUserMedia){const a=s.mediaDevices.getUserMedia.bind(s.mediaDevices);s.mediaDevices.getUserMedia=function(h){return n(h,l=>a(l).then(c=>{if(l.audio&&!c.getAudioTracks().length||l.video&&!c.getVideoTracks().length)throw c.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return c},c=>Promise.reject(r(c))))}}}function Xa(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Ya(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(s){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=s)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",n=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.track.id):r={track:n.track};const o=new Event("track");o.track=n.track,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)}),i.stream.getTracks().forEach(n=>{let r;e.RTCPeerConnection.prototype.getReceivers?r=this.getReceivers().find(a=>a.track&&a.track.id===n.id):r={track:n};const o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=[i.stream],this.dispatchEvent(o)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Nt(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function Wa(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(n,r){return{track:r,get dtmf(){return this._dtmf===void 0&&(r.kind==="audio"?this._dtmf=n.createDTMFSender(r):this._dtmf=null),this._dtmf},_pc:n}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,h){let l=n.apply(this,arguments);return l||(l=t(this,a),this._senders.push(l)),l};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){r.apply(this,arguments);const h=this._senders.indexOf(a);h!==-1&&this._senders.splice(h,1)}}const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(r){this._senders=this._senders||[],s.apply(this,[r]),r.getTracks().forEach(o=>{this._senders.push(t(this,o))})};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(r){this._senders=this._senders||[],i.apply(this,[r]),r.getTracks().forEach(o=>{const a=this._senders.find(h=>h.track===o);a&&this._senders.splice(this._senders.indexOf(a),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=t.apply(this,[]);return i.forEach(n=>n._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function za(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const s=e.RTCPeerConnection.prototype.getSenders;s&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=s.apply(this,[]);return r.forEach(o=>o._pc=this),r});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=i.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>Kr(o,r.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=s.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Nt(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){const n=this;return this._pc.getStats().then(r=>Kr(r,n.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let n,r,o;return this.getSenders().forEach(a=>{a.track===i&&(n?o=!0:n=a)}),this.getReceivers().forEach(a=>(a.track===i&&(r?o=!0:r=a),a.track===i)),o||n&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):n?n.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Ja(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(o=>this._shimmedLocalStreams[o][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(o,a){if(!a)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const h=t.apply(this,arguments);return this._shimmedLocalStreams[a.id]?this._shimmedLocalStreams[a.id].indexOf(h)===-1&&this._shimmedLocalStreams[a.id].push(h):this._shimmedLocalStreams[a.id]=[a,h],h};const s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._shimmedLocalStreams=this._shimmedLocalStreams||{},o.getTracks().forEach(l=>{if(this.getSenders().find(f=>f.track===l))throw new DOMException("Track already exists.","InvalidAccessError")});const a=this.getSenders();s.apply(this,arguments);const h=this.getSenders().filter(l=>a.indexOf(l)===-1);this._shimmedLocalStreams[o.id]=[o].concat(h)};const i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[o.id],i.apply(this,arguments)};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(o){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},o&&Object.keys(this._shimmedLocalStreams).forEach(a=>{const h=this._shimmedLocalStreams[a].indexOf(o);h!==-1&&this._shimmedLocalStreams[a].splice(h,1),this._shimmedLocalStreams[a].length===1&&delete this._shimmedLocalStreams[a]}),n.apply(this,arguments)}}function Za(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Ja(e);const s=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const c=s.apply(this);return this._reverseStreams=this._reverseStreams||{},c.map(f=>this._reverseStreams[f.id])};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(c){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},c.getTracks().forEach(f=>{if(this.getSenders().find(p=>p.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[c.id]){const f=new e.MediaStream(c.getTracks());this._streams[c.id]=f,this._reverseStreams[f.id]=c,c=f}i.apply(this,[c])};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(c){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},n.apply(this,[this._streams[c.id]||c]),delete this._reverseStreams[this._streams[c.id]?this._streams[c.id].id:c.id],delete this._streams[c.id]},e.RTCPeerConnection.prototype.addTrack=function(c,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const u=[].slice.call(arguments,1);if(u.length!==1||!u[0].getTracks().find(R=>R===c))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(R=>R.track===c))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const _=this._streams[f.id];if(_)_.addTrack(c),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const R=new e.MediaStream([c]);this._streams[f.id]=R,this._reverseStreams[R.id]=f,this.addStream(R)}return this.getSenders().find(R=>R.track===c)};function r(l,c){let f=c.sdp;return Object.keys(l._reverseStreams||[]).forEach(u=>{const p=l._reverseStreams[u],_=l._streams[p.id];f=f.replace(new RegExp(_.id,"g"),p.id)}),new RTCSessionDescription({type:c.type,sdp:f})}function o(l,c){let f=c.sdp;return Object.keys(l._reverseStreams||[]).forEach(u=>{const p=l._reverseStreams[u],_=l._streams[p.id];f=f.replace(new RegExp(p.id,"g"),_.id)}),new RTCSessionDescription({type:c.type,sdp:f})}["createOffer","createAnswer"].forEach(function(l){const c=e.RTCPeerConnection.prototype[l],f={[l](){const u=arguments;return arguments.length&&typeof arguments[0]=="function"?c.apply(this,[_=>{const R=r(this,_);u[0].apply(null,[R])},_=>{u[1]&&u[1].apply(null,_)},arguments[2]]):c.apply(this,arguments).then(_=>r(this,_))}};e.RTCPeerConnection.prototype[l]=f[l]});const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return!arguments.length||!arguments[0].type?a.apply(this,arguments):(arguments[0]=o(this,arguments[0]),a.apply(this,arguments))};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const l=h.get.apply(this);return l.type===""?l:r(this,l)}}),e.RTCPeerConnection.prototype.removeTrack=function(c){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!c._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(c._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};let u;Object.keys(this._streams).forEach(p=>{this._streams[p].getTracks().find(R=>c.track===R)&&(u=this._streams[p])}),u&&(u.getTracks().length===1?this.removeStream(this._reverseStreams[u.id]):u.removeTrack(c.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Sn(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(s){const i=e.RTCPeerConnection.prototype[s],n={[s](){return arguments[0]=new(s==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}};e.RTCPeerConnection.prototype[s]=n[s]})}function Ka(e,t){Nt(e,"negotiationneeded",s=>{const i=s.target;if(!((t.version<72||i.getConfiguration&&i.getConfiguration().sdpSemantics==="plan-b")&&i.signalingState!=="stable"))return s})}const eo=Object.freeze(Object.defineProperty({__proto__:null,fixNegotiationNeeded:Ka,shimAddTrackRemoveTrack:Za,shimAddTrackRemoveTrackWithNative:Ja,shimGetSendersWithDtmf:Wa,shimGetUserMedia:Ha,shimMediaStream:Xa,shimOnTrack:Ya,shimPeerConnection:Sn,shimSenderReceiverGetStats:za},Symbol.toStringTag,{value:"Module"}));function Qa(e,t){const s=e&&e.navigator,i=e&&e.MediaStreamTrack;if(s.getUserMedia=function(n,r,o){Kn("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),s.mediaDevices.getUserMedia(n).then(r,o)},!(t.version>55&&"autoGainControl"in s.mediaDevices.getSupportedConstraints())){const n=function(o,a,h){a in o&&!(h in o)&&(o[h]=o[a],delete o[a])},r=s.mediaDevices.getUserMedia.bind(s.mediaDevices);if(s.mediaDevices.getUserMedia=function(o){return typeof o=="object"&&typeof o.audio=="object"&&(o=JSON.parse(JSON.stringify(o)),n(o.audio,"autoGainControl","mozAutoGainControl"),n(o.audio,"noiseSuppression","mozNoiseSuppression")),r(o)},i&&i.prototype.getSettings){const o=i.prototype.getSettings;i.prototype.getSettings=function(){const a=o.apply(this,arguments);return n(a,"mozAutoGainControl","autoGainControl"),n(a,"mozNoiseSuppression","noiseSuppression"),a}}if(i&&i.prototype.applyConstraints){const o=i.prototype.applyConstraints;i.prototype.applyConstraints=function(a){return this.kind==="audio"&&typeof a=="object"&&(a=JSON.parse(JSON.stringify(a)),n(a,"autoGainControl","mozAutoGainControl"),n(a,"noiseSuppression","mozNoiseSuppression")),o.apply(this,[a])}}}}function Jf(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!(i&&i.video)){const n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return i.video===!0?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)})}function eh(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cn(e,t){if(typeof e!="object"||!(e.RTCPeerConnection||e.mozRTCPeerConnection))return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]});const s={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[r,o,a]=arguments;return i.apply(this,[r||null]).then(h=>{if(t.version<53&&!o)try{h.forEach(l=>{l.type=s[l.type]||l.type})}catch(l){if(l.name!=="TypeError")throw l;h.forEach((c,f)=>{h.set(f,Object.assign({},c,{type:s[c.type]||c.type}))})}return h}).then(o,a)}}function th(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n});const s=e.RTCPeerConnection.prototype.addTrack;s&&(e.RTCPeerConnection.prototype.addTrack=function(){const n=s.apply(this,arguments);return n._pc=this,n}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function sh(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender)||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=t.apply(this,[]);return i.forEach(n=>n._pc=this),i}),Nt(e,"track",s=>(s.receiver._pc=s.srcElement,s)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function ih(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(s){Kn("removeStream","removeTrack"),this.getSenders().forEach(i=>{i.track&&s.getTracks().includes(i.track)&&this.removeTrack(i)})})}function nh(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function rh(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const n=i.length>0;n&&i.forEach(o=>{if("rid"in o&&!/^[a-z0-9]{0,16}$/i.test(o.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in o&&!(parseFloat(o.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in o&&!(parseFloat(o.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const r=t.apply(this,arguments);if(n){const{sender:o}=r,a=o.getParameters();(!("encodings"in a)||a.encodings.length===1&&Object.keys(a.encodings[0]).length===0)&&(a.encodings=i,o.sendEncodings=i,this.setParametersPromises.push(o.setParameters(a).then(()=>{delete o.sendEncodings}).catch(()=>{delete o.sendEncodings})))}return r})}function oh(e){if(!(typeof e=="object"&&e.RTCRtpSender))return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const i=t.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function ah(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function hh(e){if(!(typeof e=="object"&&e.RTCPeerConnection))return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}const to=Object.freeze(Object.defineProperty({__proto__:null,shimAddTransceiver:rh,shimCreateAnswer:hh,shimCreateOffer:ah,shimGetDisplayMedia:Jf,shimGetParameters:oh,shimGetUserMedia:Qa,shimOnTrack:eh,shimPeerConnection:Cn,shimRTCDataChannel:nh,shimReceiverGetStats:sh,shimRemoveStream:ih,shimSenderGetStats:th},Symbol.toStringTag,{value:"Module"}));function ch(e){if(!(typeof e!="object"||!e.RTCPeerConnection)){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){this._localStreams||(this._localStreams=[]),this._localStreams.includes(i)||this._localStreams.push(i),i.getAudioTracks().forEach(n=>t.call(this,n,i)),i.getVideoTracks().forEach(n=>t.call(this,n,i))},e.RTCPeerConnection.prototype.addTrack=function(i,...n){return n&&n.forEach(r=>{this._localStreams?this._localStreams.includes(r)||this._localStreams.push(r):this._localStreams=[r]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(s){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(s);if(i===-1)return;this._localStreams.splice(i,1);const n=s.getTracks();this.getSenders().forEach(r=>{n.includes(r.track)&&this.removeTrack(r)})})}}function lh(e){if(!(typeof e!="object"||!e.RTCPeerConnection)&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(s){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=s),this.addEventListener("track",this._onaddstreampoly=i=>{i.streams.forEach(n=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(n))return;this._remoteStreams.push(n);const r=new Event("addstream");r.stream=n,this.dispatchEvent(r)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(n){n.streams.forEach(r=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(r)>=0)return;i._remoteStreams.push(r);const o=new Event("addstream");o.stream=r,i.dispatchEvent(o)})}),t.apply(i,arguments)}}}function fh(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,s=t.createOffer,i=t.createAnswer,n=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(l,c){const f=arguments.length>=2?arguments[2]:arguments[0],u=s.apply(this,[f]);return c?(u.then(l,c),Promise.resolve()):u},t.createAnswer=function(l,c){const f=arguments.length>=2?arguments[2]:arguments[0],u=i.apply(this,[f]);return c?(u.then(l,c),Promise.resolve()):u};let a=function(h,l,c){const f=n.apply(this,[h]);return c?(f.then(l,c),Promise.resolve()):f};t.setLocalDescription=a,a=function(h,l,c){const f=r.apply(this,[h]);return c?(f.then(l,c),Promise.resolve()):f},t.setRemoteDescription=a,a=function(h,l,c){const f=o.apply(this,[h]);return c?(f.then(l,c),Promise.resolve()):f},t.addIceCandidate=a}function uh(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const s=t.mediaDevices,i=s.getUserMedia.bind(s);t.mediaDevices.getUserMedia=n=>i(ph(n))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(i,n,r){t.mediaDevices.getUserMedia(i).then(n,r)}).bind(t))}function ph(e){return e&&e.video!==void 0?Object.assign({},e,{video:$a(e.video)}):e}function dh(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(i,n){if(i&&i.iceServers){const r=[];for(let o=0;o<i.iceServers.length;o++){let a=i.iceServers[o];a.urls===void 0&&a.url?(Kn("RTCIceServer.url","RTCIceServer.urls"),a=JSON.parse(JSON.stringify(a)),a.urls=a.url,delete a.url,r.push(a)):r.push(i.iceServers[o])}i.iceServers=r}return new t(i,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function mh(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function gh(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){typeof i.offerToReceiveAudio<"u"&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const n=this.getTransceivers().find(o=>o.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&n?n.direction==="sendrecv"?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":n.direction==="recvonly"&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):i.offerToReceiveAudio===!0&&!n&&this.addTransceiver("audio",{direction:"recvonly"}),typeof i.offerToReceiveVideo<"u"&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const r=this.getTransceivers().find(o=>o.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):i.offerToReceiveVideo===!0&&!r&&this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function _h(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}const so=Object.freeze(Object.defineProperty({__proto__:null,shimAudioContext:_h,shimCallbacksAPI:fh,shimConstraints:ph,shimCreateOfferLegacy:gh,shimGetUserMedia:uh,shimLocalStreamsAPI:ch,shimRTCIceServerUrls:dh,shimRemoteStreamsAPI:lh,shimTrackEventTransceiver:mh},Symbol.toStringTag,{value:"Module"}));var Wi={exports:{}},io;function Zf(){return io||(io=1,function(e){const t={};t.generateIdentifier=function(){return Math.random().toString(36).substring(2,12)},t.localCName=t.generateIdentifier(),t.splitLines=function(s){return s.trim().split(`
`).map(i=>i.trim())},t.splitSections=function(s){return s.split(`
m=`).map((n,r)=>(r>0?"m="+n:n).trim()+`\r
`)},t.getDescription=function(s){const i=t.splitSections(s);return i&&i[0]},t.getMediaSections=function(s){const i=t.splitSections(s);return i.shift(),i},t.matchPrefix=function(s,i){return t.splitLines(s).filter(n=>n.indexOf(i)===0)},t.parseCandidate=function(s){let i;s.indexOf("a=candidate:")===0?i=s.substring(12).split(" "):i=s.substring(10).split(" ");const n={foundation:i[0],component:{1:"rtp",2:"rtcp"}[i[1]]||i[1],protocol:i[2].toLowerCase(),priority:parseInt(i[3],10),ip:i[4],address:i[4],port:parseInt(i[5],10),type:i[7]};for(let r=8;r<i.length;r+=2)switch(i[r]){case"raddr":n.relatedAddress=i[r+1];break;case"rport":n.relatedPort=parseInt(i[r+1],10);break;case"tcptype":n.tcpType=i[r+1];break;case"ufrag":n.ufrag=i[r+1],n.usernameFragment=i[r+1];break;default:n[i[r]]===void 0&&(n[i[r]]=i[r+1]);break}return n},t.writeCandidate=function(s){const i=[];i.push(s.foundation);const n=s.component;n==="rtp"?i.push(1):n==="rtcp"?i.push(2):i.push(n),i.push(s.protocol.toUpperCase()),i.push(s.priority),i.push(s.address||s.ip),i.push(s.port);const r=s.type;return i.push("typ"),i.push(r),r!=="host"&&s.relatedAddress&&s.relatedPort&&(i.push("raddr"),i.push(s.relatedAddress),i.push("rport"),i.push(s.relatedPort)),s.tcpType&&s.protocol.toLowerCase()==="tcp"&&(i.push("tcptype"),i.push(s.tcpType)),(s.usernameFragment||s.ufrag)&&(i.push("ufrag"),i.push(s.usernameFragment||s.ufrag)),"candidate:"+i.join(" ")},t.parseIceOptions=function(s){return s.substring(14).split(" ")},t.parseRtpMap=function(s){let i=s.substring(9).split(" ");const n={payloadType:parseInt(i.shift(),10)};return i=i[0].split("/"),n.name=i[0],n.clockRate=parseInt(i[1],10),n.channels=i.length===3?parseInt(i[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(s){let i=s.payloadType;s.preferredPayloadType!==void 0&&(i=s.preferredPayloadType);const n=s.channels||s.numChannels||1;return"a=rtpmap:"+i+" "+s.name+"/"+s.clockRate+(n!==1?"/"+n:"")+`\r
`},t.parseExtmap=function(s){const i=s.substring(9).split(" ");return{id:parseInt(i[0],10),direction:i[0].indexOf("/")>0?i[0].split("/")[1]:"sendrecv",uri:i[1],attributes:i.slice(2).join(" ")}},t.writeExtmap=function(s){return"a=extmap:"+(s.id||s.preferredId)+(s.direction&&s.direction!=="sendrecv"?"/"+s.direction:"")+" "+s.uri+(s.attributes?" "+s.attributes:"")+`\r
`},t.parseFmtp=function(s){const i={};let n;const r=s.substring(s.indexOf(" ")+1).split(";");for(let o=0;o<r.length;o++)n=r[o].trim().split("="),i[n[0].trim()]=n[1];return i},t.writeFmtp=function(s){let i="",n=s.payloadType;if(s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType),s.parameters&&Object.keys(s.parameters).length){const r=[];Object.keys(s.parameters).forEach(o=>{s.parameters[o]!==void 0?r.push(o+"="+s.parameters[o]):r.push(o)}),i+="a=fmtp:"+n+" "+r.join(";")+`\r
`}return i},t.parseRtcpFb=function(s){const i=s.substring(s.indexOf(" ")+1).split(" ");return{type:i.shift(),parameter:i.join(" ")}},t.writeRtcpFb=function(s){let i="",n=s.payloadType;return s.preferredPayloadType!==void 0&&(n=s.preferredPayloadType),s.rtcpFeedback&&s.rtcpFeedback.length&&s.rtcpFeedback.forEach(r=>{i+="a=rtcp-fb:"+n+" "+r.type+(r.parameter&&r.parameter.length?" "+r.parameter:"")+`\r
`}),i},t.parseSsrcMedia=function(s){const i=s.indexOf(" "),n={ssrc:parseInt(s.substring(7,i),10)},r=s.indexOf(":",i);return r>-1?(n.attribute=s.substring(i+1,r),n.value=s.substring(r+1)):n.attribute=s.substring(i+1),n},t.parseSsrcGroup=function(s){const i=s.substring(13).split(" ");return{semantics:i.shift(),ssrcs:i.map(n=>parseInt(n,10))}},t.getMid=function(s){const i=t.matchPrefix(s,"a=mid:")[0];if(i)return i.substring(6)},t.parseFingerprint=function(s){const i=s.substring(14).split(" ");return{algorithm:i[0].toLowerCase(),value:i[1].toUpperCase()}},t.getDtlsParameters=function(s,i){return{role:"auto",fingerprints:t.matchPrefix(s+i,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(s,i){let n="a=setup:"+i+`\r
`;return s.fingerprints.forEach(r=>{n+="a=fingerprint:"+r.algorithm+" "+r.value+`\r
`}),n},t.parseCryptoLine=function(s){const i=s.substring(9).split(" ");return{tag:parseInt(i[0],10),cryptoSuite:i[1],keyParams:i[2],sessionParams:i.slice(3)}},t.writeCryptoLine=function(s){return"a=crypto:"+s.tag+" "+s.cryptoSuite+" "+(typeof s.keyParams=="object"?t.writeCryptoKeyParams(s.keyParams):s.keyParams)+(s.sessionParams?" "+s.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(s){if(s.indexOf("inline:")!==0)return null;const i=s.substring(7).split("|");return{keyMethod:"inline",keySalt:i[0],lifeTime:i[1],mkiValue:i[2]?i[2].split(":")[0]:void 0,mkiLength:i[2]?i[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(s){return s.keyMethod+":"+s.keySalt+(s.lifeTime?"|"+s.lifeTime:"")+(s.mkiValue&&s.mkiLength?"|"+s.mkiValue+":"+s.mkiLength:"")},t.getCryptoParameters=function(s,i){return t.matchPrefix(s+i,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(s,i){const n=t.matchPrefix(s+i,"a=ice-ufrag:")[0],r=t.matchPrefix(s+i,"a=ice-pwd:")[0];return n&&r?{usernameFragment:n.substring(12),password:r.substring(10)}:null},t.writeIceParameters=function(s){let i="a=ice-ufrag:"+s.usernameFragment+`\r
a=ice-pwd:`+s.password+`\r
`;return s.iceLite&&(i+=`a=ice-lite\r
`),i},t.parseRtpParameters=function(s){const i={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(s)[0].split(" ");i.profile=r[2];for(let a=3;a<r.length;a++){const h=r[a],l=t.matchPrefix(s,"a=rtpmap:"+h+" ")[0];if(l){const c=t.parseRtpMap(l),f=t.matchPrefix(s,"a=fmtp:"+h+" ");switch(c.parameters=f.length?t.parseFmtp(f[0]):{},c.rtcpFeedback=t.matchPrefix(s,"a=rtcp-fb:"+h+" ").map(t.parseRtcpFb),i.codecs.push(c),c.name.toUpperCase()){case"RED":case"ULPFEC":i.fecMechanisms.push(c.name.toUpperCase());break}}}t.matchPrefix(s,"a=extmap:").forEach(a=>{i.headerExtensions.push(t.parseExtmap(a))});const o=t.matchPrefix(s,"a=rtcp-fb:* ").map(t.parseRtcpFb);return i.codecs.forEach(a=>{o.forEach(h=>{a.rtcpFeedback.find(c=>c.type===h.type&&c.parameter===h.parameter)||a.rtcpFeedback.push(h)})}),i},t.writeRtpDescription=function(s,i){let n="";n+="m="+s+" ",n+=i.codecs.length>0?"9":"0",n+=" "+(i.profile||"UDP/TLS/RTP/SAVPF")+" ",n+=i.codecs.map(o=>o.preferredPayloadType!==void 0?o.preferredPayloadType:o.payloadType).join(" ")+`\r
`,n+=`c=IN IP4 0.0.0.0\r
`,n+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,i.codecs.forEach(o=>{n+=t.writeRtpMap(o),n+=t.writeFmtp(o),n+=t.writeRtcpFb(o)});let r=0;return i.codecs.forEach(o=>{o.maxptime>r&&(r=o.maxptime)}),r>0&&(n+="a=maxptime:"+r+`\r
`),i.headerExtensions&&i.headerExtensions.forEach(o=>{n+=t.writeExtmap(o)}),n},t.parseRtpEncodingParameters=function(s){const i=[],n=t.parseRtpParameters(s),r=n.fecMechanisms.indexOf("RED")!==-1,o=n.fecMechanisms.indexOf("ULPFEC")!==-1,a=t.matchPrefix(s,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname"),h=a.length>0&&a[0].ssrc;let l;const c=t.matchPrefix(s,"a=ssrc-group:FID").map(u=>u.substring(17).split(" ").map(_=>parseInt(_,10)));c.length>0&&c[0].length>1&&c[0][0]===h&&(l=c[0][1]),n.codecs.forEach(u=>{if(u.name.toUpperCase()==="RTX"&&u.parameters.apt){let p={ssrc:h,codecPayloadType:parseInt(u.parameters.apt,10)};h&&l&&(p.rtx={ssrc:l}),i.push(p),r&&(p=JSON.parse(JSON.stringify(p)),p.fec={ssrc:h,mechanism:o?"red+ulpfec":"red"},i.push(p))}}),i.length===0&&h&&i.push({ssrc:h});let f=t.matchPrefix(s,"b=");return f.length&&(f[0].indexOf("b=TIAS:")===0?f=parseInt(f[0].substring(7),10):f[0].indexOf("b=AS:")===0?f=parseInt(f[0].substring(5),10)*1e3*.95-50*40*8:f=void 0,i.forEach(u=>{u.maxBitrate=f})),i},t.parseRtcpParameters=function(s){const i={},n=t.matchPrefix(s,"a=ssrc:").map(a=>t.parseSsrcMedia(a)).filter(a=>a.attribute==="cname")[0];n&&(i.cname=n.value,i.ssrc=n.ssrc);const r=t.matchPrefix(s,"a=rtcp-rsize");i.reducedSize=r.length>0,i.compound=r.length===0;const o=t.matchPrefix(s,"a=rtcp-mux");return i.mux=o.length>0,i},t.writeRtcpParameters=function(s){let i="";return s.reducedSize&&(i+=`a=rtcp-rsize\r
`),s.mux&&(i+=`a=rtcp-mux\r
`),s.ssrc!==void 0&&s.cname&&(i+="a=ssrc:"+s.ssrc+" cname:"+s.cname+`\r
`),i},t.parseMsid=function(s){let i;const n=t.matchPrefix(s,"a=msid:");if(n.length===1)return i=n[0].substring(7).split(" "),{stream:i[0],track:i[1]};const r=t.matchPrefix(s,"a=ssrc:").map(o=>t.parseSsrcMedia(o)).filter(o=>o.attribute==="msid");if(r.length>0)return i=r[0].value.split(" "),{stream:i[0],track:i[1]}},t.parseSctpDescription=function(s){const i=t.parseMLine(s),n=t.matchPrefix(s,"a=max-message-size:");let r;n.length>0&&(r=parseInt(n[0].substring(19),10)),isNaN(r)&&(r=65536);const o=t.matchPrefix(s,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substring(12),10),protocol:i.fmt,maxMessageSize:r};const a=t.matchPrefix(s,"a=sctpmap:");if(a.length>0){const h=a[0].substring(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:r}}},t.writeSctpDescription=function(s,i){let n=[];return s.protocol!=="DTLS/SCTP"?n=["m="+s.kind+" 9 "+s.protocol+" "+i.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+i.port+`\r
`]:n=["m="+s.kind+" 9 "+s.protocol+" "+i.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+i.port+" "+i.protocol+` 65535\r
`],i.maxMessageSize!==void 0&&n.push("a=max-message-size:"+i.maxMessageSize+`\r
`),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(s,i,n){let r;const o=i!==void 0?i:2;return s?r=s:r=t.generateSessionId(),`v=0\r
o=`+(n||"thisisadapterortc")+" "+r+" "+o+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(s,i){const n=t.splitLines(s);for(let r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substring(2)}return i?t.getDirection(i):"sendrecv"},t.getKind=function(s){return t.splitLines(s)[0].split(" ")[0].substring(2)},t.isRejected=function(s){return s.split(" ",2)[1]==="0"},t.parseMLine=function(s){const n=t.splitLines(s)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(s){const n=t.matchPrefix(s,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(s){if(typeof s!="string"||s.length===0)return!1;const i=t.splitLines(s);for(let n=0;n<i.length;n++)if(i[n].length<2||i[n].charAt(1)!=="=")return!1;return!0},e.exports=t}(Wi)),Wi.exports}var Rh=Zf();const zt=La(Rh),Kf=Gh({__proto__:null,default:zt},[Rh]);function Hs(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&(i=JSON.parse(JSON.stringify(i)),i.candidate=i.candidate.substring(2)),i.candidate&&i.candidate.length){const n=new t(i),r=zt.parseCandidate(i.candidate);for(const o in r)o in n||Object.defineProperty(n,o,{value:r[o]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(i)},e.RTCIceCandidate.prototype=t.prototype,Nt(e,"icecandidate",s=>(s.candidate&&Object.defineProperty(s,"candidate",{value:new e.RTCIceCandidate(s.candidate),writable:"false"}),s))}function bn(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Nt(e,"icecandidate",t=>{if(t.candidate){const s=zt.parseCandidate(t.candidate.candidate);s.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[s.priority>>24])}return t})}function Xs(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp}});const s=function(a){if(!a||!a.sdp)return!1;const h=zt.splitSections(a.sdp);return h.shift(),h.some(l=>{const c=zt.parseMLine(l);return c&&c.kind==="application"&&c.protocol.indexOf("SCTP")!==-1})},i=function(a){const h=a.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const l=parseInt(h[1],10);return l!==l?-1:l},n=function(a){let h=65536;return t.browser==="firefox"&&(t.version<57?a===-1?h=16384:h=2147483637:t.version<60?h=t.version===57?65535:65536:h=2147483637),h},r=function(a,h){let l=65536;t.browser==="firefox"&&t.version===57&&(l=65535);const c=zt.matchPrefix(a.sdp,"a=max-message-size:");return c.length>0?l=parseInt(c[0].substring(19),10):t.browser==="firefox"&&h!==-1&&(l=2147483637),l},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:h}=this.getConfiguration();h==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return typeof this._sctp>"u"?null:this._sctp},enumerable:!0,configurable:!0})}if(s(arguments[0])){const h=i(arguments[0]),l=n(h),c=r(arguments[0],h);let f;l===0&&c===0?f=Number.POSITIVE_INFINITY:l===0||c===0?f=Math.max(l,c):f=Math.min(l,c);const u={};Object.defineProperty(u,"maxMessageSize",{get(){return f}}),this._sctp=u}return o.apply(this,arguments)}}function Ys(e){if(!(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype))return;function t(i,n){const r=i.send;i.send=function(){const a=arguments[0],h=a.length||a.size||a.byteLength;if(i.readyState==="open"&&n.sctp&&h>n.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+n.sctp.maxMessageSize+" bytes)");return r.apply(i,arguments)}}const s=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const n=s.apply(this,arguments);return t(n,this),n},Nt(e,"datachannel",i=>(t(i.channel,i.target),i))}function yn(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(s){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),s&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=s)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(s=>{const i=t[s];t[s]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=n=>{const r=n.target;if(r._lastConnectionState!==r.connectionState){r._lastConnectionState=r.connectionState;const o=new Event("connectionstatechange",n);r.dispatchEvent(o)}return n},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}})}function vn(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(n){if(n&&n.sdp&&n.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const r=n.sdp.split(`
`).filter(o=>o.trim()!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&n instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:n.type,sdp:r}):n.sdp=r}return s.apply(this,arguments)}}function Ws(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const s=e.RTCPeerConnection.prototype.addIceCandidate;!s||s.length===0||(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function zs(e,t){if(!(e.RTCPeerConnection&&e.RTCPeerConnection.prototype))return;const s=e.RTCPeerConnection.prototype.setLocalDescription;!s||s.length===0||(e.RTCPeerConnection.prototype.setLocalDescription=function(){let n=arguments[0]||{};if(typeof n!="object"||n.type&&n.sdp)return s.apply(this,arguments);if(n={type:n.type,sdp:n.sdp},!n.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":n.type="offer";break;default:n.type="answer";break}return n.sdp||n.type!=="offer"&&n.type!=="answer"?s.apply(this,[n]):(n.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(o=>s.apply(this,[o]))})}const Qf=Object.freeze(Object.defineProperty({__proto__:null,removeExtmapAllowMixed:vn,shimAddIceCandidateNullOrEmpty:Ws,shimConnectionState:yn,shimMaxMessageSize:Xs,shimParameterlessSetLocalDescription:zs,shimRTCIceCandidate:Hs,shimRTCIceCandidateRelayProtocol:bn,shimSendThrowTypeError:Ys},Symbol.toStringTag,{value:"Module"}));function eu({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const s=Ua,i=zf(e),n={browserDetails:i,commonShim:Qf,extractVersion:$s,disableLog:Yf,disableWarnings:Wf,sdp:Kf};switch(i.browser){case"chrome":if(!eo||!Sn||!t.shimChrome)return s("Chrome shim is not included in this adapter release."),n;if(i.version===null)return s("Chrome shim can not determine version, not shimming."),n;s("adapter.js shimming chrome."),n.browserShim=eo,Ws(e,i),zs(e),Ha(e,i),Xa(e),Sn(e,i),Ya(e),Za(e,i),Wa(e),za(e),Ka(e,i),Hs(e),bn(e),yn(e),Xs(e,i),Ys(e),vn(e,i);break;case"firefox":if(!to||!Cn||!t.shimFirefox)return s("Firefox shim is not included in this adapter release."),n;s("adapter.js shimming firefox."),n.browserShim=to,Ws(e,i),zs(e),Qa(e,i),Cn(e,i),eh(e),ih(e),th(e),sh(e),nh(e),rh(e),oh(e),ah(e),hh(e),Hs(e),yn(e),Xs(e,i),Ys(e);break;case"safari":if(!so||!t.shimSafari)return s("Safari shim is not included in this adapter release."),n;s("adapter.js shimming safari."),n.browserShim=so,Ws(e,i),zs(e),dh(e),gh(e),fh(e),ch(e),lh(e),mh(e),uh(e),_h(e),Hs(e),bn(e),Xs(e,i),Ys(e),vn(e,i);break;default:s("Unsupported browser!");break}return n}const no=eu({window:typeof window>"u"?void 0:window});function Mt(e,t,s,i){Object.defineProperty(e,t,{get:s,set:i,enumerable:!0,configurable:!0})}class xh{constructor(){this.chunkedMTU=16300,this._dataCount=1,this.chunk=t=>{const s=[],i=t.byteLength,n=Math.ceil(i/this.chunkedMTU);let r=0,o=0;for(;o<i;){const a=Math.min(i,o+this.chunkedMTU),h=t.slice(o,a),l={__peerData:this._dataCount,n:r,data:h,total:n};s.push(l),o=a,r++}return this._dataCount++,s}}}function tu(e){let t=0;for(const n of e)t+=n.byteLength;const s=new Uint8Array(t);let i=0;for(const n of e)s.set(n,i),i+=n.byteLength;return s}const zi=no.default||no,hs=new class{isWebRTCSupported(){return typeof RTCPeerConnection<"u"}isBrowserSupported(){const e=this.getBrowser(),t=this.getVersion();return this.supportedBrowsers.includes(e)?e==="chrome"?t>=this.minChromeVersion:e==="firefox"?t>=this.minFirefoxVersion:e==="safari"?!this.isIOS&&t>=this.minSafariVersion:!1:!1}getBrowser(){return zi.browserDetails.browser}getVersion(){return zi.browserDetails.version||0}isUnifiedPlanSupported(){const e=this.getBrowser(),t=zi.browserDetails.version||0;if(e==="chrome"&&t<this.minChromeVersion)return!1;if(e==="firefox"&&t>=this.minFirefoxVersion)return!0;if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;let s,i=!1;try{s=new RTCPeerConnection,s.addTransceiver("audio"),i=!0}catch{}finally{s&&s.close()}return i}toString(){return`Supports:
    browser:${this.getBrowser()}
    version:${this.getVersion()}
    isIOS:${this.isIOS}
    isWebRTCSupported:${this.isWebRTCSupported()}
    isBrowserSupported:${this.isBrowserSupported()}
    isUnifiedPlanSupported:${this.isUnifiedPlanSupported()}`}constructor(){this.isIOS=typeof navigator<"u"?["iPad","iPhone","iPod"].includes(navigator.platform):!1,this.supportedBrowsers=["firefox","chrome","safari"],this.minFirefoxVersion=59,this.minChromeVersion=72,this.minSafariVersion=605}},su=e=>!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.test(e),Sh=()=>Math.random().toString(36).slice(2),ro={iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:["turn:eu-0.turn.peerjs.com:3478","turn:us-0.turn.peerjs.com:3478"],username:"peerjs",credential:"peerjsp"}],sdpSemantics:"unified-plan"};class iu extends xh{noop(){}blobToArrayBuffer(t,s){const i=new FileReader;return i.onload=function(n){n.target&&s(n.target.result)},i.readAsArrayBuffer(t),i}binaryStringToArrayBuffer(t){const s=new Uint8Array(t.length);for(let i=0;i<t.length;i++)s[i]=t.charCodeAt(i)&255;return s.buffer}isSecure(){return location.protocol==="https:"}constructor(...t){super(...t),this.CLOUD_HOST="0.peerjs.com",this.CLOUD_PORT=443,this.chunkedBrowsers={Chrome:1,chrome:1},this.defaultConfig=ro,this.browser=hs.getBrowser(),this.browserVersion=hs.getVersion(),this.pack=Ga,this.unpack=Va,this.supports=function(){const s={browser:hs.isBrowserSupported(),webRTC:hs.isWebRTCSupported(),audioVideo:!1,data:!1,binaryBlob:!1,reliable:!1};if(!s.webRTC)return s;let i;try{i=new RTCPeerConnection(ro),s.audioVideo=!0;let n;try{n=i.createDataChannel("_PEERJSTEST",{ordered:!0}),s.data=!0,s.reliable=!!n.ordered;try{n.binaryType="blob",s.binaryBlob=!hs.isIOS}catch{}}catch{}finally{n&&n.close()}}catch{}finally{i&&i.close()}return s}(),this.validateId=su,this.randomToken=Sh}}const be=new iu,nu="PeerJS: ";var oo;(function(e){e[e.Disabled=0]="Disabled",e[e.Errors=1]="Errors",e[e.Warnings=2]="Warnings",e[e.All=3]="All"})(oo||(oo={}));class ru{get logLevel(){return this._logLevel}set logLevel(t){this._logLevel=t}log(...t){this._logLevel>=3&&this._print(3,...t)}warn(...t){this._logLevel>=2&&this._print(2,...t)}error(...t){this._logLevel>=1&&this._print(1,...t)}setLogFunction(t){this._print=t}_print(t,...s){const i=[nu,...s];for(const n in i)i[n]instanceof Error&&(i[n]="("+i[n].name+") "+i[n].message);t>=3?console.log(...i):t>=2?console.warn("WARNING",...i):t>=1&&console.error("ERROR",...i)}constructor(){this._logLevel=0}}var F=new ru,Qn={},ou=Object.prototype.hasOwnProperty,Re="~";function Ds(){}Object.create&&(Ds.prototype=Object.create(null),new Ds().__proto__||(Re=!1));function au(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function Ch(e,t,s,i,n){if(typeof s!="function")throw new TypeError("The listener must be a function");var r=new au(s,i||e,n),o=Re?Re+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],r]:e._events[o].push(r):(e._events[o]=r,e._eventsCount++),e}function Js(e,t){--e._eventsCount===0?e._events=new Ds:delete e._events[t]}function pe(){this._events=new Ds,this._eventsCount=0}pe.prototype.eventNames=function(){var t=[],s,i;if(this._eventsCount===0)return t;for(i in s=this._events)ou.call(s,i)&&t.push(Re?i.slice(1):i);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(s)):t};pe.prototype.listeners=function(t){var s=Re?Re+t:t,i=this._events[s];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,r=i.length,o=new Array(r);n<r;n++)o[n]=i[n].fn;return o};pe.prototype.listenerCount=function(t){var s=Re?Re+t:t,i=this._events[s];return i?i.fn?1:i.length:0};pe.prototype.emit=function(t,s,i,n,r,o){var a=Re?Re+t:t;if(!this._events[a])return!1;var h=this._events[a],l=arguments.length,c,f;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),l){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,s),!0;case 3:return h.fn.call(h.context,s,i),!0;case 4:return h.fn.call(h.context,s,i,n),!0;case 5:return h.fn.call(h.context,s,i,n,r),!0;case 6:return h.fn.call(h.context,s,i,n,r,o),!0}for(f=1,c=new Array(l-1);f<l;f++)c[f-1]=arguments[f];h.fn.apply(h.context,c)}else{var u=h.length,p;for(f=0;f<u;f++)switch(h[f].once&&this.removeListener(t,h[f].fn,void 0,!0),l){case 1:h[f].fn.call(h[f].context);break;case 2:h[f].fn.call(h[f].context,s);break;case 3:h[f].fn.call(h[f].context,s,i);break;case 4:h[f].fn.call(h[f].context,s,i,n);break;default:if(!c)for(p=1,c=new Array(l-1);p<l;p++)c[p-1]=arguments[p];h[f].fn.apply(h[f].context,c)}}return!0};pe.prototype.on=function(t,s,i){return Ch(this,t,s,i,!1)};pe.prototype.once=function(t,s,i){return Ch(this,t,s,i,!0)};pe.prototype.removeListener=function(t,s,i,n){var r=Re?Re+t:t;if(!this._events[r])return this;if(!s)return Js(this,r),this;var o=this._events[r];if(o.fn)o.fn===s&&(!n||o.once)&&(!i||o.context===i)&&Js(this,r);else{for(var a=0,h=[],l=o.length;a<l;a++)(o[a].fn!==s||n&&!o[a].once||i&&o[a].context!==i)&&h.push(o[a]);h.length?this._events[r]=h.length===1?h[0]:h:Js(this,r)}return this};pe.prototype.removeAllListeners=function(t){var s;return t?(s=Re?Re+t:t,this._events[s]&&Js(this,s)):(this._events=new Ds,this._eventsCount=0),this};pe.prototype.off=pe.prototype.removeListener;pe.prototype.addListener=pe.prototype.on;pe.prefixed=Re;pe.EventEmitter=pe;Qn=pe;var Ft={};Mt(Ft,"ConnectionType",()=>Ke);Mt(Ft,"PeerErrorType",()=>ie);Mt(Ft,"BaseConnectionErrorType",()=>Is);Mt(Ft,"DataConnectionErrorType",()=>Os);Mt(Ft,"SerializationType",()=>Qt);Mt(Ft,"SocketEventType",()=>Je);Mt(Ft,"ServerMessageType",()=>ae);var Ke;(function(e){e.Data="data",e.Media="media"})(Ke||(Ke={}));var ie;(function(e){e.BrowserIncompatible="browser-incompatible",e.Disconnected="disconnected",e.InvalidID="invalid-id",e.InvalidKey="invalid-key",e.Network="network",e.PeerUnavailable="peer-unavailable",e.SslUnavailable="ssl-unavailable",e.ServerError="server-error",e.SocketError="socket-error",e.SocketClosed="socket-closed",e.UnavailableID="unavailable-id",e.WebRTC="webrtc"})(ie||(ie={}));var Is;(function(e){e.NegotiationFailed="negotiation-failed",e.ConnectionClosed="connection-closed"})(Is||(Is={}));var Os;(function(e){e.NotOpenYet="not-open-yet",e.MessageToBig="message-too-big"})(Os||(Os={}));var Qt;(function(e){e.Binary="binary",e.BinaryUTF8="binary-utf8",e.JSON="json",e.None="raw"})(Qt||(Qt={}));var Je;(function(e){e.Message="message",e.Disconnected="disconnected",e.Error="error",e.Close="close"})(Je||(Je={}));var ae;(function(e){e.Heartbeat="HEARTBEAT",e.Candidate="CANDIDATE",e.Offer="OFFER",e.Answer="ANSWER",e.Open="OPEN",e.Error="ERROR",e.IdTaken="ID-TAKEN",e.InvalidKey="INVALID-KEY",e.Leave="LEAVE",e.Expire="EXPIRE"})(ae||(ae={}));var er={};er=JSON.parse('{"name":"peerjs","version":"1.5.4","keywords":["peerjs","webrtc","p2p","rtc"],"description":"PeerJS client","homepage":"https://peerjs.com","bugs":{"url":"https://github.com/peers/peerjs/issues"},"repository":{"type":"git","url":"https://github.com/peers/peerjs"},"license":"MIT","contributors":["Michelle Bu <michelle@michellebu.com>","afrokick <devbyru@gmail.com>","ericz <really.ez@gmail.com>","Jairo <kidandcat@gmail.com>","Jonas Gloning <34194370+jonasgloning@users.noreply.github.com>","Jairo Caro-Accino Viciana <jairo@galax.be>","Carlos Caballero <carlos.caballero.gonzalez@gmail.com>","hc <hheennrryy@gmail.com>","Muhammad Asif <capripio@gmail.com>","PrashoonB <prashoonbhattacharjee@gmail.com>","Harsh Bardhan Mishra <47351025+HarshCasper@users.noreply.github.com>","akotynski <aleksanderkotbury@gmail.com>","lmb <i@lmb.io>","Jairooo <jairocaro@msn.com>","Moritz Stückler <moritz.stueckler@gmail.com>","Simon <crydotsnakegithub@gmail.com>","Denis Lukov <denismassters@gmail.com>","Philipp Hancke <fippo@andyet.net>","Hans Oksendahl <hansoksendahl@gmail.com>","Jess <jessachandler@gmail.com>","khankuan <khankuan@gmail.com>","DUODVK <kurmanov.work@gmail.com>","XiZhao <kwang1imsa@gmail.com>","Matthias Lohr <matthias@lohr.me>","=frank tree <=frnktrb@googlemail.com>","Andre Eckardt <aeckardt@outlook.com>","Chris Cowan <agentme49@gmail.com>","Alex Chuev <alex@chuev.com>","alxnull <alxnull@e.mail.de>","Yemel Jardi <angel.jardi@gmail.com>","Ben Parnell <benjaminparnell.94@gmail.com>","Benny Lichtner <bennlich@gmail.com>","fresheneesz <bitetrudpublic@gmail.com>","bob.barstead@exaptive.com <bob.barstead@exaptive.com>","chandika <chandika@gmail.com>","emersion <contact@emersion.fr>","Christopher Van <cvan@users.noreply.github.com>","eddieherm <edhermoso@gmail.com>","Eduardo Pinho <enet4mikeenet@gmail.com>","Evandro Zanatta <ezanatta@tray.net.br>","Gardner Bickford <gardner@users.noreply.github.com>","Gian Luca <gianluca.cecchi@cynny.com>","PatrickJS <github@gdi2290.com>","jonnyf <github@jonathanfoss.co.uk>","Hizkia Felix <hizkifw@gmail.com>","Hristo Oskov <hristo.oskov@gmail.com>","Isaac Madwed <i.madwed@gmail.com>","Ilya Konanykhin <ilya.konanykhin@gmail.com>","jasonbarry <jasbarry@me.com>","Jonathan Burke <jonathan.burke.1311@googlemail.com>","Josh Hamit <josh.hamit@gmail.com>","Jordan Austin <jrax86@gmail.com>","Joel Wetzell <jwetzell@yahoo.com>","xizhao <kevin.wang@cloudera.com>","Alberto Torres <kungfoobar@gmail.com>","Jonathan Mayol <mayoljonathan@gmail.com>","Jefferson Felix <me@jsfelix.dev>","Rolf Erik Lekang <me@rolflekang.com>","Kevin Mai-Husan Chia <mhchia@users.noreply.github.com>","Pepijn de Vos <pepijndevos@gmail.com>","JooYoung <qkdlql@naver.com>","Tobias Speicher <rootcommander@gmail.com>","Steve Blaurock <sblaurock@gmail.com>","Kyrylo Shegeda <shegeda@ualberta.ca>","Diwank Singh Tomer <singh@diwank.name>","Sören Balko <Soeren.Balko@gmail.com>","Arpit Solanki <solankiarpit1997@gmail.com>","Yuki Ito <yuki@gnnk.net>","Artur Zayats <zag2art@gmail.com>"],"funding":{"type":"opencollective","url":"https://opencollective.com/peer"},"collective":{"type":"opencollective","url":"https://opencollective.com/peer"},"files":["dist/*"],"sideEffects":["lib/global.ts","lib/supports.ts"],"main":"dist/bundler.cjs","module":"dist/bundler.mjs","browser-minified":"dist/peerjs.min.js","browser-unminified":"dist/peerjs.js","browser-minified-msgpack":"dist/serializer.msgpack.mjs","types":"dist/types.d.ts","engines":{"node":">= 14"},"targets":{"types":{"source":"lib/exports.ts"},"main":{"source":"lib/exports.ts","sourceMap":{"inlineSources":true}},"module":{"source":"lib/exports.ts","includeNodeModules":["eventemitter3"],"sourceMap":{"inlineSources":true}},"browser-minified":{"context":"browser","outputFormat":"global","optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-unminified":{"context":"browser","outputFormat":"global","optimize":false,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 80, safari >= 15"},"source":"lib/global.ts"},"browser-minified-msgpack":{"context":"browser","outputFormat":"esmodule","isLibrary":true,"optimize":true,"engines":{"browsers":"chrome >= 83, edge >= 83, firefox >= 102, safari >= 15"},"source":"lib/dataconnection/StreamConnection/MsgPack.ts"}},"scripts":{"contributors":"git-authors-cli --print=false && prettier --write package.json && git add package.json package-lock.json && git commit -m \\"chore(contributors): update and sort contributors list\\"","check":"tsc --noEmit && tsc -p e2e/tsconfig.json --noEmit","watch":"parcel watch","build":"rm -rf dist && parcel build","prepublishOnly":"npm run build","test":"jest","test:watch":"jest --watch","coverage":"jest --coverage --collectCoverageFrom=\\"./lib/**\\"","format":"prettier --write .","format:check":"prettier --check .","semantic-release":"semantic-release","e2e":"wdio run e2e/wdio.local.conf.ts","e2e:bstack":"wdio run e2e/wdio.bstack.conf.ts"},"devDependencies":{"@parcel/config-default":"^2.9.3","@parcel/packager-ts":"^2.9.3","@parcel/transformer-typescript-tsc":"^2.9.3","@parcel/transformer-typescript-types":"^2.9.3","@semantic-release/changelog":"^6.0.1","@semantic-release/git":"^10.0.1","@swc/core":"^1.3.27","@swc/jest":"^0.2.24","@types/jasmine":"^4.3.4","@wdio/browserstack-service":"^8.11.2","@wdio/cli":"^8.11.2","@wdio/globals":"^8.11.2","@wdio/jasmine-framework":"^8.11.2","@wdio/local-runner":"^8.11.2","@wdio/spec-reporter":"^8.11.2","@wdio/types":"^8.10.4","http-server":"^14.1.1","jest":"^29.3.1","jest-environment-jsdom":"^29.3.1","mock-socket":"^9.0.0","parcel":"^2.9.3","prettier":"^3.0.0","semantic-release":"^21.0.0","ts-node":"^10.9.1","typescript":"^5.0.0","wdio-geckodriver-service":"^5.0.1"},"dependencies":{"@msgpack/msgpack":"^2.8.0","eventemitter3":"^4.0.7","peerjs-js-binarypack":"^2.1.0","webrtc-adapter":"^9.0.0"},"alias":{"process":false,"buffer":false}}');class hu extends Qn.EventEmitter{constructor(t,s,i,n,r,o=5e3){super(),this.pingInterval=o,this._disconnected=!0,this._messagesQueue=[];const a=t?"wss://":"ws://";this._baseUrl=a+s+":"+i+n+"peerjs?key="+r}start(t,s){this._id=t;const i=`${this._baseUrl}&id=${t}&token=${s}`;this._socket||!this._disconnected||(this._socket=new WebSocket(i+"&version="+er.version),this._disconnected=!1,this._socket.onmessage=n=>{let r;try{r=JSON.parse(n.data),F.log("Server message received:",r)}catch{F.log("Invalid server message",n.data);return}this.emit(Je.Message,r)},this._socket.onclose=n=>{this._disconnected||(F.log("Socket closed.",n),this._cleanup(),this._disconnected=!0,this.emit(Je.Disconnected))},this._socket.onopen=()=>{this._disconnected||(this._sendQueuedMessages(),F.log("Socket open"),this._scheduleHeartbeat())})}_scheduleHeartbeat(){this._wsPingTimer=setTimeout(()=>{this._sendHeartbeat()},this.pingInterval)}_sendHeartbeat(){if(!this._wsOpen()){F.log("Cannot send heartbeat, because socket closed");return}const t=JSON.stringify({type:ae.Heartbeat});this._socket.send(t),this._scheduleHeartbeat()}_wsOpen(){return!!this._socket&&this._socket.readyState===1}_sendQueuedMessages(){const t=[...this._messagesQueue];this._messagesQueue=[];for(const s of t)this.send(s)}send(t){if(this._disconnected)return;if(!this._id){this._messagesQueue.push(t);return}if(!t.type){this.emit(Je.Error,"Invalid message");return}if(!this._wsOpen())return;const s=JSON.stringify(t);this._socket.send(s)}close(){this._disconnected||(this._cleanup(),this._disconnected=!0)}_cleanup(){this._socket&&(this._socket.onopen=this._socket.onmessage=this._socket.onclose=null,this._socket.close(),this._socket=void 0),clearTimeout(this._wsPingTimer)}}class bh{constructor(t){this.connection=t}startConnection(t){const s=this._startPeerConnection();if(this.connection.peerConnection=s,this.connection.type===Ke.Media&&t._stream&&this._addTracksToConnection(t._stream,s),t.originator){const i=this.connection,n={ordered:!!t.reliable},r=s.createDataChannel(i.label,n);i._initializeDataChannel(r),this._makeOffer()}else this.handleSDP("OFFER",t.sdp)}_startPeerConnection(){F.log("Creating RTCPeerConnection.");const t=new RTCPeerConnection(this.connection.provider.options.config);return this._setupListeners(t),t}_setupListeners(t){const s=this.connection.peer,i=this.connection.connectionId,n=this.connection.type,r=this.connection.provider;F.log("Listening for ICE candidates."),t.onicecandidate=o=>{!o.candidate||!o.candidate.candidate||(F.log(`Received ICE candidates for ${s}:`,o.candidate),r.socket.send({type:ae.Candidate,payload:{candidate:o.candidate,type:n,connectionId:i},dst:s}))},t.oniceconnectionstatechange=()=>{switch(t.iceConnectionState){case"failed":F.log("iceConnectionState is failed, closing connections to "+s),this.connection.emitError(Is.NegotiationFailed,"Negotiation of connection to "+s+" failed."),this.connection.close();break;case"closed":F.log("iceConnectionState is closed, closing connections to "+s),this.connection.emitError(Is.ConnectionClosed,"Connection to "+s+" closed."),this.connection.close();break;case"disconnected":F.log("iceConnectionState changed to disconnected on the connection with "+s);break;case"completed":t.onicecandidate=()=>{};break}this.connection.emit("iceStateChanged",t.iceConnectionState)},F.log("Listening for data channel"),t.ondatachannel=o=>{F.log("Received data channel");const a=o.channel;r.getConnection(s,i)._initializeDataChannel(a)},F.log("Listening for remote stream"),t.ontrack=o=>{F.log("Received remote stream");const a=o.streams[0],h=r.getConnection(s,i);if(h.type===Ke.Media){const l=h;this._addStreamToMediaConnection(a,l)}}}cleanup(){F.log("Cleaning up PeerConnection to "+this.connection.peer);const t=this.connection.peerConnection;if(!t)return;this.connection.peerConnection=null,t.onicecandidate=t.oniceconnectionstatechange=t.ondatachannel=t.ontrack=()=>{};const s=t.signalingState!=="closed";let i=!1;const n=this.connection.dataChannel;n&&(i=!!n.readyState&&n.readyState!=="closed"),(s||i)&&t.close()}async _makeOffer(){const t=this.connection.peerConnection,s=this.connection.provider;try{const i=await t.createOffer(this.connection.options.constraints);F.log("Created offer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp);try{await t.setLocalDescription(i),F.log("Set localDescription:",i,`for:${this.connection.peer}`);let n={sdp:i,type:this.connection.type,connectionId:this.connection.connectionId,metadata:this.connection.metadata};if(this.connection.type===Ke.Data){const r=this.connection;n={...n,label:r.label,reliable:r.reliable,serialization:r.serialization}}s.socket.send({type:ae.Offer,payload:n,dst:this.connection.peer})}catch(n){n!="OperationError: Failed to set local offer sdp: Called in wrong state: kHaveRemoteOffer"&&(s.emitError(ie.WebRTC,n),F.log("Failed to setLocalDescription, ",n))}}catch(i){s.emitError(ie.WebRTC,i),F.log("Failed to createOffer, ",i)}}async _makeAnswer(){const t=this.connection.peerConnection,s=this.connection.provider;try{const i=await t.createAnswer();F.log("Created answer."),this.connection.options.sdpTransform&&typeof this.connection.options.sdpTransform=="function"&&(i.sdp=this.connection.options.sdpTransform(i.sdp)||i.sdp);try{await t.setLocalDescription(i),F.log("Set localDescription:",i,`for:${this.connection.peer}`),s.socket.send({type:ae.Answer,payload:{sdp:i,type:this.connection.type,connectionId:this.connection.connectionId},dst:this.connection.peer})}catch(n){s.emitError(ie.WebRTC,n),F.log("Failed to setLocalDescription, ",n)}}catch(i){s.emitError(ie.WebRTC,i),F.log("Failed to create answer, ",i)}}async handleSDP(t,s){s=new RTCSessionDescription(s);const i=this.connection.peerConnection,n=this.connection.provider;F.log("Setting remote description",s);const r=this;try{await i.setRemoteDescription(s),F.log(`Set remoteDescription:${t} for:${this.connection.peer}`),t==="OFFER"&&await r._makeAnswer()}catch(o){n.emitError(ie.WebRTC,o),F.log("Failed to setRemoteDescription, ",o)}}async handleCandidate(t){F.log("handleCandidate:",t);try{await this.connection.peerConnection.addIceCandidate(t),F.log(`Added ICE candidate for:${this.connection.peer}`)}catch(s){this.connection.provider.emitError(ie.WebRTC,s),F.log("Failed to handleCandidate, ",s)}}_addTracksToConnection(t,s){if(F.log(`add tracks from stream ${t.id} to peer connection`),!s.addTrack)return F.error("Your browser does't support RTCPeerConnection#addTrack. Ignored.");t.getTracks().forEach(i=>{s.addTrack(i,t)})}_addStreamToMediaConnection(t,s){F.log(`add stream ${t.id} to media connection ${s.connectionId}`),s.addStream(t)}}class yh extends Qn.EventEmitter{emitError(t,s){F.error("Error:",s),this.emit("error",new cu(`${t}`,s))}}class cu extends Error{constructor(t,s){typeof s=="string"?super(s):(super(),Object.assign(this,s)),this.type=t}}class vh extends yh{get open(){return this._open}constructor(t,s,i){super(),this.peer=t,this.provider=s,this.options=i,this._open=!1,this.metadata=i.metadata}}var In;const xs=class xs extends vh{get type(){return Ke.Media}get localStream(){return this._localStream}get remoteStream(){return this._remoteStream}constructor(t,s,i){super(t,s,i),this._localStream=this.options._stream,this.connectionId=this.options.connectionId||xs.ID_PREFIX+be.randomToken(),this._negotiator=new bh(this),this._localStream&&this._negotiator.startConnection({_stream:this._localStream,originator:!0})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{F.log(`DC#${this.connectionId} dc connection success`),this.emit("willCloseOnRemote")},this.dataChannel.onclose=()=>{F.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}addStream(t){F.log("Receiving stream",t),this._remoteStream=t,super.emit("stream",t)}handleMessage(t){const s=t.type,i=t.payload;switch(t.type){case ae.Answer:this._negotiator.handleSDP(s,i.sdp),this._open=!0;break;case ae.Candidate:this._negotiator.handleCandidate(i.candidate);break;default:F.warn(`Unrecognized message type:${s} from peer:${this.peer}`);break}}answer(t,s={}){if(this._localStream){F.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");return}this._localStream=t,s&&s.sdpTransform&&(this.options.sdpTransform=s.sdpTransform),this._negotiator.startConnection({...this.options._payload,_stream:t});const i=this.provider._getMessages(this.connectionId);for(const n of i)this.handleMessage(n);this._open=!0}close(){this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this._localStream=null,this._remoteStream=null,this.provider&&(this.provider._removeConnection(this),this.provider=null),this.options&&this.options._stream&&(this.options._stream=null),this.open&&(this._open=!1,super.emit("close"))}};In=new WeakMap,ut(xs,In,xs.ID_PREFIX="mc_");let ni=xs;class lu{constructor(t){this._options=t}_buildRequest(t){const s=this._options.secure?"https":"http",{host:i,port:n,path:r,key:o}=this._options,a=new URL(`${s}://${i}:${n}${r}${o}/${t}`);return a.searchParams.set("ts",`${Date.now()}${Math.random()}`),a.searchParams.set("version",er.version),fetch(a.href,{referrerPolicy:this._options.referrerPolicy})}async retrieveId(){try{const t=await this._buildRequest("id");if(t.status!==200)throw new Error(`Error. Status:${t.status}`);return t.text()}catch(t){F.error("Error retrieving ID",t);let s="";throw this._options.path==="/"&&this._options.host!==be.CLOUD_HOST&&(s=" If you passed in a `path` to your self-hosted PeerServer, you'll also need to pass in that same path when creating a new Peer."),new Error("Could not get an ID from the server."+s)}}async listAllPeers(){try{const t=await this._buildRequest("peers");if(t.status!==200){if(t.status===401){let s="";throw this._options.host===be.CLOUD_HOST?s="It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":s="You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",new Error("It doesn't look like you have permission to list peers IDs. "+s)}throw new Error(`Error. Status:${t.status}`)}return t.json()}catch(t){throw F.error("Error retrieving list peers",t),new Error("Could not get list peers from the server."+t)}}}var On,Pn;const It=class It extends vh{get type(){return Ke.Data}constructor(t,s,i){super(t,s,i),this.connectionId=this.options.connectionId||It.ID_PREFIX+Sh(),this.label=this.options.label||this.connectionId,this.reliable=!!this.options.reliable,this._negotiator=new bh(this),this._negotiator.startConnection(this.options._payload||{originator:!0,reliable:this.reliable})}_initializeDataChannel(t){this.dataChannel=t,this.dataChannel.onopen=()=>{F.log(`DC#${this.connectionId} dc connection success`),this._open=!0,this.emit("open")},this.dataChannel.onmessage=s=>{F.log(`DC#${this.connectionId} dc onmessage:`,s.data)},this.dataChannel.onclose=()=>{F.log(`DC#${this.connectionId} dc closed for:`,this.peer),this.close()}}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._negotiator&&(this._negotiator.cleanup(),this._negotiator=null),this.provider&&(this.provider._removeConnection(this),this.provider=null),this.dataChannel&&(this.dataChannel.onopen=null,this.dataChannel.onmessage=null,this.dataChannel.onclose=null,this.dataChannel=null),this.open&&(this._open=!1,super.emit("close"))}send(t,s=!1){if(!this.open){this.emitError(Os.NotOpenYet,"Connection is not open. You should listen for the `open` event before sending messages.");return}return this._send(t,s)}async handleMessage(t){const s=t.payload;switch(t.type){case ae.Answer:await this._negotiator.handleSDP(t.type,s.sdp);break;case ae.Candidate:await this._negotiator.handleCandidate(s.candidate);break;default:F.warn("Unrecognized message type:",t.type,"from peer:",this.peer);break}}};On=new WeakMap,Pn=new WeakMap,ut(It,On,It.ID_PREFIX="dc_"),ut(It,Pn,It.MAX_BUFFERED_AMOUNT=8388608);let ri=It;class tr extends ri{get bufferSize(){return this._bufferSize}_initializeDataChannel(t){super._initializeDataChannel(t),this.dataChannel.binaryType="arraybuffer",this.dataChannel.addEventListener("message",s=>this._handleDataMessage(s))}_bufferedSend(t){(this._buffering||!this._trySend(t))&&(this._buffer.push(t),this._bufferSize=this._buffer.length)}_trySend(t){if(!this.open)return!1;if(this.dataChannel.bufferedAmount>ri.MAX_BUFFERED_AMOUNT)return this._buffering=!0,setTimeout(()=>{this._buffering=!1,this._tryBuffer()},50),!1;try{this.dataChannel.send(t)}catch(s){return F.error(`DC#:${this.connectionId} Error when sending:`,s),this._buffering=!0,this.close(),!1}return!0}_tryBuffer(){if(!this.open||this._buffer.length===0)return;const t=this._buffer[0];this._trySend(t)&&(this._buffer.shift(),this._bufferSize=this._buffer.length,this._tryBuffer())}close(t){if(t!=null&&t.flush){this.send({__peerData:{type:"close"}});return}this._buffer=[],this._bufferSize=0,super.close()}constructor(...t){super(...t),this._buffer=[],this._bufferSize=0,this._buffering=!1}}class Ji extends tr{close(t){super.close(t),this._chunkedData={}}constructor(t,s,i){super(t,s,i),this.chunker=new xh,this.serialization=Qt.Binary,this._chunkedData={}}_handleDataMessage({data:t}){const s=Va(t),i=s.__peerData;if(i){if(i.type==="close"){this.close();return}this._handleChunk(s);return}this.emit("data",s)}_handleChunk(t){const s=t.__peerData,i=this._chunkedData[s]||{data:[],count:0,total:t.total};if(i.data[t.n]=new Uint8Array(t.data),i.count++,this._chunkedData[s]=i,i.total===i.count){delete this._chunkedData[s];const n=tu(i.data);this._handleDataMessage({data:n})}}_send(t,s){const i=Ga(t);if(i instanceof Promise)return this._send_blob(i);if(!s&&i.byteLength>this.chunker.chunkedMTU){this._sendChunks(i);return}this._bufferedSend(i)}async _send_blob(t){const s=await t;if(s.byteLength>this.chunker.chunkedMTU){this._sendChunks(s);return}this._bufferedSend(s)}_sendChunks(t){const s=this.chunker.chunk(t);F.log(`DC#${this.connectionId} Try to send ${s.length} chunks...`);for(const i of s)this.send(i,!0)}}class fu extends tr{_handleDataMessage({data:t}){super.emit("data",t)}_send(t,s){this._bufferedSend(t)}constructor(...t){super(...t),this.serialization=Qt.None}}class uu extends tr{_handleDataMessage({data:t}){const s=this.parse(this.decoder.decode(t)),i=s.__peerData;if(i&&i.type==="close"){this.close();return}this.emit("data",s)}_send(t,s){const i=this.encoder.encode(this.stringify(t));if(i.byteLength>=be.chunkedMTU){this.emitError(Os.MessageToBig,"Message too big for JSON channel");return}this._bufferedSend(i)}constructor(...t){super(...t),this.serialization=Qt.JSON,this.encoder=new TextEncoder,this.decoder=new TextDecoder,this.stringify=JSON.stringify,this.parse=JSON.parse}}var kn;const Ss=class Ss extends yh{get id(){return this._id}get options(){return this._options}get open(){return this._open}get socket(){return this._socket}get connections(){const t=Object.create(null);for(const[s,i]of this._connections)t[s]=i;return t}get destroyed(){return this._destroyed}get disconnected(){return this._disconnected}constructor(t,s){super(),this._serializers={raw:fu,json:uu,binary:Ji,"binary-utf8":Ji,default:Ji},this._id=null,this._lastServerId=null,this._destroyed=!1,this._disconnected=!1,this._open=!1,this._connections=new Map,this._lostMessages=new Map;let i;if(t&&t.constructor==Object?s=t:t&&(i=t.toString()),s={debug:0,host:be.CLOUD_HOST,port:be.CLOUD_PORT,path:"/",key:Ss.DEFAULT_KEY,token:be.randomToken(),config:be.defaultConfig,referrerPolicy:"strict-origin-when-cross-origin",serializers:{},...s},this._options=s,this._serializers={...this._serializers,...this.options.serializers},this._options.host==="/"&&(this._options.host=window.location.hostname),this._options.path&&(this._options.path[0]!=="/"&&(this._options.path="/"+this._options.path),this._options.path[this._options.path.length-1]!=="/"&&(this._options.path+="/")),this._options.secure===void 0&&this._options.host!==be.CLOUD_HOST?this._options.secure=be.isSecure():this._options.host==be.CLOUD_HOST&&(this._options.secure=!0),this._options.logFunction&&F.setLogFunction(this._options.logFunction),F.logLevel=this._options.debug||0,this._api=new lu(s),this._socket=this._createServerConnection(),!be.supports.audioVideo&&!be.supports.data){this._delayedAbort(ie.BrowserIncompatible,"The current browser does not support WebRTC");return}if(i&&!be.validateId(i)){this._delayedAbort(ie.InvalidID,`ID "${i}" is invalid`);return}i?this._initialize(i):this._api.retrieveId().then(n=>this._initialize(n)).catch(n=>this._abort(ie.ServerError,n))}_createServerConnection(){const t=new hu(this._options.secure,this._options.host,this._options.port,this._options.path,this._options.key,this._options.pingInterval);return t.on(Je.Message,s=>{this._handleMessage(s)}),t.on(Je.Error,s=>{this._abort(ie.SocketError,s)}),t.on(Je.Disconnected,()=>{this.disconnected||(this.emitError(ie.Network,"Lost connection to server."),this.disconnect())}),t.on(Je.Close,()=>{this.disconnected||this._abort(ie.SocketClosed,"Underlying socket is already closed.")}),t}_initialize(t){this._id=t,this.socket.start(t,this._options.token)}_handleMessage(t){const s=t.type,i=t.payload,n=t.src;switch(s){case ae.Open:this._lastServerId=this.id,this._open=!0,this.emit("open",this.id);break;case ae.Error:this._abort(ie.ServerError,i.msg);break;case ae.IdTaken:this._abort(ie.UnavailableID,`ID "${this.id}" is taken`);break;case ae.InvalidKey:this._abort(ie.InvalidKey,`API KEY "${this._options.key}" is invalid`);break;case ae.Leave:F.log(`Received leave message from ${n}`),this._cleanupPeer(n),this._connections.delete(n);break;case ae.Expire:this.emitError(ie.PeerUnavailable,`Could not connect to peer ${n}`);break;case ae.Offer:{const r=i.connectionId;let o=this.getConnection(n,r);if(o&&(o.close(),F.warn(`Offer received for existing Connection ID:${r}`)),i.type===Ke.Media){const h=new ni(n,this,{connectionId:r,_payload:i,metadata:i.metadata});o=h,this._addConnection(n,o),this.emit("call",h)}else if(i.type===Ke.Data){const h=new this._serializers[i.serialization](n,this,{connectionId:r,_payload:i,metadata:i.metadata,label:i.label,serialization:i.serialization,reliable:i.reliable});o=h,this._addConnection(n,o),this.emit("connection",h)}else{F.warn(`Received malformed connection type:${i.type}`);return}const a=this._getMessages(r);for(const h of a)o.handleMessage(h);break}default:{if(!i){F.warn(`You received a malformed message from ${n} of type ${s}`);return}const r=i.connectionId,o=this.getConnection(n,r);o&&o.peerConnection?o.handleMessage(t):r?this._storeMessage(r,t):F.warn("You received an unrecognized message:",t);break}}}_storeMessage(t,s){this._lostMessages.has(t)||this._lostMessages.set(t,[]),this._lostMessages.get(t).push(s)}_getMessages(t){const s=this._lostMessages.get(t);return s?(this._lostMessages.delete(t),s):[]}connect(t,s={}){if(s={serialization:"default",...s},this.disconnected){F.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),this.emitError(ie.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}const i=new this._serializers[s.serialization](t,this,s);return this._addConnection(t,i),i}call(t,s,i={}){if(this.disconnected){F.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),this.emitError(ie.Disconnected,"Cannot connect to new Peer after disconnecting from server.");return}if(!s){F.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.");return}const n=new ni(t,this,{...i,_stream:s});return this._addConnection(t,n),n}_addConnection(t,s){F.log(`add connection ${s.type}:${s.connectionId} to peerId:${t}`),this._connections.has(t)||this._connections.set(t,[]),this._connections.get(t).push(s)}_removeConnection(t){const s=this._connections.get(t.peer);if(s){const i=s.indexOf(t);i!==-1&&s.splice(i,1)}this._lostMessages.delete(t.connectionId)}getConnection(t,s){const i=this._connections.get(t);if(!i)return null;for(const n of i)if(n.connectionId===s)return n;return null}_delayedAbort(t,s){setTimeout(()=>{this._abort(t,s)},0)}_abort(t,s){F.error("Aborting!"),this.emitError(t,s),this._lastServerId?this.disconnect():this.destroy()}destroy(){this.destroyed||(F.log(`Destroy peer with ID:${this.id}`),this.disconnect(),this._cleanup(),this._destroyed=!0,this.emit("close"))}_cleanup(){for(const t of this._connections.keys())this._cleanupPeer(t),this._connections.delete(t);this.socket.removeAllListeners()}_cleanupPeer(t){const s=this._connections.get(t);if(s)for(const i of s)i.close()}disconnect(){if(this.disconnected)return;const t=this.id;F.log(`Disconnect peer with ID:${t}`),this._disconnected=!0,this._open=!1,this.socket.close(),this._lastServerId=t,this._id=null,this.emit("disconnected",t)}reconnect(){if(this.disconnected&&!this.destroyed)F.log(`Attempting reconnection to server with ID ${this._lastServerId}`),this._disconnected=!1,this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(!this.disconnected&&!this.open)F.error("In a hurry? We're still trying to make the initial connection!");else throw new Error(`Peer ${this.id} cannot reconnect because it is not disconnected from the server!`)}}listAllPeers(t=s=>{}){this._api.listAllPeers().then(s=>t(s)).catch(s=>this._abort(ie.ServerError,s))}};kn=new WeakMap,ut(Ss,kn,Ss.DEFAULT_KEY="peerjs");let Tn=Ss;var ao=Tn;function pu(e){const t=ss({id:""}),s=[],i=Oe(e==null?void 0:e.id),n=i?new ao(i):new ao;n.on("open",h=>{t.id=h}),n.on("close",()=>{t.id=""}),n.on("connection",h=>{var l;(l=e==null?void 0:e.connected)==null||l.call(e,h),h.on("data",c=>{var f;(f=e==null?void 0:e.receive)==null||f.call(e,c),(c==null?void 0:c.type)==="ping"&&h.send({type:"pong"})}),s.push(h)}),n.on("disconnected",h=>{gn(s,l=>l.connectionId===h)});const r=Jt(!1);return Ct(()=>t.id,()=>{t.id&&a()}),Ct(()=>Oe(e==null?void 0:e.hostId),()=>{t.id&&a()}),{ctx:t,connected:r,peer:n,send:o};function o(h){s.forEach(l=>l.send(h))}function a(){s.forEach(c=>c.close()),s.splice(0);const h=Oe(e==null?void 0:e.hostId);if(!h)return;const l=n.connect(h);s.push(l),l.on("open",()=>{r.value=!0,l.send({type:"ping"})}),l.on("close",()=>{r.value=!1,gn(s,l)}),l.on("data",c=>{var f;console.log(c),(f=e==null?void 0:e.receive)==null||f.call(e,c)})}}/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Ut=typeof document<"u";function Th(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function du(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&Th(e.default)}const H=Object.assign;function Zi(e,t){const s={};for(const i in t){const n=t[i];s[i]=Ve(n)?n.map(e):e(n)}return s}const _s=()=>{},Ve=Array.isArray,Eh=/#/g,mu=/&/g,gu=/\//g,_u=/=/g,Ru=/\?/g,Ah=/\+/g,xu=/%5B/g,Su=/%5D/g,Dh=/%5E/g,Cu=/%60/g,Ih=/%7B/g,bu=/%7C/g,Oh=/%7D/g,yu=/%20/g;function sr(e){return encodeURI(""+e).replace(bu,"|").replace(xu,"[").replace(Su,"]")}function vu(e){return sr(e).replace(Ih,"{").replace(Oh,"}").replace(Dh,"^")}function En(e){return sr(e).replace(Ah,"%2B").replace(yu,"+").replace(Eh,"%23").replace(mu,"%26").replace(Cu,"`").replace(Ih,"{").replace(Oh,"}").replace(Dh,"^")}function Tu(e){return En(e).replace(_u,"%3D")}function Eu(e){return sr(e).replace(Eh,"%23").replace(Ru,"%3F")}function Au(e){return e==null?"":Eu(e).replace(gu,"%2F")}function Ps(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const Du=/\/$/,Iu=e=>e.replace(Du,"");function Ki(e,t,s="/"){let i,n={},r="",o="";const a=t.indexOf("#");let h=t.indexOf("?");return a<h&&a>=0&&(h=-1),h>-1&&(i=t.slice(0,h),r=t.slice(h+1,a>-1?a:t.length),n=e(r)),a>-1&&(i=i||t.slice(0,a),o=t.slice(a,t.length)),i=Nu(i??t,s),{fullPath:i+(r&&"?")+r+o,path:i,query:n,hash:Ps(o)}}function Ou(e,t){const s=t.query?e(t.query):"";return t.path+(s&&"?")+s+(t.hash||"")}function ho(e,t){return!t||!e.toLowerCase().startsWith(t.toLowerCase())?e:e.slice(t.length)||"/"}function Pu(e,t,s){const i=t.matched.length-1,n=s.matched.length-1;return i>-1&&i===n&&es(t.matched[i],s.matched[n])&&Ph(t.params,s.params)&&e(t.query)===e(s.query)&&t.hash===s.hash}function es(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function Ph(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(!ku(e[s],t[s]))return!1;return!0}function ku(e,t){return Ve(e)?co(e,t):Ve(t)?co(t,e):e===t}function co(e,t){return Ve(t)?e.length===t.length&&e.every((s,i)=>s===t[i]):e.length===1&&e[0]===t}function Nu(e,t){if(e.startsWith("/"))return e;if(!e)return t;const s=t.split("/"),i=e.split("/"),n=i[i.length-1];(n===".."||n===".")&&i.push("");let r=s.length-1,o,a;for(o=0;o<i.length;o++)if(a=i[o],a!==".")if(a==="..")r>1&&r--;else break;return s.slice(0,r).join("/")+"/"+i.slice(o).join("/")}const mt={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var ks;(function(e){e.pop="pop",e.push="push"})(ks||(ks={}));var Rs;(function(e){e.back="back",e.forward="forward",e.unknown=""})(Rs||(Rs={}));function Mu(e){if(!e)if(Ut){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),Iu(e)}const Fu=/^[^#]+#/;function Lu(e,t){return e.replace(Fu,"#")+t}function Bu(e,t){const s=document.documentElement.getBoundingClientRect(),i=e.getBoundingClientRect();return{behavior:t.behavior,left:i.left-s.left-(t.left||0),top:i.top-s.top-(t.top||0)}}const bi=()=>({left:window.scrollX,top:window.scrollY});function wu(e){let t;if("el"in e){const s=e.el,i=typeof s=="string"&&s.startsWith("#"),n=typeof s=="string"?i?document.getElementById(s.slice(1)):document.querySelector(s):s;if(!n)return;t=Bu(n,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(t.left!=null?t.left:window.scrollX,t.top!=null?t.top:window.scrollY)}function lo(e,t){return(history.state?history.state.position-t:-1)+e}const An=new Map;function Vu(e,t){An.set(e,t)}function Gu(e){const t=An.get(e);return An.delete(e),t}let qu=()=>location.protocol+"//"+location.host;function kh(e,t){const{pathname:s,search:i,hash:n}=t,r=e.indexOf("#");if(r>-1){let a=n.includes(e.slice(r))?e.slice(r).length:1,h=n.slice(a);return h[0]!=="/"&&(h="/"+h),ho(h,"")}return ho(s,e)+i+n}function ju(e,t,s,i){let n=[],r=[],o=null;const a=({state:u})=>{const p=kh(e,location),_=s.value,R=t.value;let P=0;if(u){if(s.value=p,t.value=u,o&&o===_){o=null;return}P=R?u.position-R.position:0}else i(p);n.forEach(A=>{A(s.value,_,{delta:P,type:ks.pop,direction:P?P>0?Rs.forward:Rs.back:Rs.unknown})})};function h(){o=s.value}function l(u){n.push(u);const p=()=>{const _=n.indexOf(u);_>-1&&n.splice(_,1)};return r.push(p),p}function c(){const{history:u}=window;u.state&&u.replaceState(H({},u.state,{scroll:bi()}),"")}function f(){for(const u of r)u();r=[],window.removeEventListener("popstate",a),window.removeEventListener("beforeunload",c)}return window.addEventListener("popstate",a),window.addEventListener("beforeunload",c,{passive:!0}),{pauseListeners:h,listen:l,destroy:f}}function fo(e,t,s,i=!1,n=!1){return{back:e,current:t,forward:s,replaced:i,position:window.history.length,scroll:n?bi():null}}function Uu(e){const{history:t,location:s}=window,i={value:kh(e,s)},n={value:t.state};n.value||r(i.value,{back:null,current:i.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0);function r(h,l,c){const f=e.indexOf("#"),u=f>-1?(s.host&&document.querySelector("base")?e:e.slice(f))+h:qu()+e+h;try{t[c?"replaceState":"pushState"](l,"",u),n.value=l}catch(p){console.error(p),s[c?"replace":"assign"](u)}}function o(h,l){const c=H({},t.state,fo(n.value.back,h,n.value.forward,!0),l,{position:n.value.position});r(h,c,!0),i.value=h}function a(h,l){const c=H({},n.value,t.state,{forward:h,scroll:bi()});r(c.current,c,!0);const f=H({},fo(i.value,h,null),{position:c.position+1},l);r(h,f,!1),i.value=h}return{location:i,state:n,push:a,replace:o}}function $u(e){e=Mu(e);const t=Uu(e),s=ju(e,t.state,t.location,t.replace);function i(r,o=!0){o||s.pauseListeners(),history.go(r)}const n=H({location:"",base:e,go:i,createHref:Lu.bind(null,e)},t,s);return Object.defineProperty(n,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(n,"state",{enumerable:!0,get:()=>t.state.value}),n}function Hu(e){return e=location.host?e||location.pathname+location.search:"",e.includes("#")||(e+="#"),$u(e)}function Xu(e){return typeof e=="string"||e&&typeof e=="object"}function Nh(e){return typeof e=="string"||typeof e=="symbol"}const Mh=Symbol("");var uo;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(uo||(uo={}));function ts(e,t){return H(new Error,{type:e,[Mh]:!0},t)}function st(e,t){return e instanceof Error&&Mh in e&&(t==null||!!(e.type&t))}const po="[^/]+?",Yu={sensitive:!1,strict:!1,start:!0,end:!0},Wu=/[.+*?^${}()[\]/\\]/g;function zu(e,t){const s=H({},Yu,t),i=[];let n=s.start?"^":"";const r=[];for(const l of e){const c=l.length?[]:[90];s.strict&&!l.length&&(n+="/");for(let f=0;f<l.length;f++){const u=l[f];let p=40+(s.sensitive?.25:0);if(u.type===0)f||(n+="/"),n+=u.value.replace(Wu,"\\$&"),p+=40;else if(u.type===1){const{value:_,repeatable:R,optional:P,regexp:A}=u;r.push({name:_,repeatable:R,optional:P});const T=A||po;if(T!==po){p+=10;try{new RegExp(`(${T})`)}catch(v){throw new Error(`Invalid custom RegExp for param "${_}" (${T}): `+v.message)}}let k=R?`((?:${T})(?:/(?:${T}))*)`:`(${T})`;f||(k=P&&l.length<2?`(?:/${k})`:"/"+k),P&&(k+="?"),n+=k,p+=20,P&&(p+=-8),R&&(p+=-20),T===".*"&&(p+=-50)}c.push(p)}i.push(c)}if(s.strict&&s.end){const l=i.length-1;i[l][i[l].length-1]+=.7000000000000001}s.strict||(n+="/?"),s.end?n+="$":s.strict&&!n.endsWith("/")&&(n+="(?:/|$)");const o=new RegExp(n,s.sensitive?"":"i");function a(l){const c=l.match(o),f={};if(!c)return null;for(let u=1;u<c.length;u++){const p=c[u]||"",_=r[u-1];f[_.name]=p&&_.repeatable?p.split("/"):p}return f}function h(l){let c="",f=!1;for(const u of e){(!f||!c.endsWith("/"))&&(c+="/"),f=!1;for(const p of u)if(p.type===0)c+=p.value;else if(p.type===1){const{value:_,repeatable:R,optional:P}=p,A=_ in l?l[_]:"";if(Ve(A)&&!R)throw new Error(`Provided param "${_}" is an array but it is not repeatable (* or + modifiers)`);const T=Ve(A)?A.join("/"):A;if(!T)if(P)u.length<2&&(c.endsWith("/")?c=c.slice(0,-1):f=!0);else throw new Error(`Missing required param "${_}"`);c+=T}}return c||"/"}return{re:o,score:i,keys:r,parse:a,stringify:h}}function Ju(e,t){let s=0;for(;s<e.length&&s<t.length;){const i=t[s]-e[s];if(i)return i;s++}return e.length<t.length?e.length===1&&e[0]===80?-1:1:e.length>t.length?t.length===1&&t[0]===80?1:-1:0}function Fh(e,t){let s=0;const i=e.score,n=t.score;for(;s<i.length&&s<n.length;){const r=Ju(i[s],n[s]);if(r)return r;s++}if(Math.abs(n.length-i.length)===1){if(mo(i))return 1;if(mo(n))return-1}return n.length-i.length}function mo(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const Zu={type:0,value:""},Ku=/[a-zA-Z0-9_]/;function Qu(e){if(!e)return[[]];if(e==="/")return[[Zu]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(p){throw new Error(`ERR (${s})/"${l}": ${p}`)}let s=0,i=s;const n=[];let r;function o(){r&&n.push(r),r=[]}let a=0,h,l="",c="";function f(){l&&(s===0?r.push({type:0,value:l}):s===1||s===2||s===3?(r.length>1&&(h==="*"||h==="+")&&t(`A repeatable param (${l}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:l,regexp:c,repeatable:h==="*"||h==="+",optional:h==="*"||h==="?"})):t("Invalid state to consume buffer"),l="")}function u(){l+=h}for(;a<e.length;){if(h=e[a++],h==="\\"&&s!==2){i=s,s=4;continue}switch(s){case 0:h==="/"?(l&&f(),o()):h===":"?(f(),s=1):u();break;case 4:u(),s=i;break;case 1:h==="("?s=2:Ku.test(h)?u():(f(),s=0,h!=="*"&&h!=="?"&&h!=="+"&&a--);break;case 2:h===")"?c[c.length-1]=="\\"?c=c.slice(0,-1)+h:s=3:c+=h;break;case 3:f(),s=0,h!=="*"&&h!=="?"&&h!=="+"&&a--,c="";break;default:t("Unknown state");break}}return s===2&&t(`Unfinished custom RegExp for param "${l}"`),f(),o(),n}function ep(e,t,s){const i=zu(Qu(e.path),s),n=H(i,{record:e,parent:t,children:[],alias:[]});return t&&!n.record.aliasOf==!t.record.aliasOf&&t.children.push(n),n}function tp(e,t){const s=[],i=new Map;t=xo({strict:!1,end:!0,sensitive:!1},t);function n(f){return i.get(f)}function r(f,u,p){const _=!p,R=_o(f);R.aliasOf=p&&p.record;const P=xo(t,f),A=[R];if("alias"in f){const v=typeof f.alias=="string"?[f.alias]:f.alias;for(const j of v)A.push(_o(H({},R,{components:p?p.record.components:R.components,path:j,aliasOf:p?p.record:R})))}let T,k;for(const v of A){const{path:j}=v;if(u&&j[0]!=="/"){const te=u.record.path,z=te[te.length-1]==="/"?"":"/";v.path=u.record.path+(j&&z+j)}if(T=ep(v,u,P),p?p.alias.push(T):(k=k||T,k!==T&&k.alias.push(T),_&&f.name&&!Ro(T)&&o(f.name)),Lh(T)&&h(T),R.children){const te=R.children;for(let z=0;z<te.length;z++)r(te[z],T,p&&p.children[z])}p=p||T}return k?()=>{o(k)}:_s}function o(f){if(Nh(f)){const u=i.get(f);u&&(i.delete(f),s.splice(s.indexOf(u),1),u.children.forEach(o),u.alias.forEach(o))}else{const u=s.indexOf(f);u>-1&&(s.splice(u,1),f.record.name&&i.delete(f.record.name),f.children.forEach(o),f.alias.forEach(o))}}function a(){return s}function h(f){const u=np(f,s);s.splice(u,0,f),f.record.name&&!Ro(f)&&i.set(f.record.name,f)}function l(f,u){let p,_={},R,P;if("name"in f&&f.name){if(p=i.get(f.name),!p)throw ts(1,{location:f});P=p.record.name,_=H(go(u.params,p.keys.filter(k=>!k.optional).concat(p.parent?p.parent.keys.filter(k=>k.optional):[]).map(k=>k.name)),f.params&&go(f.params,p.keys.map(k=>k.name))),R=p.stringify(_)}else if(f.path!=null)R=f.path,p=s.find(k=>k.re.test(R)),p&&(_=p.parse(R),P=p.record.name);else{if(p=u.name?i.get(u.name):s.find(k=>k.re.test(u.path)),!p)throw ts(1,{location:f,currentLocation:u});P=p.record.name,_=H({},u.params,f.params),R=p.stringify(_)}const A=[];let T=p;for(;T;)A.unshift(T.record),T=T.parent;return{name:P,path:R,params:_,matched:A,meta:ip(A)}}e.forEach(f=>r(f));function c(){s.length=0,i.clear()}return{addRoute:r,resolve:l,removeRoute:o,clearRoutes:c,getRoutes:a,getRecordMatcher:n}}function go(e,t){const s={};for(const i of t)i in e&&(s[i]=e[i]);return s}function _o(e){const t={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:sp(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(t,"mods",{value:{}}),t}function sp(e){const t={},s=e.props||!1;if("component"in e)t.default=s;else for(const i in e.components)t[i]=typeof s=="object"?s[i]:s;return t}function Ro(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function ip(e){return e.reduce((t,s)=>H(t,s.meta),{})}function xo(e,t){const s={};for(const i in e)s[i]=i in t?t[i]:e[i];return s}function np(e,t){let s=0,i=t.length;for(;s!==i;){const r=s+i>>1;Fh(e,t[r])<0?i=r:s=r+1}const n=rp(e);return n&&(i=t.lastIndexOf(n,i-1)),i}function rp(e){let t=e;for(;t=t.parent;)if(Lh(t)&&Fh(e,t)===0)return t}function Lh({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function op(e){const t={};if(e===""||e==="?")return t;const i=(e[0]==="?"?e.slice(1):e).split("&");for(let n=0;n<i.length;++n){const r=i[n].replace(Ah," "),o=r.indexOf("="),a=Ps(o<0?r:r.slice(0,o)),h=o<0?null:Ps(r.slice(o+1));if(a in t){let l=t[a];Ve(l)||(l=t[a]=[l]),l.push(h)}else t[a]=h}return t}function So(e){let t="";for(let s in e){const i=e[s];if(s=Tu(s),i==null){i!==void 0&&(t+=(t.length?"&":"")+s);continue}(Ve(i)?i.map(r=>r&&En(r)):[i&&En(i)]).forEach(r=>{r!==void 0&&(t+=(t.length?"&":"")+s,r!=null&&(t+="="+r))})}return t}function ap(e){const t={};for(const s in e){const i=e[s];i!==void 0&&(t[s]=Ve(i)?i.map(n=>n==null?null:""+n):i==null?i:""+i)}return t}const hp=Symbol(""),Co=Symbol(""),yi=Symbol(""),ir=Symbol(""),Dn=Symbol("");function cs(){let e=[];function t(i){return e.push(i),()=>{const n=e.indexOf(i);n>-1&&e.splice(n,1)}}function s(){e=[]}return{add:t,list:()=>e.slice(),reset:s}}function Rt(e,t,s,i,n,r=o=>o()){const o=i&&(i.enterCallbacks[n]=i.enterCallbacks[n]||[]);return()=>new Promise((a,h)=>{const l=u=>{u===!1?h(ts(4,{from:s,to:t})):u instanceof Error?h(u):Xu(u)?h(ts(2,{from:t,to:u})):(o&&i.enterCallbacks[n]===o&&typeof u=="function"&&o.push(u),a())},c=r(()=>e.call(i&&i.instances[n],t,s,l));let f=Promise.resolve(c);e.length<3&&(f=f.then(l)),f.catch(u=>h(u))})}function Qi(e,t,s,i,n=r=>r()){const r=[];for(const o of e)for(const a in o.components){let h=o.components[a];if(!(t!=="beforeRouteEnter"&&!o.instances[a]))if(Th(h)){const c=(h.__vccOpts||h)[t];c&&r.push(Rt(c,s,i,o,a,n))}else{let l=h();r.push(()=>l.then(c=>{if(!c)throw new Error(`Couldn't resolve component "${a}" at "${o.path}"`);const f=du(c)?c.default:c;o.mods[a]=c,o.components[a]=f;const p=(f.__vccOpts||f)[t];return p&&Rt(p,s,i,o,a,n)()}))}}return r}function bo(e){const t=we(yi),s=we(ir),i=Ne(()=>{const h=Oe(e.to);return t.resolve(h)}),n=Ne(()=>{const{matched:h}=i.value,{length:l}=h,c=h[l-1],f=s.matched;if(!c||!f.length)return-1;const u=f.findIndex(es.bind(null,c));if(u>-1)return u;const p=yo(h[l-2]);return l>1&&yo(c)===p&&f[f.length-1].path!==p?f.findIndex(es.bind(null,h[l-2])):u}),r=Ne(()=>n.value>-1&&pp(s.params,i.value.params)),o=Ne(()=>n.value>-1&&n.value===s.matched.length-1&&Ph(s.params,i.value.params));function a(h={}){if(up(h)){const l=t[Oe(e.replace)?"replace":"push"](Oe(e.to)).catch(_s);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>l),l}return Promise.resolve()}return{route:i,href:Ne(()=>i.value.href),isActive:r,isExactActive:o,navigate:a}}function cp(e){return e.length===1?e[0]:e}const lp=di({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:bo,setup(e,{slots:t}){const s=ss(bo(e)),{options:i}=we(yi),n=Ne(()=>({[vo(e.activeClass,i.linkActiveClass,"router-link-active")]:s.isActive,[vo(e.exactActiveClass,i.linkExactActiveClass,"router-link-exact-active")]:s.isExactActive}));return()=>{const r=t.default&&cp(t.default(s));return e.custom?r:Ma("a",{"aria-current":s.isExactActive?e.ariaCurrentValue:null,href:s.href,onClick:s.navigate,class:n.value},r)}}}),fp=lp;function up(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function pp(e,t){for(const s in t){const i=t[s],n=e[s];if(typeof i=="string"){if(i!==n)return!1}else if(!Ve(n)||n.length!==i.length||i.some((r,o)=>r!==n[o]))return!1}return!0}function yo(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const vo=(e,t,s)=>e??t??s,dp=di({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:s}){const i=we(Dn),n=Ne(()=>e.route||i.value),r=we(Co,0),o=Ne(()=>{let l=Oe(r);const{matched:c}=n.value;let f;for(;(f=c[l])&&!f.components;)l++;return l}),a=Ne(()=>n.value.matched[o.value]);qs(Co,Ne(()=>o.value+1)),qs(hp,a),qs(Dn,n);const h=Jt();return Ct(()=>[h.value,a.value,e.name],([l,c,f],[u,p,_])=>{c&&(c.instances[f]=l,p&&p!==c&&l&&l===u&&(c.leaveGuards.size||(c.leaveGuards=p.leaveGuards),c.updateGuards.size||(c.updateGuards=p.updateGuards))),l&&c&&(!p||!es(c,p)||!u)&&(c.enterCallbacks[f]||[]).forEach(R=>R(l))},{flush:"post"}),()=>{const l=n.value,c=e.name,f=a.value,u=f&&f.components[c];if(!u)return To(s.default,{Component:u,route:l});const p=f.props[c],_=p?p===!0?l.params:typeof p=="function"?p(l):p:null,P=Ma(u,H({},_,t,{onVnodeUnmounted:A=>{A.component.isUnmounted&&(f.instances[c]=null)},ref:h}));return To(s.default,{Component:P,route:l})||P}}});function To(e,t){if(!e)return null;const s=e(t);return s.length===1?s[0]:s}const mp=dp;function gp(e){const t=tp(e.routes,e),s=e.parseQuery||op,i=e.stringifyQuery||So,n=e.history,r=cs(),o=cs(),a=cs(),h=bc(mt);let l=mt;Ut&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const c=Zi.bind(null,S=>""+S),f=Zi.bind(null,Au),u=Zi.bind(null,Ps);function p(S,M){let O,L;return Nh(S)?(O=t.getRecordMatcher(S),L=M):L=S,t.addRoute(L,O)}function _(S){const M=t.getRecordMatcher(S);M&&t.removeRoute(M)}function R(){return t.getRoutes().map(S=>S.record)}function P(S){return!!t.getRecordMatcher(S)}function A(S,M){if(M=H({},M||h.value),typeof S=="string"){const g=Ki(s,S,M.path),x=t.resolve({path:g.path},M),b=n.createHref(g.fullPath);return H(g,x,{params:u(x.params),hash:Ps(g.hash),redirectedFrom:void 0,href:b})}let O;if(S.path!=null)O=H({},S,{path:Ki(s,S.path,M.path).path});else{const g=H({},S.params);for(const x in g)g[x]==null&&delete g[x];O=H({},S,{params:f(g)}),M.params=f(M.params)}const L=t.resolve(O,M),Z=S.hash||"";L.params=c(u(L.params));const d=Ou(i,H({},S,{hash:vu(Z),path:L.path})),m=n.createHref(d);return H({fullPath:d,hash:Z,query:i===So?ap(S.query):S.query||{}},L,{redirectedFrom:void 0,href:m})}function T(S){return typeof S=="string"?Ki(s,S,h.value.path):H({},S)}function k(S,M){if(l!==S)return ts(8,{from:M,to:S})}function v(S){return z(S)}function j(S){return v(H(T(S),{replace:!0}))}function te(S){const M=S.matched[S.matched.length-1];if(M&&M.redirect){const{redirect:O}=M;let L=typeof O=="function"?O(S):O;return typeof L=="string"&&(L=L.includes("?")||L.includes("#")?L=T(L):{path:L},L.params={}),H({query:S.query,hash:S.hash,params:L.path!=null?{}:S.params},L)}}function z(S,M){const O=l=A(S),L=h.value,Z=S.state,d=S.force,m=S.replace===!0,g=te(O);if(g)return z(H(T(g),{state:typeof g=="object"?H({},Z,g.state):Z,force:d,replace:m}),M||O);const x=O;x.redirectedFrom=M;let b;return!d&&Pu(i,L,O)&&(b=ts(16,{to:x,from:L}),Ue(L,L,!0,!1)),(b?Promise.resolve(b):qe(x,L)).catch(C=>st(C)?st(C,2)?C:ft(C):$(C,x,L)).then(C=>{if(C){if(st(C,2))return z(H({replace:m},T(C.to),{state:typeof C.to=="object"?H({},Z,C.to.state):Z,force:d}),M||x)}else C=vt(x,L,!0,m,Z);return lt(x,L,C),C})}function Ge(S,M){const O=k(S,M);return O?Promise.reject(O):Promise.resolve()}function ct(S){const M=wt.values().next().value;return M&&typeof M.runWithContext=="function"?M.runWithContext(S):S()}function qe(S,M){let O;const[L,Z,d]=_p(S,M);O=Qi(L.reverse(),"beforeRouteLeave",S,M);for(const g of L)g.leaveGuards.forEach(x=>{O.push(Rt(x,S,M))});const m=Ge.bind(null,S,M);return O.push(m),Pe(O).then(()=>{O=[];for(const g of r.list())O.push(Rt(g,S,M));return O.push(m),Pe(O)}).then(()=>{O=Qi(Z,"beforeRouteUpdate",S,M);for(const g of Z)g.updateGuards.forEach(x=>{O.push(Rt(x,S,M))});return O.push(m),Pe(O)}).then(()=>{O=[];for(const g of d)if(g.beforeEnter)if(Ve(g.beforeEnter))for(const x of g.beforeEnter)O.push(Rt(x,S,M));else O.push(Rt(g.beforeEnter,S,M));return O.push(m),Pe(O)}).then(()=>(S.matched.forEach(g=>g.enterCallbacks={}),O=Qi(d,"beforeRouteEnter",S,M,ct),O.push(m),Pe(O))).then(()=>{O=[];for(const g of o.list())O.push(Rt(g,S,M));return O.push(m),Pe(O)}).catch(g=>st(g,8)?g:Promise.reject(g))}function lt(S,M,O){a.list().forEach(L=>ct(()=>L(S,M,O)))}function vt(S,M,O,L,Z){const d=k(S,M);if(d)return d;const m=M===mt,g=Ut?history.state:{};O&&(L||m?n.replace(S.fullPath,H({scroll:m&&g&&g.scroll},Z)):n.push(S.fullPath,Z)),h.value=S,Ue(S,M,O,m),ft()}let je;function is(){je||(je=n.listen((S,M,O)=>{if(!Fs.listening)return;const L=A(S),Z=te(L);if(Z){z(H(Z,{replace:!0,force:!0}),L).catch(_s);return}l=L;const d=h.value;Ut&&Vu(lo(d.fullPath,O.delta),bi()),qe(L,d).catch(m=>st(m,12)?m:st(m,2)?(z(H(T(m.to),{force:!0}),L).then(g=>{st(g,20)&&!O.delta&&O.type===ks.pop&&n.go(-1,!1)}).catch(_s),Promise.reject()):(O.delta&&n.go(-O.delta,!1),$(m,L,d))).then(m=>{m=m||vt(L,d,!1),m&&(O.delta&&!st(m,8)?n.go(-O.delta,!1):O.type===ks.pop&&st(m,20)&&n.go(-1,!1)),lt(L,d,m)}).catch(_s)}))}let Lt=cs(),oe=cs(),J;function $(S,M,O){ft(S);const L=oe.list();return L.length?L.forEach(Z=>Z(S,M,O)):console.error(S),Promise.reject(S)}function et(){return J&&h.value!==mt?Promise.resolve():new Promise((S,M)=>{Lt.add([S,M])})}function ft(S){return J||(J=!S,is(),Lt.list().forEach(([M,O])=>S?O(S):M()),Lt.reset()),S}function Ue(S,M,O,L){const{scrollBehavior:Z}=e;if(!Ut||!Z)return Promise.resolve();const d=!O&&Gu(lo(S.fullPath,0))||(L||!O)&&history.state&&history.state.scroll||null;return Xn().then(()=>Z(S,M,d)).then(m=>m&&wu(m)).catch(m=>$(m,S,M))}const xe=S=>n.go(S);let Bt;const wt=new Set,Fs={currentRoute:h,listening:!0,addRoute:p,removeRoute:_,clearRoutes:t.clearRoutes,hasRoute:P,getRoutes:R,resolve:A,options:e,push:v,replace:j,go:xe,back:()=>xe(-1),forward:()=>xe(1),beforeEach:r.add,beforeResolve:o.add,afterEach:a.add,onError:oe.add,isReady:et,install(S){const M=this;S.component("RouterLink",fp),S.component("RouterView",mp),S.config.globalProperties.$router=M,Object.defineProperty(S.config.globalProperties,"$route",{enumerable:!0,get:()=>Oe(h)}),Ut&&!Bt&&h.value===mt&&(Bt=!0,v(n.location).catch(Z=>{}));const O={};for(const Z in mt)Object.defineProperty(O,Z,{get:()=>h.value[Z],enumerable:!0});S.provide(yi,M),S.provide(ir,Jo(O)),S.provide(Dn,h);const L=S.unmount;wt.add(S),S.unmount=function(){wt.delete(S),wt.size<1&&(l=mt,je&&je(),je=null,h.value=mt,Bt=!1,J=!1),L()}}};function Pe(S){return S.reduce((M,O)=>M.then(()=>ct(O)),Promise.resolve())}return Fs}function _p(e,t){const s=[],i=[],n=[],r=Math.max(t.matched.length,e.matched.length);for(let o=0;o<r;o++){const a=t.matched[o];a&&(e.matched.find(l=>es(l,a))?i.push(a):s.push(a));const h=e.matched[o];h&&(t.matched.find(l=>es(l,h))||n.push(h))}return[s,i,n]}function Rp(){return we(yi)}function xp(e){return we(ir)}const en=new WeakMap;function Sp(e,t,s={}){const{mode:i="replace",route:n=xp(),router:r=Rp(),transform:o}=s;let a=p=>p,h=p=>p;typeof o=="function"?a=o:o&&(o.get&&(a=o.get),o.set&&(h=o.set)),en.has(r)||en.set(r,new Map);const l=en.get(r);let c=n.query[e];Ci(()=>{c=void 0});let f;const u=Ec((p,_)=>(f=_,{get(){return p(),a(c!==void 0?c:ot(t))},set(R){R=h(R),c!==R&&(c=R===ot(t)?void 0:R,l.set(e,R===ot(t)?void 0:R),_(),Xn(()=>{if(l.size===0)return;const P=Object.fromEntries(l.entries());l.clear();const{params:A,query:T,hash:k}=n;r[ot(i)]({params:A,query:{...T,...P},hash:k})}))}}));return Ct(()=>n.query[e],p=>{c!==a(p)&&(c=p,f())},{flush:"sync"}),u}const Cp={class:"flex flex-col items-center justify-center w-screen gap-2 mt-50px"},bp={class:"info"},yp={class:"nes-field"},vp={for:"name_field"},Tp=di({__name:"index",setup(e){const t=Jt(),s=Sp("id",""),i=wf(),n=Jt(""),r=pu({id:s,receive(a){if((a==null?void 0:a.type)==="keyEvent"){const[h,l]=a.data||{};i.keyEvent(h,l[0],2)}},connected(a){console.log(a.peer,"send call");const h=i.video.dom.captureStream(60),l=i.audio.media,c=new MediaStream([...h.getTracks(),...l.getTracks()]);r.peer.call(a.peer,c)}});Lf(()=>{n.value=parseInt(i.nes.getFPS()).toFixed(0)},500,{immediate:!0}),ha(async()=>{i.mount(t.value)});async function o(){t.value&&(i.init(),await i.load("./roms/Contra.nes"))}return(a,h)=>{const l=pf;return vs(),Ia("div",Cp,[Dt("div",bp,[Dt("div",yp,[Dt("label",vp,"ID: "+sn(Oe(r).ctx.id),1)]),Dt("div",null,"FPS: "+sn(Oe(n)),1)]),Dt("div",{ref_key:"output",ref:t,class:"aspect-[256/240] w-600px"},null,512),ye(l,{onClick:o},{default:na(()=>h[0]||(h[0]=[Pa("Load ROM")])),_:1})])}}}),Ep=()=>Uh(()=>import("./client-6Kf-ltkc.js"),[],import.meta.url),Ap=[{name:"index",path:"/",component:Tp,props:!0},{name:"client",path:"/client",component:Ep,props:!0}],Dp=e=>{const t=Ap,s=gp({history:Hu(),routes:t});e.use(s)},Ip=Object.freeze(Object.defineProperty({__proto__:null,install:Dp},Symbol.toStringTag,{value:"Module"})),Op=(e,t)=>{const s=e.__vccOpts||e;for(const[i,n]of t)s[i]=n;return s},Pp={};function kp(e,t){const s=Wc("router-view");return vs(),pn(s)}const Np=Op(Pp,[["render",kp]]),Bh=cf(Np);Object.values([Ip]).forEach(e=>{Bh.use(e.install)});Bh.mount("#app");export{pf as _,wf as a,pu as b,Lf as c,di as d,Ia as e,Dt as f,ye as g,Oe as h,fe as i,na as j,vs as k,Pa as l,ha as o,Jt as r,Bp as s,sn as t,Sp as u,Lp as v,Fp as w};
